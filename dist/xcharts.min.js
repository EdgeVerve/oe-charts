!function(context,xChart){if(context.d3)context.xChart=xChart(context.d3);else{if(!console||!console.warn)throw"xCharts requires d3 to run. Make sure you have included d3 in the reference";console.warn("xCharts requires d3 to run. Make sure you have included d3 in the reference")}}(this,function(d3){var xChart={version:"0.0.1",authors:"Sourav Kumar, Pragyan Das, Jyothsna Shriyan, Atul Pandit",company:"EdgeVerve Systems Limited",quote:"In the end you should only measure and look at the numbers that drive action, meaning that the data tells you what you should do next."};return xChart.chart=function(renderContainerId){this.renderContainerId=renderContainerId,this.utility=new xChart.utility,this.events=new xChart.events,this.renderedChart={},this._eventHandlers=[],this.chartOptions={chartClientId:"",drillMap:"",zoomLevel:1,gaugeConfiguration:"",chartType:"groupedColumn",margin:{top:15,right:20,bottom:35,left:45},noOfPieSlices:5,axisRedrawThreshold:.2,aec:.1,defaultColors:["#03A9F4","#E91E63","#ff9800","#4CAF50","#D4E157","#FFA726","#9C27B0","#DD4477","#66AA00","#B82E2E","#316395","#994499","#22AA99","#AAAA11","#6633CC","#E67300","#8B0707","#329262","#5574A6","#EABB14","#af2e2e","#5674b9","#774ebf","#ee9595","#e979fc","#1ac3d8","#acd373","#ee4a47","#38a0f4","#72368c","#fbaf5d","#f389ad","#0082cf","#af82ff","#ef5a8c","#873661","#5eb762","#b881c3","#f68e56","#0091a2","#bf3333","#846ab2","#008374"]},this.dataitems={bar:".bar",pie:".pie",bubble:".bubble",lineCircle:".linecircle",areacircle:".areacircle"},this.chartItems={},this.addEventHandler=function(_event,eventTarget,eventHandler,preventDefault){if("undefined"==typeof preventDefault&&(preventDefault=!1),"dataitems"===eventTarget)for(var k in this.dataitems){var target=this.dataitems[k],existingEvent=this._eventHandlers.filter(function(d){return d._event===_event&&d.eventTarget===target});if(existingEvent.length>0)existingEvent[0].eventHandler=eventHandler,existingEvent[0].preventDefault=preventDefault;else{var eventObject={};eventObject._event=_event,eventObject.eventTarget=target,eventObject.eventHandler=eventHandler,eventObject.preventDefault=preventDefault,this._eventHandlers.push(eventObject)}}else{var existingEvent=this._eventHandlers.filter(function(d){return d._event===_event&&d.eventTarget===eventTarget});if(existingEvent.length>0)existingEvent[0].eventHandler=eventHandler,existingEvent[0].preventDefault=preventDefault;else{var eventObject={};eventObject._event=_event,eventObject.eventTarget=eventTarget,eventObject.eventHandler=eventHandler,eventObject.preventDefault=preventDefault,this._eventHandlers.push(eventObject)}}},this.registerEvent=function(_event,eventTarget,eventHandler,preventDefault){this.events.registerSingleEvent(_event,eventTarget,eventHandler,preventDefault)},this.render=function(data){data&&(this.data=data),this.color=[];for(var colorIndex=0,brightnessIndex=1,i=0;i<this.data.series.length;i++)if(this.data.series[i].color&&null!==this.data.series[i].color&&""!==this.data.series[i].color)this.color.push(this.data.series[i].color),colorIndex++;else{if(this.chartOptions.defaultColors[colorIndex])this.color.push(this.chartOptions.defaultColors[colorIndex]);else{var reIndex=colorIndex-this.chartOptions.defaultColors.length;reIndex>this.chartOptions.defaultColors.length&&(colorIndex=this.chartOptions.defaultColors.length,brightnessIndex++),this.color.push(d3.rgb(this.chartOptions.defaultColors[reIndex]).darker(brightnessIndex))}colorIndex++}var chartObject=this.utility.checkChart(this.renderedChart,this.color,this.renderContainerId,this.chartOptions);chartObject===this.renderedChart&&this.chartType===this.chartOptions.chartType?this.renderedChart.redraw(this.data,this._eventHandlers):($("#"+this.renderContainerId+"_select").remove(),this.renderedChart=chartObject,this.chartType=this.chartOptions.chartType,this.renderedChart.draw(this.data,this._eventHandlers)),this.renderedChart.dispatch.on("RenderComplete.redraw"+this.renderContainerId,function(){this.events.addDefaultEventBehaviour(this.renderContainerId),this.events.registerEventHandler(this._eventHandlers,this.renderContainerId)}.bind(this))},this.renderOverlap=function(data){this.oData=data,this.renderedChart.drawOverlap(this.oData,this.data)},this.removeOverlap=function(){this.renderedChart.removeOverlap(this.data)},this.setOptions=function(chartOptions){"undefined"!=typeof chartOptions.overlap&&""!==chartOptions.overlap&&null!==chartOptions.overlap&&(this.chartOptions.overlap=chartOptions.overlap),"undefined"!=typeof chartOptions.noOfPieSlices&&""!==chartOptions.noOfPieSlices&&null!==chartOptions.noOfPieSlices&&(this.chartOptions.noOfPieSlices=chartOptions.noOfPieSlices),"undefined"!=typeof chartOptions.chartClientId&&""!==chartOptions.chartClientId&&null!==chartOptions.chartClientId&&(this.chartOptions.chartClientId=chartOptions.chartClientId),"undefined"!=typeof chartOptions.drillMap&&""!==chartOptions.drillMap&&null!==chartOptions.drillMap&&(this.chartOptions.drillMap=chartOptions.drillMap),"undefined"!=typeof chartOptions.zoomLevel&&""!==chartOptions.zoomLevel&&null!==chartOptions.zoomLevel&&(this.chartOptions.zoomLevel=chartOptions.zoomLevel),"undefined"!=typeof chartOptions.gaugeConfiguration&&""!==chartOptions.gaugeConfiguration&&null!==chartOptions.gaugeConfiguration&&(this.chartOptions.gaugeConfiguration=chartOptions.gaugeConfiguration),"undefined"!=typeof chartOptions.margin&&""!==chartOptions.margin&&null!==chartOptions.margin&&(this.chartOptions.margin=chartOptions.margin),"undefined"!=typeof chartOptions.chartType&&""!==chartOptions.chartType&&null!==chartOptions.chartType&&(this.chartOptions.chartType=chartOptions.chartType),"undefined"!=typeof chartOptions.defaultColors&&""!==chartOptions.defaultColors&&null!==chartOptions.defaultColors&&(this.chartOptions.defaultColors=chartOptions.defaultColors),"undefined"!=typeof chartOptions.zoomLevel&&""!==chartOptions.zoomLevel&&null!==chartOptions.zoomLevel&&(this.chartOptions.zoomLevel=chartOptions.zoomLevel),"undefined"!=typeof chartOptions.axisRedrawThreshold&&""!==chartOptions.axisRedrawThreshold&&null!==chartOptions.axisRedrawThreshold&&(this.chartOptions.axisRedrawThreshold=chartOptions.axisRedrawThreshold),"undefined"!=typeof chartOptions.targetDragEnd&&""!==chartOptions.targetDragEnd&&null!==chartOptions.targetDragEnd&&(this.chartOptions.targetDragEnd=chartOptions.targetDragEnd),"undefined"!=typeof chartOptions.updateTargetSentiment&&""!==chartOptions.updateTargetSentiment&&null!==chartOptions.updateTargetSentiment&&(this.chartOptions.updateTargetSentiment=chartOptions.updateTargetSentiment),"undefined"!=typeof chartOptions.deleteTarget&&""!==chartOptions.deleteTarget&&null!==chartOptions.deleteTarget&&(this.chartOptions.deleteTarget=chartOptions.deleteTarget)}},xChart.events=function(){this.addDefaultEventBehaviour=function(renderContainerId){var svg=d3.select("#"+renderContainerId+"_svg"),bars=svg.selectAll(".bar"),barColor="";"undefined"!=typeof bars[0]&&bars[0].forEach(function(d){d3.select(d).on("click",function(){var currentElement=d3.select(this);d3.event.ctrlKey?(bars[0].forEach(function(e){"1"===d3.select(e).style("opacity")&&d3.select(e).attr("filter")!=="url("+window.location.href+"#"+renderContainerId+"dropshadow)"&&(d3.select(e).attr("filter",""),d3.select(e).style("opacity","0.5"))}),currentElement.attr("filter")!=="url("+window.location.href+"#"+renderContainerId+"dropshadow)"&&"1"!==currentElement.style("opacity")?(currentElement.attr("filter","url("+window.location.href+"#"+renderContainerId+"dropshadow)"),currentElement.style("opacity","1")):(currentElement.attr("filter",""),currentElement.style("opacity","0.5"))):(bars[0].forEach(function(e){d3.select(e).attr("filter",""),d3.select(e).style("opacity","0.5")}),currentElement.attr("filter","url("+window.location.href+"#"+renderContainerId+"dropshadow)"),currentElement.style("opacity","1"))}),d3.select(d).on("mouseover",function(){barColor=d3.select(this).style("fill");var bright_color=d3.rgb(barColor).brighter(1);d3.select(this).style("fill",bright_color)}),d3.select(d).on("mouseout",function(){""===barColor?d3.select(this).style("fill",this.style.fill):d3.select(this).style("fill",barColor)})});var slices=svg.selectAll(".pie"),sliceColor="";"undefined"!=typeof slices[0]&&slices[0].forEach(function(d){d3.select(d).on("click",function(){var currentElement=d3.select(this);d3.event.ctrlKey?(slices[0].forEach(function(e){"1"===d3.select(e).style("opacity")&&d3.select(e).attr("filter")!=="url("+window.location.href+"#"+renderContainerId+"dropshadow)"&&(d3.select(e).attr("filter",""),d3.select(e).style("opacity","0.5"))}),currentElement.attr("filter")!=="url("+window.location.href+"#"+renderContainerId+"dropshadow)"&&"1"!==currentElement.style("opacity")?(currentElement.attr("filter","url("+window.location.href+"#"+renderContainerId+"dropshadow)"),currentElement.style("opacity","1")):(currentElement.attr("filter",""),currentElement.style("opacity","0.5"))):(slices[0].forEach(function(e){d3.select(e).attr("filter",""),d3.select(e).style("opacity","0.5")}),currentElement.attr("filter","url("+window.location.href+"#"+renderContainerId+"dropshadow)"),currentElement.style("opacity","1"))}),d3.select(d).on("mouseover",function(){sliceColor=d3.select(this).style("fill");var bright_color=d3.rgb(sliceColor).brighter(1);d3.select(this).style("fill",bright_color)}),d3.select(d).on("mouseout",function(){""===sliceColor?d3.select(this).style("fill",this.style.fill):d3.select(this).style("fill",sliceColor)})});var bubbles=svg.selectAll(".bubble"),bubbleColor="";"undefined"!=typeof bubbles[0]&&bubbles[0].forEach(function(d){d3.select(d).on("click",function(){var currentElement=d3.select(this);d3.event.ctrlKey?(bubbles[0].forEach(function(e){"1"===d3.select(e).style("opacity")&&d3.select(e).attr("filter")!=="url("+window.location.href+"#"+renderContainerId+"dropshadow)"&&(d3.select(e).attr("filter",""),d3.select(e).style("opacity","0.5"))}),currentElement.attr("filter")!=="url("+window.location.href+"#"+renderContainerId+"dropshadow)"&&"1"!==currentElement.style("opacity")?(currentElement.attr("filter","url("+window.location.href+"#"+renderContainerId+"dropshadow)"),currentElement.style("opacity","1")):(currentElement.attr("filter",""),currentElement.style("opacity","0.5"))):(bubbles[0].forEach(function(e){d3.select(e).attr("filter",""),d3.select(e).style("opacity","0.5")}),currentElement.attr("filter","url("+window.location.href+"#"+renderContainerId+"dropshadow)"),currentElement.style("opacity","1"))}),d3.select(d).on("mouseover",function(){bubbleColor=d3.select(this).style("fill");var bright_color=d3.rgb(bubbleColor).brighter(1);d3.select(this).style("fill",bright_color)}),d3.select(d).on("mouseout",function(){""===bubbleColor?d3.select(this).style("fill",this.style.fill):d3.select(this).style("fill",bubbleColor)})});var legends=svg.selectAll(".legend"),legendColor="";"undefined"!=typeof legends[0]&&legends[0].forEach(function(d){d3.select(d).on("click",function(){var currentElement=d3.select(this);legendColor=currentElement.style("fill"),""===currentElement.attr("filter")||null===currentElement.attr("filter")?currentElement.attr("filter","url("+window.location.href+"#"+renderContainerId+"dropshadow)"):currentElement.attr("filter","")})}),svg.on("click",function(){"undefined"!=typeof bars[0]&&bars[0].forEach(function(d){-1===d3.select(d3.event.target).attr("class").indexOf("bar")&&-1===d3.select(d3.event.target).attr("class").indexOf("legend")&&(d3.select(d).attr("filter",""),d3.select(d).style("opacity","1"))}),slices[0].forEach(function(d){"undefined"!=typeof slices[0]&&-1===d3.select(d3.event.target).attr("class").indexOf("pie")&&-1===d3.select(d3.event.target).attr("class").indexOf("legend")&&(d3.select(d).attr("filter",""),d3.select(d).style("opacity","1"))}),bubbles[0].forEach(function(d){"undefined"!=typeof bubbles[0]&&-1===d3.select(d3.event.target).attr("class").indexOf("bubble")&&-1===d3.select(d3.event.target).attr("class").indexOf("legend")&&(d3.select(d).attr("filter",""),d3.select(d).style("opacity","1"))})})},this.registerEventHandler=function(eventList,renderContainerId){var container=d3.select("#"+renderContainerId);eventList.forEach(function(d){var eventTarget=container.selectAll(d.eventTarget);eventTarget&&"undefined"!=typeof eventTarget[0]&&eventTarget[0].forEach(function(e){d.preventDefault&&d3.select(e).on(d._event,null),e.addEventListener(d._event,function(event){event.srcElement=event.srcElement||event.currentTarget,d.eventHandler.call(this,event)})})})},this.registerSingleEvent=function(_event,eventTarget,eventHandler,preventDefault){var eTarget=d3.select(eventTarget)[0][0];preventDefault&&eTarget.on(_event,null),eTarget.addEventListener(_event,function(){eventHandler()})}},xChart.axis=function(renderContainerId,width,height){this.renderContainerId=renderContainerId,this.width=width,this.height=height,this.utility=new xChart.utility,this.scaleType="",this.axisOptions={ticks:"",fontSize:10,axisColor:"#000",tickColor:"#000",tickSize:"",tickFormat:"",orient:"left",position:"vertical",showPath:!0,axisText:"",calculate:""},this.addQualitativeScale=function(categories,innerPadding,outerPadding){this.categories=categories;var values=this.categories.map(function(d){return d.value}),scale="";return scale="horizontal"===this.axisOptions.position?d3.scale.ordinal().domain(values).rangeRoundBands([0,this.width],innerPadding,outerPadding):d3.scale.ordinal().domain(values).rangeRoundBands([0,this.height],innerPadding,outerPadding),this.scale=scale,this.scaleType="qualitative",this.scale},this.addQuantitativeScale=function(series,aec,rangeMin,rangeMax,domainMin,domainMax){if("auto"!==this.axisOptions.calculate&&"undefined"==typeof domainMin&&"undefined"==typeof domainMax&&"undefined"==typeof rangeMin&&"undefined"==typeof rangeMax)return void console.log("Invalid Arguments.Specify domain and range when calculate is not set to auto");aec||(aec=0),this.series=series;var scale="";if("auto"===this.axisOptions.calculate)if("vertical"===this.axisOptions.position){scale=d3.scale.linear().range([height,0]);var maxY=d3.max(series,function(d){return d3.max(d.data)});scale.domain([0,maxY+aec*maxY])}else{scale=d3.scale.linear().range([width,0]);var maxX=d3.max(series,function(d){return d3.max(d.data)});scale.domain([0,maxX+aec*maxX])}else"auto"!==this.axisOptions.calculate&&(scale=d3.scale.linear(),"undefined"!=typeof rangeMin&&"undefined"!=typeof rangeMax&&scale.range([rangeMax,rangeMin]),"undefined"!=typeof domainMin&&"undefined"!=typeof domainMax&&scale.domain([domainMin,domainMax+aec*domainMax]));return this.scale=scale,this.scaleType="quantitative",this.scale},this.draw=function(scale,drawPosition,axisId){var svg=d3.select("#"+this.renderContainerId+"_mainGroup"),utility=this.utility,axis="";if("horizontal"===this.axisOptions.position&&"qualitative"===this.scaleType){axisId||(axisId=this.renderContainerId+"_xaxis");var categories=this.categories;svg.select("#"+axisId).remove();var xAxis=d3.svg.axis().scale(scale).orient(this.axisOptions.orient);axis=svg.append("g").attr("class","x axis").attr("id",axisId).call(xAxis),drawPosition&&axis.attr("transform","translate("+drawPosition.x+","+drawPosition.y+")");var ticks=axis.selectAll("text").text(function(d,i){return categories[i].name}),axisLabelOverlap=utility.draw_xAxisDummy(svg,categories,this.height,this.width,this.renderContainerId);axisLabelOverlap?(ticks.attr("y",0).attr("x",9).attr("dy",".35em").attr("transform","rotate(90)").style("text-anchor","start"),utility.checkOverlapAndRemove(ticks)):(ticks.call(utility.wrap,scale.rangeBand()),utility.checkOverlapAndRemove(ticks))}else if("vertical"===this.axisOptions.position&&"qualitative"===this.scaleType){axisId||(axisId=this.renderContainerId+"_yaxis");var categories=this.categories;svg.select("#"+axisId).remove();var yAxis=d3.svg.axis().scale(scale).orient(this.axisOptions.orient);axis=svg.append("g").attr("class","y axis").attr("id",axisId).call(yAxis);var ticks=axis.selectAll("text").text(function(d,i){return categories[i].name}).call(utility.wrap,scale.rangeBand());utility.checkOverlapAndRemove(ticks,this.axisOptions.position)}else if("horizontal"===this.axisOptions.position&&"quantitative"===this.scaleType){axisId||(axisId=this.renderContainerId+"_xaxis"),svg.select("#"+axisId).remove();var xAxis=d3.svg.axis().scale(scale).orient(this.axisOptions.orient);""!==this.axisOptions.ticks&&xAxis.ticks(this.axisOptions.ticks),""!==this.axisOptions.tickSize&&xAxis.tickSize(-this.axisOptions.tickSize,0,0),""!==this.axisOptions.tickFormat&&xAxis.tickFormat(this.axisOptions.tickFormat),axis=svg.append("g").attr("class","x axis").attr("id",axisId).call(xAxis),drawPosition&&axis.attr("transform","translate("+drawPosition.x+","+drawPosition.y+")"),this.axisOptions.showPath||svg.select(".x.axis path").style("display","none")}else if("vertical"===this.axisOptions.position&&"quantitative"===this.scaleType){axisId||(axisId=this.renderContainerId+"_yaxis"),svg.select("#"+axisId).remove();var yAxis=d3.svg.axis().scale(scale).orient(this.axisOptions.orient);""!==this.axisOptions.ticks&&yAxis.ticks(this.axisOptions.ticks),""!==this.axisOptions.tickSize&&yAxis.tickSize(-this.axisOptions.tickSize,0,0),""!==this.axisOptions.tickFormat&&yAxis.tickFormat(this.axisOptions.tickFormat),axis=svg.append("g").attr("class","y axis").attr("id",axisId).call(yAxis),drawPosition&&axis.attr("transform","translate("+drawPosition.x+","+drawPosition.y+")"),this.axisOptions.showPath||svg.select(".y.axis path").style("display","none")}return this.utility.tooltip(svg,".axis .x",!1,!1),axis},this.setOptions=function(axisOptions){axisOptions.ticks&&(this.axisOptions.ticks=axisOptions.ticks),axisOptions.fontSize&&(this.axisOptions.fontSize=axisOptions.fontSize),axisOptions.axisColor&&(this.axisOptions.axisColor=axisOptions.axisColor),axisOptions.tickColor&&(this.axisOptions.tickColor=axisOptions.tickColor),axisOptions.tickSize&&(this.axisOptions.tickSize=axisOptions.tickSize),axisOptions.tickFormat&&(this.axisOptions.tickFormat=axisOptions.tickFormat),axisOptions.orient&&(this.axisOptions.orient=axisOptions.orient),axisOptions.position&&(this.axisOptions.position=axisOptions.position),this.axisOptions.showPath=axisOptions.showPath,axisOptions.axisText&&(this.axisOptions.axisText=axisOptions.axisText),axisOptions.calculate&&(this.axisOptions.calculate=axisOptions.calculate)}},xChart.legend=function(series,color){this.series=series,this.color=color,this.utility=new xChart.utility,this.legendOptions={shape:"rect",position:"top",size:10,font:"sans-serif",fontSize:10,stroke:!0,strokeColorCoefficient:.5,fill:!0},this.drawLegend=function(position,svg,width,margin){function drawLegend(xPosition,yPosition,startLegendIdx,endLegendIdx,recCallCount){var legend=svg.selectAll(".legend"+recCallCount).data(function(){for(var legendArr=[],i=startLegendIdx;endLegendIdx+1>i;i++)legendArr.push(series[i]);return legendArr}).enter().append("g").attr("class","legendg legendg"+recCallCount).attr("transform",function(d,i){for(var prevTextWidth=0,j=i+startLegendIdx-1;j>=startLegendIdx;)prevTextWidth+=textWidth[j],j--;return"translate("+(xPosition+40*i+prevTextWidth)+","+-1*yPosition+")"});legend.append("rect").attr("x",45).attr("width",legendWidth).attr("height",legendWidth).attr("class","legend legend"+recCallCount).style("fill",function(d,i){return color[i+startLegendIdx]}),legend.append("text").attr("x",60).attr("y",6).attr("dy",".35em").style("text-anchor","start").style("font",fontSize+"px "+font).text(function(d){return d.name})}function legendLengthExceed(firstIdx,lastIdx){for(var cumLegendWidth=0,threshold=0,i=firstIdx;lastIdx+1>i;i++){cumLegendWidth+=textWidth[i]+legendWidth+40;var cumLegWidth=cumLegendWidth;if(cumLegendWidth>width+margin.left){threshold=i-1,cumLegendWidth-=textWidth[i]+legendWidth+40,0==recCallCount&&(xPosition=-margin.left),yPosition=margin.top-5-15*recCallCount,drawLegend(xPosition,yPosition,firstIdx,threshold,recCallCount),recCallCount++;break}}return cumLegWidth<width+margin.left?(yPosition=margin.top-5-15*recCallCount,void drawLegend(xPosition,yPosition,firstIdx,lastIdx,recCallCount)):void legendLengthExceed(threshold+1,lastIdx)}var legendWidth=this.legendOptions.size,font=this.legendOptions.font,fontSize=this.legendOptions.fontSize,series=this.series,color=this.color;if("top"===position){var legendCount=series.length;svg.selectAll(".legendg").remove();var legend=svg.selectAll(".legend").data(series).enter().append("g").attr("class","legendg").attr("transform",function(d,i){return"translate("+i*(width/legendCount)+",-"+margin.top/2+")"});legend.append("rect").attr("x",45).attr("width",legendWidth).attr("height",legendWidth).attr("class","legend"),legend.append("text").attr("x",60).attr("y",6).attr("dy",".35em").style("text-anchor","start").style("font",fontSize+"px "+font).text(function(d){return d.name});var totalTextWidth=0,textWidth=[];svg.selectAll(".legendg text").forEach(function(c){c.forEach(function(d,i){d.offsetWidth||(d.offsetWidth=d.getBoundingClientRect().width),totalTextWidth+=d.offsetWidth,textWidth[i]=d.offsetWidth})}),svg.selectAll(".legendg").remove();var totalLegendWidth,dx,xPosition,yPosition;totalLegendWidth=totalTextWidth+legendCount*legendWidth+35*legendCount,dx=totalLegendWidth-(width+margin.left+margin.right);var recCallCount=0;return 0>=dx?(xPosition=width-margin.left-margin.right-totalLegendWidth,yPosition=margin.top-5,drawLegend(xPosition,yPosition,0,legendCount-1,recCallCount),this.utility.tooltip(svg,".legend",!1,!1)):legendLengthExceed(0,legendCount-1),recCallCount}},this.setOptions=function(legendOptions){legendOptions.shape&&(this.legendOptions.shape=legendOptions.shape),legendOptions.position&&(this.legendOptions.position=legendOptions.position),legendOptions.stroke&&(this.legendOptions.stroke=legendOptions.stroke),legendOptions.strokeColorCoefficient&&(this.legendOptions.strokeColorCoefficient=legendOptions.strokeColorCoefficient),legendOptions.fill&&(this.legendOptions.fill=legendOptions.fill)}},xChart.area=function(){function area(renderContainerId,color,chartOptions){this.renderContainerId=renderContainerId,this.canvasWidth=document.getElementById(this.renderContainerId).offsetWidth,this.canvasHeight=document.getElementById(this.renderContainerId).offsetHeight,this.margin=jQuery.extend(!0,{},chartOptions.margin),this.color=color,this.utility=new xChart.utility}return area.prototype.dispatch=d3.dispatch("RenderComplete"),area.prototype.draw=function(data){function findSum(categoryIndex){for(var sum=0,i=0;i<data.series.length;i++)sum+=data.series[i].data[categoryIndex];return sum}var color=this.color;$("#"+this.renderContainerId+"_svg").remove();var width=this.canvasWidth-this.margin.left-this.margin.right,height=this.canvasHeight-this.margin.top-this.margin.bottom,svg=d3.select("#"+this.renderContainerId).append("svg").attr("id",this.renderContainerId+"_svg").attr("width",width+this.margin.left+this.margin.right).attr("height",height+this.margin.top+this.margin.bottom).attr("class","area"),mainGroup=svg.append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")").attr("id",this.renderContainerId+"_mainGroup").attr("class","area"),axisLabelOverlap=this.utility.draw_xAxisDummy(mainGroup,data.categories,height,width,this.renderContainerId);axisLabelOverlap&&(this.margin.bottom*=2,this.bottomMarginSet=!0);var legend=new xChart.legend(data.series,color),legendRows=legend.drawLegend("top",mainGroup,width,this.margin)+1;this.margin.top=20*legendRows,mainGroup.selectAll(".legendg").remove(),height=this.canvasHeight-this.margin.top-this.margin.bottom,svg.attr("width",width+this.margin.left+this.margin.right).attr("height",height+this.margin.top+this.margin.bottom),mainGroup.attr("transform","translate("+this.margin.left+","+this.margin.top+")"),svg=mainGroup,legend.drawLegend("top",svg,width,this.margin);var formatPercent=d3.format(".0%");data.series.forEach(function(d,i){d.color=color[i]}),this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="bottom",categoryAxisOptions.position="horizontal",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.xAxis=this.categoryAxis.draw(categoryScale,{x:0,y:height}),this.seriesAxis=new xChart.axis(this.renderContainerId,width,height);var seriesAxisOptions={};seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=width,seriesAxisOptions.orient="left",seriesAxisOptions.position="vertical",seriesAxisOptions.showPath=!1,seriesAxisOptions.tickFormat=formatPercent,this.seriesAxis.setOptions(seriesAxisOptions);var seriesScale=this.seriesAxis.addQuantitativeScale(data.series,.1,0,height);this.yAxis=this.seriesAxis.draw(seriesScale);var area=d3.svg.area().interpolate("linear").x(function(d){return categoryScale(d.category)+categoryScale.rangeBand()/2}).y0(function(d){return seriesScale(d.y0)}).y1(function(d){return seriesScale(d.y0+d.y)}),stack=d3.layout.stack().values(function(d){return d.values});svg.selectAll(".layerg").remove(),svg.selectAll(".circle").remove();var stackData=data.series.map(function(d,i){return{name:d.name,color:d.color,values:data.categories.map(function(e,j){var sum=findSum(j);return{seriesLongName:data.series[i].longName,fmtData:data.series[i].fmtData[j],categoryLongName:e.longName,index:j,seriesIndex:i,category:e.name,categoryDimName:e.dimName,categoryName:e.name,y:d.data[j]/sum}})}}),layerGroup=svg.selectAll(".layerg").data(stack(stackData)).enter().append("g").attr("class","layerg"),thisobj=this;layerGroup.append("path").attr("class","area").attr("d",area(stackData[0].values)).style("stroke",function(d,i){return d.color}).style("fill",function(d,i){return d.color}).transition().duration(1e3).attr("d",function(d){return area(d.values)}).each("end",function(){for(var i=0;i<stack(stackData).length;i++)svg.selectAll(".circle"+i).data(stack(stackData)[i].values).enter().append("circle").attr("class","areacircle circle"+i).attr("cx",function(d){return categoryScale(d.category)+categoryScale.rangeBand()/2}).attr("cy",height).attr("r",4).style("stroke",color[i]).style("stroke-width",.5).style("fill","#fff").transition().delay(function(d){return 100*i}).duration(1e3).attr("cy",function(d){return seriesScale(d.y+d.y0)});thisobj.dispatch.RenderComplete(data,stack(stackData),thisobj),thisobj.utility.tooltip(svg,".areacircle",!0,!1)})},area.prototype.redraw=function(data){function findSum(categoryIndex){for(var sum=0,i=0;i<data.series.length;i++)sum+=data.series[i].data[categoryIndex];return sum}var color=this.color,width=this.canvasWidth-this.margin.left-this.margin.right,height=this.canvasHeight-this.margin.top-this.margin.bottom,svg=d3.select("#"+this.renderContainerId+"_svg"),mainGroup=d3.select("#"+this.renderContainerId+"_mainGroup"),axisLabelOverlap=this.utility.draw_xAxisDummy(mainGroup,data.categories,height,width,this.renderContainerId);!axisLabelOverlap&&this.bottomMarginSet&&(this.margin.bottom/=2);var legend=new xChart.legend(data.series,color),legendRows=legend.drawLegend("top",mainGroup,width,this.margin)+1;this.margin.top=20*legendRows,mainGroup.selectAll(".legendg").remove(),height=this.canvasHeight-this.margin.top-this.margin.bottom,svg.attr("width",width+this.margin.left+this.margin.right).attr("height",height+this.margin.top+this.margin.bottom),mainGroup.attr("transform","translate("+this.margin.left+","+this.margin.top+")"),svg=mainGroup,legend.drawLegend("top",svg,width,this.margin);var formatPercent=d3.format(".0%");data.series.forEach(function(d,i){d.color=color[i]}),this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="bottom",categoryAxisOptions.position="horizontal",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.xAxis=this.categoryAxis.draw(categoryScale,{x:0,y:height}),this.seriesAxis=new xChart.axis(this.renderContainerId,width,height);var seriesAxisOptions={};seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=width,seriesAxisOptions.orient="left",seriesAxisOptions.position="vertical",seriesAxisOptions.showPath=!1,seriesAxisOptions.tickFormat=formatPercent,this.seriesAxis.setOptions(seriesAxisOptions);var seriesScale=this.seriesAxis.addQuantitativeScale(data.series,.1,0,height);this.yAxis=this.seriesAxis.draw(seriesScale);var area=d3.svg.area().interpolate("linear").x(function(d){return categoryScale(d.category)+categoryScale.rangeBand()/2}).y0(function(d){return seriesScale(d.y0)}).y1(function(d){return seriesScale(d.y0+d.y)}),stack=d3.layout.stack().values(function(d){return d.values});svg.selectAll(".layerg").remove(),svg.selectAll(".areacircle").remove();var stackData=data.series.map(function(d,i){return{name:d.name,color:d.color,values:data.categories.map(function(e,j){var sum=findSum(j);return{seriesLongName:data.series[i].longName,fmtData:data.series[i].fmtData[j],categoryLongName:e.longName,index:j,seriesIndex:i,category:e.name,categoryDimName:e.dimName,categoryName:e.name,y:d.data[j]/sum}})}});stackData.forEach(function(d){d.values.forEach(function(x){isNaN(x.y)&&(x.y=0),x.fmtData="0"})});var layerGroup=svg.selectAll(".layerg").data(stack(stackData)).enter().append("g").attr("class","layerg"),thisobj=this;layerGroup.append("path").attr("class","area").attr("d",area(stackData[0].values)).style("stroke",function(d,i){return d.color}).style("fill",function(d,i){return d.color}).transition().duration(1e3).attr("d",function(d){return area(d.values)}).each("end",function(){for(var i=0;i<stack(stackData).length;i++)svg.selectAll(".circle"+i).data(stack(stackData)[i].values).enter().append("circle").attr("class","areacircle circle"+i).attr("cx",function(d){return categoryScale(d.category)+categoryScale.rangeBand()/2}).attr("cy",height).attr("r",4).style("stroke",color[i]).style("stroke-width",.5).style("fill","#fff").transition().delay(function(d){return 100*i}).duration(1e3).attr("cy",function(d){return seriesScale(d.y+d.y0)});thisobj.dispatch.RenderComplete(data,stack(stackData),thisobj),thisobj.utility.tooltip(svg,".areacircle",!0,!1)})},area.prototype.drawOverlap=function(data,originalData){var overlappedData=this.utility.overlapDataPrep(data,originalData);this.redraw(overlappedData)},area.prototype.removeOverlap=function(data){this.redraw(data)},area}(),xChart.bubble=function(){function bubble(renderContainerId,color,chartOptions){this.renderContainerId=renderContainerId,this.canvasWidth=document.getElementById(this.renderContainerId).offsetWidth,this.canvasHeight=document.getElementById(this.renderContainerId).offsetHeight,this.margin=jQuery.extend(!0,{},chartOptions.margin),this.color=color,this.utility=new xChart.utility}return bubble.prototype.dispatch=d3.dispatch("RenderComplete"),bubble.prototype.draw=function(data){var margin=this.margin,color=this.color;$("#"+this.renderContainerId+"_svg").remove();var width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId).append("svg").attr("id",this.renderContainerId+"_svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).attr("class","bubbleChart"),mainGroup=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").attr("id",this.renderContainerId+"_mainGroup").attr("class","bubbleChart"),axisLabelOverlap=this.utility.draw_xAxisDummy(mainGroup,data.categories,height,width,this.renderContainerId);axisLabelOverlap&&(margin.bottom*=2,this.bottomMarginSet=!0),height=this.canvasHeight-margin.top-margin.bottom;var si=d3.format(".2s"),siMod=function(val){return si(val).replace(/G/,"B")},singleMeasure=0;data.series.length<2&&(data.series[1]=data.series[0],singleMeasure=1),this.utility.addRadialFilter(svg,this.renderContainerId);
var yScale=d3.scale.linear().range([height,0]);yScale.domain([0,d3.max(data.series[0].data)+.3*d3.max(data.series[0].data)]),this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="bottom",categoryAxisOptions.position="horizontal",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.xAxis=this.categoryAxis.draw(categoryScale,{x:0,y:height}),this.seriesAxis=new xChart.axis(this.renderContainerId,width,height);var seriesAxisOptions={};seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=width,seriesAxisOptions.orient="left",seriesAxisOptions.position="vertical",seriesAxisOptions.showPath=!1,seriesAxisOptions.tickFormat=siMod,seriesAxisOptions.calculate="auto",this.seriesAxis.setOptions(seriesAxisOptions);var seriesScale=this.seriesAxis.addQuantitativeScale(data.series,.3);this.yAxis=this.seriesAxis.draw(seriesScale);var rScale=d3.scale.linear().range([.05*Math.min(height,width),.15*Math.min(height,width)]).domain([d3.min(data.series[1].data),d3.max(data.series[1].data)]);this.rScale=rScale,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mainGroup.attr("transform","translate("+margin.left+","+margin.top+")"),svg=mainGroup,svg.append("g").attr("transform","translate(0,0)").append("text").attr("id",this.renderContainerId+"_bubbleDescText").style("font-family","sans-serif").style("font-size","10");var text_node=d3.select("#"+this.renderContainerId+"_bubbleDescText"),maxTextWidth="";text_node.append("tspan").text("CIRCLE SIZE SHOWS "+data.series[1].longName.toUpperCase()).attr("x",0).attr("y",0).attr("dy","8"),text_node.append("tspan").text("VERTICAL POSITION SHOWS "+data.series[0].longName.toUpperCase()).attr("x",0).attr("y",0).attr("dy","20"),svg.selectAll("#"+this.renderContainerId+"_bubbleDescText tspan")[0].forEach(function(d){maxTextWidth=d.getBBox().width}),text_node.attr("transform","translate("+(width-maxTextWidth)+",-"+(margin.top-10)+")");var bubbleData=data.categories.map(function(d,i){for(var rArray=[],x=0;x<data.series.length;x++)rArray.push({index:i,seriesIndex:x,seriesName:data.series[x].name,seriesValue:data.series[x].value,data:data.series[x].data[i],fmtData:data.series[x].fmtData[i],seriesLongName:data.series[x].longName,categoryLongName:d.longName,categoryValue:d.value,categoryDimName:d.dimName,categoryName:d.name});return rArray});bubbleData.forEach(function(d){d.categoryDimName=d[0].categoryDimName,d.categoryValue=d[0].categoryValue,d.categoryLongName=d[0].categoryLongName,d.categoryName=d[0].categoryName,d.categoryIndex=d[0].index,d.index=d[0].index,d.seriesIndex=d[0].seriesIndex,d.seriesValue=d[0].seriesValue,d.data=d[0].data,d.fmtData=d[0].fmtData,d.seriesLongName=d[0].seriesLongName});var bubbles=svg.selectAll("circle").data(bubbleData).enter().insert("circle").attr("cx",function(d,i){return categoryScale(d[0].categoryName)+categoryScale.rangeBand()/2}).attr("cy",function(d){return seriesScale(d[0].data)}).attr("r","0").style("fill",function(d){return color[0]}).style("opacity","0.8").attr("class","bubble");bubbles.transition().delay(function(d,i){return 100*i}).duration(500).attr("r",function(d){return rScale(d[1].data)}).each("end",function(d){d[0].index===data.categories.length-1&&this.dispatch.RenderComplete(data,this)}.bind(this)),this.utility.tooltip(svg,".bubble",!0,!1),"undefined"!=typeof data.chartTitle&&null!==data.chartTitle&&""!==data.chartTitle&&svg.append("text").attr("transform","translate("+width/2+" ,0)").style("text-anchor","middle").attr("class","chartTitle").text(data.chartTitle),1==singleMeasure&&data.series.splice(1,1)},bubble.prototype.redraw=function(data){var margin=this.margin,color=this.color;$("#"+this.renderContainerId+"_svg").remove();var width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId).append("svg").attr("id",this.renderContainerId+"_svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mainGroup=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").attr("id",this.renderContainerId+"_mainGroup").attr("class","bubbleChart"),axisLabelOverlap=this.utility.draw_xAxisDummy(mainGroup,data.categories,height,width,this.renderContainerId);!axisLabelOverlap&&this.bottomMarginSet&&(margin.bottom/=2),height=this.canvasHeight-margin.top-margin.bottom;var si=d3.format(".2s"),siMod=function(val){return si(val).replace(/G/,"B")},singleMeasure=0;data.series.length<2&&(data.series[1]=data.series[0],singleMeasure=1),this.utility.addRadialFilter(svg,this.renderContainerId);var yScale=d3.scale.linear().range([height,0]);yScale.domain([0,d3.max(data.series[0].data)+.3*d3.max(data.series[0].data)]),this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="bottom",categoryAxisOptions.position="horizontal",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.xAxis=this.categoryAxis.draw(categoryScale,{x:0,y:height}),this.seriesAxis=new xChart.axis(this.renderContainerId,width,height);var seriesAxisOptions={};seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=width,seriesAxisOptions.orient="left",seriesAxisOptions.position="vertical",seriesAxisOptions.showPath=!1,seriesAxisOptions.tickFormat=siMod,seriesAxisOptions.calculate="auto",this.seriesAxis.setOptions(seriesAxisOptions);var seriesScale=this.seriesAxis.addQuantitativeScale(data.series,.3);this.yAxis=this.seriesAxis.draw(seriesScale);var rScale=d3.scale.linear().range([.05*Math.min(height,width),.15*Math.min(height,width)]).domain([d3.min(data.series[1].data),d3.max(data.series[1].data)]);svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mainGroup.attr("transform","translate("+margin.left+","+margin.top+")"),svg=mainGroup,svg.append("g").attr("transform","translate(0,0)").append("text").attr("id",this.renderContainerId+"_bubbleDescText").style("font-family","sans-serif").style("font-size","10");var text_node=d3.select("#"+this.renderContainerId+"_bubbleDescText"),maxTextWidth="";text_node.append("tspan").text("CIRCLE SIZE SHOWS "+data.series[1].longName.toUpperCase()).attr("x",0).attr("y",0).attr("dy","8"),text_node.append("tspan").text("VERTICAL POSITION SHOWS "+data.series[0].longName.toUpperCase()).attr("x",0).attr("y",0).attr("dy","20"),svg.selectAll("#"+this.renderContainerId+"_bubbleDescText tspan")[0].forEach(function(d){maxTextWidth=d.getBBox().width}),text_node.attr("transform","translate("+(width-maxTextWidth)+",-"+(margin.top-10)+")");var bubbleData=data.categories.map(function(d,i){for(var rArray=[],x=0;x<data.series.length;x++)rArray.push({index:i,seriesIndex:x,seriesName:data.series[x].name,seriesValue:data.series[x].value,data:data.series[x].data[i],fmtData:data.series[x].fmtData[i],seriesLongName:data.series[x].longName,categoryLongName:d.longName,categoryValue:d.value,categoryDimName:d.dimName,categoryName:d.name});return rArray});bubbleData.forEach(function(d){d.categoryDimName=d[0].categoryDimName,d.categoryValue=d[0].categoryValue,d.categoryLongName=d[0].categoryLongName,d.categoryName=d[0].categoryName,d.categoryIndex=d[0].index,d.index=d[0].index,d.seriesIndex=d[0].seriesIndex,d.seriesValue=d[0].seriesValue,d.data=d[0].data,d.fmtData=d[0].fmtData,d.seriesLongName=d[0].seriesLongName});var bubbles=svg.selectAll("circle").data(bubbleData).enter().insert("circle").attr("cx",function(d,i){return categoryScale(d[0].categoryName)+categoryScale.rangeBand()/2}).attr("cy",function(d){return seriesScale(d[0].data)}).attr("r","0").style("fill",function(d){return color[0]}).style("opacity","0.8").attr("class","bubble");bubbles.transition().delay(function(d,i){return 100*i}).duration(500).attr("r",function(d){return rScale(d[1].data)}).each("end",function(d){d[0].index===data.categories.length-1&&this.dispatch.RenderComplete(data,this)}.bind(this)),this.utility.tooltip(svg,".bubble",!0,!1),"undefined"!=typeof data.chartTitle&&null!==data.chartTitle&&""!==data.chartTitle&&svg.append("text").attr("transform","translate("+width/2+" ,0)").style("text-anchor","middle").attr("class","chartTitle").text(data.chartTitle),1==singleMeasure&&data.series.splice(1,1)},bubble.prototype.drawOverlap=function(overlappedData,originalData){overlappedData=this.utility.overlapDataPrep(overlappedData,originalData),this.redraw(overlappedData)},bubble.prototype.removeOverlap=function(data){this.redraw(data)},bubble}(),xChart.gauge=function(){function gauge(renderContainerId,color,chartOptions){this.renderContainerId=renderContainerId,this.canvasWidth=document.getElementById(this.renderContainerId).offsetWidth,this.canvasHeight=document.getElementById(this.renderContainerId).offsetHeight,this.margin={top:20,right:0,bottom:0,left:20},this.configuration=chartOptions.gaugeConfiguration}return gauge.prototype.dispatch=d3.dispatch("RenderComplete"),gauge.prototype.draw=function(data){function buildPointerPath(value){function valueToPoint(value,factor){var point=valueToP(value,factor);return point.x-=config.cx,point.y-=config.cy,point}var delta=config.range/13,head=valueToPoint(value,.85),head1=valueToPoint(value-delta,.12),head2=valueToPoint(value+delta,.12),tailValue=value-config.range*(1/.75)/2,tail=valueToPoint(tailValue,.28),tail1=valueToPoint(tailValue-delta,.12),tail2=valueToPoint(tailValue+delta,.12);return[head,head1,tail2,tail,tail1,head2,head]}function drawBand(start,end,color){0>=end-start||body.append("svg:path").style("fill",color).style("opacity","0.5").attr("d",d3.svg.arc().startAngle(valueToRadians(start)).endAngle(valueToRadians(end)).innerRadius(.65*config.raduis).outerRadius(.85*config.raduis)).attr("transform",function(){return"translate("+config.cx+", "+config.cy+") rotate(270)"})}function redraw(value,transitionDuration){var pointerContainer=body.select(".pointerContainer");pointerContainer.selectAll("text").text(Math.round(value));var pointer=pointerContainer.selectAll("path");pointer.transition().duration(void 0!=transitionDuration?transitionDuration:config.transitionDuration).attrTween("transform",function(){var pointerValue=value;value>config.max?pointerValue=config.max+.02*config.range:value<config.min&&(pointerValue=config.min-.02*config.range);var targetRotation=valueToDegrees(pointerValue)-90,currentRotation=_currentRotation||targetRotation;return _currentRotation=targetRotation,function(step){var rotation=currentRotation+(targetRotation-currentRotation)*step;return"translate("+config.cx+", "+config.cy+") rotate("+rotation+")"}})}function valueToDegrees(value){return value/config.range*270-(config.min/config.range*270+45)}function valueToRadians(value){return valueToDegrees(value)*Math.PI/180}function valueToP(value,factor){return{x:config.cx-config.raduis*factor*Math.cos(valueToRadians(value)),y:config.cy-config.raduis*factor*Math.sin(valueToRadians(value))}}var margin=this.margin,renderContainerId=this.renderContainerId,configuration=this.configuration;$("#"+this.renderContainerId+"_svg").remove();var w=this.canvasWidth-this.margin.left-this.margin.right,h=this.canvasHeight-this.margin.top-this.margin.bottom,r=Math.min(w,h),config=configuration;config.size=.95*r,config.raduis=.95*r/2,config.cx=r/2+(w-h)/2,config.cy=r/2+margin.top,config.min=void 0!=configuration.min?configuration.min:0,config.max=void 0!=configuration.max?configuration.max:100,config.range=config.max-config.min,config.actualValue=configuration.actualValue,config.targetValue=configuration.targetValue,config.majorTicks=configuration.majorTicks||5,config.minorTicks=configuration.minorTicks||2,config.greenColor=configuration.greenColor||"#109618",config.yellowColor=configuration.yellowColor||"#FF9900",config.redColor=configuration.redColor||"#DC3912",config.transitionDuration=configuration.transitionDuration||500;var _currentRotation="",body=d3.select("#"+renderContainerId).append("svg:svg").attr("id",renderContainerId+"_svg").attr("width",this.canvasWidth).attr("height",this.canvasHeight).attr("transform","translate("+margin.left+","+margin.top+")").attr("class","gauge"),text_node=body.append("g").attr("transform","translate(10,10)").style("display","none").append("text").attr("id",renderContainerId+"_textLabel").style("font-family","sans-serif").style("font-size","12");text_node.append("tspan").text("ACTUAL VALUE : "+config.actualValue).attr("x",0).attr("y",0).attr("dy","0");text_node.append("tspan").text("TARGET VALUE : "+config.targetValue).attr("x",0).attr("y",0).attr("dy",12),body.append("svg:circle").attr("cx",config.cx).attr("cy",config.cy).attr("r",config.raduis).style("fill","#ccc").style("stroke","#000").style("display","none").style("stroke-width","0.5px"),body.append("svg:circle").attr("cx",config.cx).attr("cy",config.cy).attr("r",.9*config.raduis).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width","2px");for(var index in config.greenZones)drawBand(config.greenZones[index].from,config.greenZones[index].to,config.greenColor);for(var index in config.yellowZones)drawBand(config.yellowZones[index].from,config.yellowZones[index].to,config.yellowColor);for(var index in config.redZones)drawBand(config.redZones[index].from,config.redZones[index].to,config.redColor);if(void 0!=config.label){var fontSize=Math.round(config.size/9);body.append("svg:text").attr("x",config.cx).attr("y",config.cy/2+20).attr("dy",fontSize/2).attr("text-anchor","middle").text(config.label).style("display","none").style("font-size",fontSize+"px").style("fill","#333").style("stroke-width","0px")}for(var fontSize=Math.round(config.size/16),majorDelta=config.range/(config.majorTicks-1),major=config.min;major<=config.max;major+=majorDelta){for(var minorDelta=majorDelta/config.minorTicks,minor=major+minorDelta;minor<Math.min(major+majorDelta,config.max);minor+=minorDelta){var point1=valueToP(minor,.75),point2=valueToP(minor,.85);body.append("svg:line").attr("x1",point1.x).attr("y1",point1.y).attr("x2",point2.x).attr("y2",point2.y).style("display","none").style("stroke","#666").style("stroke-width","1px")}var point1=valueToP(major,.7),point2=valueToP(major,.85);if(body.append("svg:line").attr("x1",point1.x).attr("y1",point1.y).attr("x2",point2.x).attr("y2",point2.y).style("display","none").style("stroke","#333").style("stroke-width","2px"),major==config.min||major==config.max){var point=valueToP(major,.63);body.append("svg:text").attr("x",point.x).attr("y",point.y).attr("dy",fontSize/3).attr("text-anchor",major==config.min?"start":"end").text(major).style("font-size",fontSize+"px").style("fill","#333").style("stroke-width","0px")}}var pointerContainer=body.append("svg:g").attr("class","pointerContainer"),midValue=(config.min+config.max)/2,pointerPath=buildPointerPath(midValue),pointerLine=d3.svg.line().x(function(d){return d.x}).y(function(d){return d.y}).interpolate("basis");pointerContainer.selectAll("path").data([pointerPath]).enter().append("svg:path").attr("d",pointerLine).style("fill","#03A9F4").style("stroke","#03A9F4").style("fill-opacity",.7),pointerContainer.append("svg:circle").attr("cx",config.cx).attr("cy",config.cy).attr("r",.12*config.raduis).style("fill","#03A9F4").style("opacity",.7);var fontSize=Math.round(config.size/10);pointerContainer.selectAll("text").data([midValue]).enter().append("svg:text").attr("x",config.cx).attr("y",config.size-config.cy/4-fontSize+margin.top).attr("dy",fontSize/2).attr("text-anchor","middle").style("font-size",fontSize+"px").style("fill","#000").style("stroke-width","0px"),redraw(config.min,0),redraw(config.actualValue,1e3)},gauge.prototype.redraw=function(data){this.draw(data)},gauge.prototype.drawOverlap=function(data,originalData){this.draw(data)},gauge.prototype.removeOverlap=function(data){this.draw(data)},gauge}(),xChart.groupedBar=function(){function groupedBar(renderContainerId,color,chartOptions){this.renderContainerId=renderContainerId,this.canvasWidth=document.getElementById(this.renderContainerId).offsetWidth,this.canvasHeight=document.getElementById(this.renderContainerId).offsetHeight,this.margin=jQuery.extend(!0,{},chartOptions.margin),this.color=color,this.margin.left=80,this.utility=new xChart.utility}return groupedBar.prototype.dispatch=d3.dispatch("RenderComplete"),groupedBar.prototype.draw=function(data){var color=this.color,margin=this.margin;$("#"+this.renderContainerId+"_svg").remove();var width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId).append("svg").attr("id",this.renderContainerId+"_svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).attr("class","groupedBar"),mainGroup=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").attr("id",this.renderContainerId+"_mainGroup").attr("class","groupedBar"),legend=new xChart.legend(data.series,color),legendRows=legend.drawLegend("top",mainGroup,width,margin)+1;margin.top=20*legendRows,mainGroup.selectAll(".legendg").remove(),height=this.canvasHeight-margin.top-margin.bottom,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mainGroup.attr("transform","translate("+margin.left+","+margin.top+")"),svg=mainGroup,legend.drawLegend("top",svg,width,margin);var si=d3.format(".2s"),siMod=function(val){return si(val).replace(/G/,"B")};this.utility.addLinearFilter(svg,this.renderContainerId);var xMax=d3.max(data.series,function(d){return d3.max(d.data)});this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="left",categoryAxisOptions.position="vertical",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.yAxis=this.categoryAxis.draw(categoryScale),this.seriesAxis=new xChart.axis(this.renderContainerId,width,height);var seriesAxisOptions={};seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=height,seriesAxisOptions.orient="bottom",seriesAxisOptions.position="horizontal",seriesAxisOptions.showPath=!1,seriesAxisOptions.tickFormat=siMod,this.seriesAxis.setOptions(seriesAxisOptions);var seriesScale=this.seriesAxis.addQuantitativeScale(data.series,.1,width,0,0,xMax);this.yAxis=this.seriesAxis.draw(seriesScale,{x:0,y:height});var subCategoryScale=d3.scale.ordinal().domain(data.series.map(function(d){return d.value})).rangeRoundBands([0,categoryScale.rangeBand()]);this.subCategoryScale=subCategoryScale;var groups=svg.selectAll(".group").data(data.categories).enter().append("g").attr("class","group").attr("transform",function(d){return"translate(0,"+categoryScale(d.value)+")"}),bars=groups.selectAll("rect").data(function(d,i){for(var rArray=[],x=0;x<data.series.length;x++)rArray.push({seriesName:data.series[x].name,seriesValue:data.series[x].value,data:data.series[x].data[i],fmtData:data.series[x].fmtData[i],index:i,seriesIndex:x,seriesLongName:data.series[x].longName,category:d,categoryLongName:d.longName,categoryValue:d.value,categoryDimName:d.dimName,categoryName:d.name});return rArray});bars.enter().append("rect").attr("class","bar").attr("rx",1).attr("ry",1).attr("x",function(d){return 0}).attr("y",function(d){return subCategoryScale(d.seriesName)}).attr("height",function(d){return subCategoryScale.rangeBand()-2}).attr("width",0).style("fill",function(d,i){return color[i]}),bars.transition().ease("bounce").duration(1e3).attr("width",function(d){return seriesScale(d.data)}).each("end",function(d){d.index===data.categories.length-1&&d.seriesIndex==data.series.length-1&&this.dispatch.RenderComplete(data,this)}.bind(this)),this.utility.tooltip(svg,".bar",!0,!1)},groupedBar.prototype.redraw=function(data){function redrawBars(that){var groups=svg.selectAll(".group").data(data.categories).enter().append("g").attr("class","group").attr("transform",function(d){return"translate(0,"+categoryScale(d.value)+")"}),bars=groups.selectAll("rect").data(function(d,i){for(var rArray=[],x=0;x<data.series.length;x++)rArray.push({seriesName:data.series[x].name,seriesValue:data.series[x].value,data:data.series[x].data[i],fmtData:data.series[x].fmtData[i],index:i,seriesIndex:x,seriesLongName:data.series[x].longName,category:d,categoryLongName:d.longName,categoryValue:d.value,categoryDimName:d.dimName,categoryName:d.name});return rArray});bars.enter().append("rect").attr("class","bar").attr("rx",1).attr("ry",1).attr("x",function(d){return 0}).attr("y",function(d){return subCategoryScale(d.seriesName)}).attr("height",function(d){return subCategoryScale.rangeBand()-2}).style("fill",function(d,i){return color[i]}).attr("width",function(d){return seriesScale(d.data)}).each(function(d){d.index===data.categories.length-1&&d.seriesIndex==data.series.length-1&&that.dispatch.RenderComplete(data,that)}.bind(that)),that.utility.tooltip(svg,".bar",!0,!1)}this.removeOverlap();var color=this.color,margin=this.margin,width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId+"_svg"),mainGroup=d3.select("#"+this.renderContainerId+"_mainGroup"),legend=new xChart.legend(data.series,color),legendRows=legend.drawLegend("top",mainGroup,width,margin)+1;margin.top=20*legendRows,mainGroup.selectAll(".legendg").remove(),height=this.canvasHeight-margin.top-margin.bottom,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mainGroup.attr("transform","translate("+margin.left+","+margin.top+")"),svg=mainGroup,legend.drawLegend("top",svg,width,margin);var si=d3.format(".2s"),siMod=function(val){return si(val).replace(/G/,"B")};this.utility.addLinearFilter(svg,this.renderContainerId);var xMax=d3.max(data.series,function(d){return d3.max(d.data)});this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="left",categoryAxisOptions.position="vertical",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.yAxis=this.categoryAxis.draw(categoryScale),this.seriesAxis=new xChart.axis(this.renderContainerId,width,height);var seriesAxisOptions={};seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=height,seriesAxisOptions.orient="bottom",seriesAxisOptions.position="horizontal",seriesAxisOptions.showPath=!1,seriesAxisOptions.tickFormat=siMod,this.seriesAxis.setOptions(seriesAxisOptions);var seriesScale=this.seriesAxis.addQuantitativeScale(data.series,.1,width,0,0,xMax);this.yAxis=this.seriesAxis.draw(seriesScale,{x:0,y:height});var subCategoryScale=d3.scale.ordinal().domain(data.series.map(function(d){return d.value})).rangeRoundBands([0,categoryScale.rangeBand()]);this.subCategoryScale=subCategoryScale;var groups=svg.selectAll(".group").data(data.categories);groups.exit().remove(),groups.enter().append("g").attr("class","group").attr("transform",function(d){return"translate(0,"+categoryScale(d.value)+")"}),groups.transition().duration(400).attr("transform",function(d){return"translate(0,"+categoryScale(d.value)+")"});var bars=groups.selectAll("rect").data(function(d,i){for(var rArray=[],x=0;x<data.series.length;x++)rArray.push({seriesName:data.series[x].name,seriesValue:data.series[x].value,data:data.series[x].data[i],fmtData:data.series[x].fmtData[i],index:i,seriesIndex:x,seriesLongName:data.series[x].longName,category:d,categoryLongName:d.longName,categoryValue:d.value,categoryDimName:d.dimName,categoryName:d.name});return rArray});bars.exit().remove(),bars.enter().append("rect").attr("class","bar").attr("rx",1).attr("ry",1).attr("x",function(d){return 0}).attr("width",0).style("fill",function(d,i){return color[i]}),bars.transition().ease("bounce").duration(1e3).attr("y",function(d){return subCategoryScale(d.seriesName)}).attr("height",function(d){return subCategoryScale.rangeBand()-2}).attr("width",function(d){return seriesScale(d.data)}).each("end",function(d){d.index===data.categories.length-1&&d.seriesIndex==data.series.length-1&&(svg.selectAll(".group").remove(),redrawBars(this))}.bind(this))},groupedBar.prototype.drawOverlap=function(overlappedData,originaldata){var overlappedData=this.utility.overlapDataPrep(overlappedData,originaldata),subCategoryScale=this.subCategoryScale,seriesScale=this.seriesAxis.scale,categoryScale=this.categoryAxis.scale,svg=d3.select("#"+this.renderContainerId+"_mainGroup");svg.selectAll(".bar").style("opacity",.7);var overlappedBars=svg.selectAll(".overlappedBar").data(overlappedData.categories).enter().append("g").attr("class","overlappedBar").attr("transform",function(d){return"translate(0,"+categoryScale(d.value)+")"});overlappedBars=svg.selectAll(".overlappedBar").selectAll("rect").data(function(d,i){for(var rArray=[],x=0;x<overlappedData.overlappedSeries.length;x++)rArray.push({seriesValue:overlappedData.overlappedSeries[x].value,seriesName:overlappedData.overlappedSeries[x].name,data:overlappedData.overlappedSeries[x].data[i][0],fmtData:overlappedData.overlappedSeries[x].fmtData[i][0],index:i,seriesLongName:overlappedData.overlappedSeries[x].longName,category:d,categoryLongName:d.longName,categoryValue:d.value,categoryDimName:d.dimName,categoryName:d.name});return rArray}),overlappedBars.enter().append("rect").attr("class","ObarRect").attr("rx",1).attr("ry",1).attr("x",0).attr("y",function(d){return subCategoryScale(d.seriesName)}).attr("height",function(d){return subCategoryScale.rangeBand()-2}).style("fill","#ffC200").style("stroke","black").style("stroke-width","0.3px").attr("width",0),overlappedBars.exit().remove(),overlappedBars.transition().duration(1e3).ease("bounce").attr("width",function(d){return seriesScale(d.data)}),this.utility.tooltip(svg,".ObarRect",!0,!1)},groupedBar.prototype.removeOverlap=function(data){var svg=(this.seriesAxis.scale,this.categoryAxis.scale,d3.select("#"+this.renderContainerId+"_mainGroup")),overlappedBars=svg.selectAll(".overlappedBar").data(function(d){var rArray=[];return rArray}).enter().append("g").attr("class","overlappedBar");overlappedBars=svg.selectAll(".overlappedBar").selectAll("rect").data(function(d,i){var rArray=[];return rArray}),overlappedBars.enter().append("rect"),overlappedBars.exit().transition().duration(1e3).ease("bounce").attr("width",0).remove().each("end",function(){svg.selectAll(".bar").style("opacity",1);var outerBars=svg.selectAll(".overlappedBar");outerBars.remove()})},groupedBar}(),xChart.groupedColumn=function(){function groupedColumn(renderContainerId,color,chartOptions){this.chartOptions=chartOptions,this.renderContainerId=renderContainerId,this.canvasWidth=document.getElementById(this.renderContainerId).offsetWidth,this.canvasHeight=document.getElementById(this.renderContainerId).offsetHeight,this.margin=jQuery.extend(!0,{},chartOptions.margin),this.color=color,this.axisRedrawThreshold=chartOptions.axisRedrawThreshold,this.aec=chartOptions.aec,this.overlapDraw=!1,this.utility=new xChart.utility}return groupedColumn.prototype.dispatch=d3.dispatch("RenderComplete"),groupedColumn.prototype.lineDraw=function(seriesForLineChart,data,that){for(var i=0;i<seriesForLineChart.length;i++)isNaN(seriesForLineChart[i].series.axis)&&(seriesForLineChart[i].series.axis=1);var svg=d3.select("#"+that.renderContainerId+"_mainGroup"),categoryScale=that.categoryAxis.scale,seriesScales=that.seriesScales,color=that.color;svg.selectAll("path.line").remove(),svg.selectAll("circle").remove();for(var series=seriesForLineChart.map(function(d){return d.series}),i=0;i<series.length;i++){var dataValues=series[i].data,fmtDataValues=series[i].fmtData,lineData=data.categories.map(function(d,j){return{category:d.name,longName:d.longName,value:d.value,series:series[i].longName,data:+dataValues[j],fmtData:fmtDataValues[j],axis:series[i].axis,categoryLongName:d.longName,seriesLongName:series[i].longName}}),line=d3.svg.line().interpolate("linear").x(function(d,i){return categoryScale(d.value)+categoryScale.rangeBand()/2}).y(function(d){return seriesScales[d.axis-1](d.data)});svg.append("path").datum(lineData).attr("class","line").attr("d",line).style("stroke",color[seriesForLineChart[i].index]).style("stroke-width","3").style("stroke-linejoin","round").style("stroke-linecap","square").style("fill","none"),svg.selectAll(".circle .circle"+i).data(lineData).enter().append("circle").attr("class","gCLinecircle circle"+i).attr("cx",function(d,i){return categoryScale(d.value)+categoryScale.rangeBand()/2}).attr("cy",function(d){return seriesScales[d.axis-1](d.data)}).attr("r","3").style("stroke-width","1").style("stroke",color[seriesForLineChart[i].index]).style("fill","#fff")}that.utility.tooltip(svg,".gCLinecircle",!0,!1),that.overlapDraw||that.dispatch.RenderComplete(data,that.seriesForChart,that)},groupedColumn.prototype.draw=function(data){var color=this.color,margin=this.margin,seriesScales=[];$("#"+this.renderContainerId+"_svg").remove();for(var left=30,right=10,yAxisCount=1,sIndex=0;sIndex<data.series.length;++sIndex)data.series[sIndex].axis&&data.series[sIndex].axis>1&&data.series[sIndex].axis>yAxisCount&&(yAxisCount++,yAxisCount%2===0?right+=40:left+=40);margin.right=right,margin.left=left;var width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId).append("svg").attr("id",this.renderContainerId+"_svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).attr("class","groupedColumn"),mainGroup=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").attr("id",this.renderContainerId+"_mainGroup").attr("class","groupedColumn"),axisLabelOverlap=this.utility.draw_xAxisDummy(mainGroup,data.categories,height,width,this.renderContainerId);axisLabelOverlap&&(margin.bottom*=2,this.bottomMarginSet=!0);var legend=new xChart.legend(data.series,color),legendRows=legend.drawLegend("top",mainGroup,width,margin)+1;margin.top=20*legendRows,mainGroup.selectAll(".legendg").remove(),height=this.canvasHeight-margin.top-margin.bottom,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mainGroup.attr("transform","translate("+margin.left+","+margin.top+")"),svg=mainGroup,legend.drawLegend("top",svg,width,margin);var si=d3.format(".2s"),siMod=function(val){return si(val).replace(/G/,"B")},prepData=this.utility.dataPrep(data),seriesForLineChart=prepData.seriesForLineChart,seriesForChart=prepData.seriesForChart,axesGroups=prepData.axesGroups;this.seriesForChart=seriesForChart,seriesForLineChart.length>0&&(this.seriesForLineChart=seriesForLineChart),this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="bottom",categoryAxisOptions.position="horizontal",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.xAxis=this.categoryAxis.draw(categoryScale,{x:0,y:height});var subCategoryScale=d3.scale.ordinal().domain(seriesForChart.map(function(d){return d.series.value})).rangeRoundBands([0,categoryScale.rangeBand()]);this.utility.addLinearFilter(svg,this.renderContainerId),this.subCategoryScale=subCategoryScale,this.seriesScales=seriesScales,this.seriesAxes=[];var seriesAxisOptions={};seriesAxisOptions.position="vertical",seriesAxisOptions.tickFormat=siMod;for(var i=0;i<axesGroups.length;i++){var maxY=d3.max(axesGroups[i],function(d){return d3.max(d.data)}),minY=d3.min(axesGroups[i],function(d){return d3.min(d.data)});minY>0&&(minY=0),minY=1.2*minY;var seriesAxis=new xChart.axis(this.renderContainerId,width,height),position={x:0,y:0},seriesScale="";
0===i?(seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=width,seriesAxisOptions.showPath=!1,seriesAxis.setOptions(seriesAxisOptions),seriesScale=seriesAxis.addQuantitativeScale(data.series,this.aec,0,height,minY,maxY)):i%2===0?(seriesAxisOptions.ticks="",seriesAxisOptions.tickSize="",seriesAxisOptions.showPath=!0,seriesAxis.setOptions(seriesAxisOptions),seriesScale=seriesAxis.addQuantitativeScale(data.series,this.aec,0,height,minY,maxY),position.x=0-margin.left+30*i):(seriesAxisOptions.ticks="",seriesAxisOptions.tickSize="",seriesAxisOptions.showPath=!0,seriesAxisOptions.orient="right",seriesAxis.setOptions(seriesAxisOptions),seriesScale=seriesAxis.addQuantitativeScale(data.series,.1,0,height,minY,maxY),position.x=width+20*(i-1)),seriesAxis.draw(seriesScale,position,this.renderContainerId+"_yaxis_"+i),this.seriesAxes.push(seriesAxis),seriesScales.push(seriesScale)}var outerGroup=svg.selectAll(".outerBar").data(data.categories).enter().append("g").attr("class","outerBar").attr("transform",function(d){return"translate("+categoryScale(d.value)+",0)"}),bars=outerGroup.selectAll("rect").data(function(d,i){for(var rArray=[],x=0;x<seriesForChart.length;x++)rArray.push({seriesName:seriesForChart[x].series.name,seriesIndex:seriesForChart[x].index,data:seriesForChart[x].series.data[i],fmtData:seriesForChart[x].series.fmtData[i],index:i,seriesLongName:seriesForChart[x].series.longName,seriesValue:seriesForChart[x].series.value,categoryLongName:d.longName,categoryName:d.name,categoryValue:d.value,categoryDimName:d.dimName,axis:seriesForChart[x].series.axis});return rArray});bars.enter().append("rect").attr("class","bar").attr("x",function(d){return subCategoryScale(d.seriesValue)}).attr("width",subCategoryScale.rangeBand()).attr("y",function(d){var yScale=seriesScales[d.axis-1];return yScale(0)}).attr("rx","1").attr("ry","1").attr("height",0).style("fill",function(d){return color[d.seriesIndex]}).style("opacity",1).transition().ease("bounce").duration(1e3).attr("y",function(d){if(d.data>=0){var yScale=seriesScales[d.axis-1];return yScale(d.data)}var yScale=seriesScales[d.axis-1];return yScale(0)}).attr("height",function(d){var yScale=seriesScales[d.axis-1];return Math.abs(yScale(d.data)-yScale(0))}).each("end",function(d){d.index===data.categories.length-1&&(seriesForLineChart.length>0?this.lineDraw(seriesForLineChart,data,this):d.seriesIndex===data.series.length-1&&this.dispatch.RenderComplete(data,seriesForChart,this))}.bind(this)),this.utility.tooltip(svg,".bar",!0,!1)},groupedColumn.prototype.redraw=function(data){function redrawBars(that){var outerGroup=svg.selectAll(".outerBar").data(data.categories).enter().append("g").attr("class","outerBar").attr("transform",function(d){return"translate("+categoryScale(d.value)+",0)"}),bars=outerGroup.selectAll("rect").data(function(d,i){for(var rArray=[],x=0;x<seriesForChart.length;x++)rArray.push({seriesName:seriesForChart[x].series.name,seriesIndex:seriesForChart[x].index,data:seriesForChart[x].series.data[i],fmtData:seriesForChart[x].series.fmtData[i],index:i,seriesLongName:seriesForChart[x].series.longName,seriesValue:seriesForChart[x].series.value,categoryLongName:d.longName,categoryName:d.name,categoryValue:d.value,categoryDimName:d.dimName,axis:seriesForChart[x].series.axis});return rArray});bars.enter().append("rect").attr("class","bar").attr("x",function(d){return subCategoryScale(d.seriesValue)}).attr("width",subCategoryScale.rangeBand()).attr("rx","1").attr("ry","1").style("fill",function(d){return color[d.seriesIndex]}).style("opacity",1).attr("y",function(d){if(d.data>=0){var yScale=seriesScales[d.axis-1];return yScale(d.data)}var yScale=seriesScales[d.axis-1];return yScale(0)}).attr("height",function(d){var yScale=seriesScales[d.axis-1];return Math.abs(yScale(d.data)-yScale(0))}).each(function(d){d.index===data.categories.length-1&&(seriesForLineChart.length>0?that.lineDraw(seriesForLineChart,data,that):d.seriesIndex===data.series.length-1&&that.dispatch.RenderComplete(data,seriesForChart,that))}.bind(that)),that.utility.tooltip(svg,".bar",!0,!1),svg.selectAll(".bar")[0].forEach(function(d){d3.select(d).style("opacity",1).attr("filter","")})}var color=this.color,margin=this.margin,width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId+"_svg"),mainGroup=d3.select("#"+this.renderContainerId+"_mainGroup");this.removeOverlap(data);var axisLabelOverlap=this.utility.draw_xAxisDummy(mainGroup,data.categories,height,width,this.renderContainerId);!axisLabelOverlap&&this.bottomMarginSet&&(margin.bottom/=2);var legend=new xChart.legend(data.series,color),legendRows=legend.drawLegend("top",mainGroup,width,margin)+1;margin.top=20*legendRows,mainGroup.selectAll(".legendg").remove(),height=this.canvasHeight-margin.top-margin.bottom,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mainGroup.attr("transform","translate("+margin.left+","+margin.top+")"),svg=mainGroup,legend.drawLegend("top",svg,width,margin);var prepData=(d3.format(".2s"),this.utility.dataPrep(data)),seriesForLineChart=prepData.seriesForLineChart,seriesForChart=prepData.seriesForChart,axesGroups=prepData.axesGroups;this.seriesForChart=seriesForChart,seriesForLineChart.length>0&&(this.seriesForLineChart=seriesForLineChart),this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="bottom",categoryAxisOptions.position="horizontal",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.xAxis=this.categoryAxis.draw(categoryScale,{x:0,y:height});var subCategoryScale=d3.scale.ordinal().domain(seriesForChart.map(function(d){return d.series.value})).rangeRoundBands([0,categoryScale.rangeBand()]);this.subCategoryScale=subCategoryScale;for(var seriesScales=[],i=0;i<axesGroups.length;i++){var maxY=d3.max(axesGroups[i],function(d){return d3.max(d.data)}),minY=d3.min(axesGroups[i],function(d){return d3.min(d.data)});minY>0&&(minY=0),minY=1.2*minY;var seriesAxis=this.seriesAxes[i],previousMaxY=seriesAxis.scale.domain()[1]/(1+this.aec),position={x:0,y:0},seriesScale="";0===i?position=position:i%2===0?position.x=0-margin.left+30*i:position.x=width+20*(i-1),Math.abs((previousMaxY-maxY)/maxY)>this.axisRedrawThreshold?(seriesScale=seriesAxis.addQuantitativeScale(data.series,this.aec,0,height,minY,maxY),seriesAxis.draw(seriesScale,position,this.renderContainerId+"_yaxis_"+i),this.seriesAxes[i]=seriesAxis,seriesScales.push(seriesScale)):seriesScales.push(seriesAxis.scale)}this.seriesScales=seriesScales;var outerGroup=svg.selectAll(".outerBar").data(data.categories);outerGroup.exit().remove(),outerGroup.enter().append("g").attr("class","outerBar").attr("transform",function(d){return"translate("+categoryScale(d.value)+",0)"}),outerGroup.transition().duration(400).attr("transform",function(d){return"translate("+categoryScale(d.value)+",0)"});var bars=outerGroup.selectAll(".bar").data(function(d,i){for(var rArray=[],x=0;x<seriesForChart.length;x++)rArray.push({seriesName:seriesForChart[x].series.name,seriesIndex:seriesForChart[x].index,data:seriesForChart[x].series.data[i],fmtData:seriesForChart[x].series.fmtData[i],index:i,seriesLongName:seriesForChart[x].series.longName,seriesValue:seriesForChart[x].series.value,categoryLongName:d.longName,categoryName:d.name,categoryValue:d.value,categoryDimName:d.dimName,axis:seriesForChart[x].series.axis});return rArray});bars.exit().remove(),bars.enter().append("rect").attr("class","bar").attr("x",function(d){return subCategoryScale(d.seriesValue)}).attr("y",height).attr("rx","1").attr("ry","1").attr("height",0).style("fill",function(d){return color[d.seriesIndex]}).style("opacity",1),bars.transition().ease("bounce").duration(1e3).attr("x",function(d){return subCategoryScale(d.seriesValue)}).attr("y",function(d){if(d.data>=0){var yScale=seriesScales[d.axis-1];return yScale(d.data)}var yScale=seriesScales[d.axis-1];return yScale(0)}).attr("height",function(d){var yScale=seriesScales[d.axis-1];return Math.abs(yScale(d.data)-yScale(0))}).attr("width",subCategoryScale.rangeBand()).each("end",function(d){d.index===data.categories.length-1&&d.seriesIndex===data.series.length-1&&(svg.selectAll(".outerBar").remove(),redrawBars(this))}.bind(this))},groupedColumn.prototype.drawOverlap=function(OverlappedData,originalData){OverlappedData=this.utility.overlapDataPrep(OverlappedData,originalData);var prepData=this.utility.dataPrep(originalData);this.seriesForLineChart=prepData.seriesForLineChart,this.overlapDraw=!0;for(var overSeries=OverlappedData.overlappedSeries,i=0;i<originalData.series.length;i++)isNaN(originalData.series[i].axis)&&(originalData.series[i].axis=1);for(var i=0;i<overSeries.length;i++)overSeries[i].data=d3.merge(overSeries[i].data),overSeries[i].fmtData=d3.merge(overSeries[i].fmtData);for(var seriesForLineChart=[],i=0;i<OverlappedData.series.length;i++)if(1==OverlappedData.series[i].line){var obj={};obj.series=jQuery.extend(!0,{},overSeries[i]),obj.index=i,seriesForLineChart.push(obj);for(var j=0;j<overSeries[i].data.length;j++)overSeries[i].data[j]=0}this.seriesForLineChart=seriesForLineChart;var margin=this.margin,categoryScale=(this.canvasHeight-margin.top-margin.bottom,this.categoryAxis.scale),seriesScales=this.seriesScales,svg=d3.select("#"+this.renderContainerId+"_mainGroup"),subCategoryScale=this.subCategoryScale;svg.selectAll("path.line").remove(),svg.selectAll("circle").remove(),svg.selectAll(".bar").style("opacity",.7);var overlappedBar=svg.selectAll(".overlappedBar").data(originalData.categories).enter().append("g").attr("class","overlappedBar").attr("transform",function(d){return"translate("+categoryScale(d.value)+",0)"});overlappedBar=svg.selectAll(".overlappedBar").selectAll("rect").data(function(d,i){for(var rArray=[],x=0;x<overSeries.length;x++)rArray.push({seriesName:overSeries[x].name,seriesIndex:x,data:overSeries[x].data[i],fmtData:overSeries[x].fmtData[i],index:i,seriesLongName:overSeries[x].longName,seriesValue:overSeries[x].value,categoryLongName:d.longName,categoryName:d.name,categoryDimName:d.dimName,axis:originalData.series[x].axis});return rArray}),overlappedBar.enter().append("rect").attr("class","ObarRect").attr("x",function(d){return subCategoryScale(d.seriesName)}).attr("y",function(d){var yScale=seriesScales[d.axis-1];return yScale(0)}).attr("height",0).attr("width",subCategoryScale.rangeBand()).attr("rx","1").attr("ry","1").style("fill","#FFC200").style("opacity",1).style("stroke","black").style("stroke-width",".3px"),overlappedBar.exit().remove(),overlappedBar.transition().duration(1e3).ease("bounce").attr("y",function(d){if(d.data>=0){var yScale=seriesScales[d.axis-1];return yScale(d.data)}var yScale=seriesScales[d.axis-1];return yScale(0)}).attr("height",function(d){var yScale=seriesScales[d.axis-1];return Math.abs(yScale(d.data)-yScale(0))}).each("end",function(d){d.index===originalData.categories.length-1&&this.seriesForLineChart.length>0&&this.lineDraw(this.seriesForLineChart,originalData,this)}.bind(this)),this.utility.tooltip(svg,".ObarRect",!0,!1)},groupedColumn.prototype.removeOverlap=function(data){var margin=this.margin,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId+"_mainGroup");svg.selectAll("path.line").remove(),svg.selectAll("circle").remove();var prepData=this.utility.dataPrep(data);this.seriesForLineChart=prepData.seriesForLineChart;var overlappedBar=svg.selectAll(".overlappedBar").selectAll("rect").data(function(d){var rArray=[];return rArray}),seriesScales=this.seriesScales;overlappedBar.enter().append("rect").attr("y",function(d){var seriesScale=seriesScales[d.axis-1];return seriesScale(d.data)}).attr("height",function(d){var seriesScale=seriesScales[d.axis-1];return height-seriesScale(d.data)}),overlappedBar.exit().transition().duration(1e3).ease("bounce").attr("y",function(d){var yScale=seriesScales[d.axis-1];return yScale(0)}).attr("height",0).remove().each("end",function(){svg.selectAll(".bar").style("opacity",1);var outerBars=svg.selectAll(".overlappedBar");outerBars.remove(),this.lineDraw(this.seriesForLineChart,data,this)}.bind(this)),this.overlapDraw=!1},this.redrawBars=function(){console.log("hhell")},groupedColumn}(),xChart.kpi=function(){function kpi(renderContainerId,color,chartOptions){this.renderContainerId=renderContainerId,this.canvasWidth=document.getElementById(this.renderContainerId).offsetWidth,this.canvasHeight=document.getElementById(this.renderContainerId).offsetHeight,this.margin={top:20,right:0,bottom:0,left:20},this.configuration=chartOptions.gaugeConfiguration,this.utility=new xChart.utility}return kpi.prototype.dispatch=d3.dispatch("RenderComplete"),kpi.prototype.draw=function(data){function drawOuterBand(start,end,color,innerRadius,outerRadius){if(!(0>=end-start)){var data=Math.round((end-start)/config.range*100);kpiBody.append("path").data([data]).style("fill",color).style("opacity","0.8").attr("class","kpi").attr("d",d3.svg.arc().startAngle(valueToRadians(start)).endAngle(valueToRadians(end)).innerRadius(innerRadius).outerRadius(outerRadius)).attr("transform",function(){return"translate("+config.cx+", "+config.cy+") rotate(270)"})}}function redraw(value,transitionDuration){var pointerContainer=kpiBody.select(".pointerContainer");config.valueFlag?pointerContainer.select("text").transition().duration(1e3).tween("text",function(d){var i=d3.interpolate(this.textContent,d);return function(t){this.textContent=d3.format("0.3s")(Math.round(i(t))).toUpperCase()}}):pointerContainer.selectAll("text").text("No value");var pointer=pointerContainer.selectAll("path");pointer.transition().duration(void 0!=transitionDuration?transitionDuration:config.transitionDuration).attrTween("transform",function(){var pointerValue=value;value>config.max?pointerValue=config.max+.02*config.range:value<config.min&&(pointerValue=config.min-.02*config.range);var targetRotation=valueToDegrees(pointerValue)-90,currentRotation=_currentRotation||targetRotation;return _currentRotation=targetRotation,function(step){var rotation=currentRotation+(targetRotation-currentRotation)*step;return"translate("+config.cx+", "+config.cy+") rotate("+rotation+")"}})}function valueToDegrees(value){return value/config.range*180-config.min/config.range*180}function valueToRadians(value){return valueToDegrees(value)*Math.PI/180}function valueToP(value,factor){return{x:config.cx-config.radius*factor*Math.cos(valueToRadians(value)),y:config.cy-config.radius*factor*Math.sin(valueToRadians(value))}}var margin=this.margin,renderContainerId=this.renderContainerId,configuration=jQuery.extend(!0,{},data.gaugeConfiguration);$("#"+this.renderContainerId+"_svg").remove();var w=this.canvasWidth-this.margin.left-this.margin.right,h=this.canvasHeight-this.margin.top-this.margin.bottom,r=Math.min(w,h),config=configuration;config.size=r,config.radius=config.size/2,config.cx=r/2+(w-h)/2,config.cy=r/2+2*margin.top,config.min=void 0!=configuration.min?configuration.min:0,config.max=void 0!=configuration.max?configuration.max:100,config.range=config.max-config.min,config.actualValue=Math.round(configuration.actualValue),config.targetValue=configuration.targetValue,config.valueFlag=configuration.valueFlag,config.majorTicks=configuration.majorTicks||5,config.minorTicks=configuration.minorTicks||2,config.greenColor=configuration.greenColor||"#109618",config.yellowColor=configuration.yellowColor||"#FF9900",config.redColor=configuration.redColor||"#DC3912",config.systemTarget=Math.round(config.targetValue),config.isSystemTarget=!0,(isNaN(config.systemTarget)||"undefined"==typeof config.systemTarget||"NA"===config.systemTarget)&&(config.systemTarget=config.max,config.targetValue=config.systemTarget,config.isSystemTarget=!1),config.pointerWidth=5,config.pointerTailLength=2,config.pointerHeadLengthPercent=.8,config.pointerHeadLength=Math.round(config.radius*config.pointerHeadLengthPercent),config.transitionDuration=configuration.transitionDuration||500;var _currentRotation="",rangeFontSize=Math.round(config.size/13),rangeColor="#C8C8C8",triangleColor="#1E90FF",minPoint=valueToP(config.min,1.05),maxPoint=valueToP(config.max,1.08),systemTargetTextAnchorAngle=valueToDegrees(config.systemTarget),systemTargetTextPoint=valueToP(config.systemTarget,1.15),systemTargetTrianglePoint=valueToP(config.systemTarget,1.05),triangleRotationAngle=valueToDegrees(config.systemTarget),angleOfRange=valueToDegrees(config.max),angleOfMinRange=valueToDegrees(config.min),angleOfSystemtarget=valueToDegrees(config.systemTarget),valueFontSize=24,innerBandInnerRadius=((config.min+config.max)/2,.95*config.radius),innerBandOuterRadius=.65*config.radius,pointerdata=[[config.pointerWidth/2,0],[0,-config.pointerHeadLength],[-(config.pointerWidth/2),0],[0,config.pointerTailLength],[config.pointerWidth/2,0]],arc=d3.svg.arc().innerRadius(innerBandInnerRadius).outerRadius(innerBandOuterRadius).startAngle(valueToRadians(config.min)),kpiBody=d3.select("#"+renderContainerId).append("svg").attr("id",renderContainerId+"_svg").attr("width",this.canvasWidth).attr("height",this.canvasHeight).attr("transform","translate("+margin.left+","+margin.top+")").attr("class","Gaugekpi");if(kpiBody=kpiBody.append("g").attr("transform","translate(10,10)"),config.isSystemTarget){for(var index in config.greenZones)drawOuterBand(config.greenZones[index].from,config.greenZones[index].to,config.greenColor,.95*config.radius,config.radius);for(var index in config.yellowZones)drawOuterBand(config.yellowZones[index].from,config.yellowZones[index].to,config.yellowColor,.95*config.radius,config.radius);for(var index in config.redZones)drawOuterBand(config.redZones[index].from,config.redZones[index].to,config.redColor,.95*config.radius,config.radius)}else drawOuterBand(config.min,config.max,triangleColor,.95*config.radius,config.radius);var targetData=Math.round((config.max-config.actualValue)/config.range*100);kpiBody.append("path").data([targetData]).style("fill","#F8F8F8").style("opacity","0.8").attr("class","kpi").attr("d",d3.svg.arc().startAngle(valueToRadians(config.min)).endAngle(valueToRadians(config.max)).innerRadius(innerBandInnerRadius).outerRadius(innerBandOuterRadius)).attr("transform",function(){return"translate("+config.cx+", "+config.cy+") rotate(270)"});var actualData=Math.round((config.actualValue-config.min)/config.range*100);kpiBody.append("path").datum({endAngle:valueToRadians(config.min),data:actualData}).style("fill","#C8C8C8").attr("class","kpi").style("opacity",1).attr("transform",function(){return"translate("+config.cx+", "+config.cy+") rotate(270)"}).transition().duration(1e3).attrTween("d",function(d){var interpolate=d3.interpolate(d.endAngle,valueToRadians(config.actualValue));return function(t){return d.endAngle=interpolate(t),arc(d)}}),kpiBody.append("text").attr("transform","translate("+minPoint.x+","+minPoint.y+")").text(config.min).style("font-size",rangeFontSize+"px").attr("text-anchor","end").style("fill",rangeColor),kpiBody.append("text").attr("transform","translate("+maxPoint.x+","+maxPoint.y+")").text(d3.format("0.3s")(config.max).toUpperCase()).style("font-size",rangeFontSize+"px").attr("text-anchor","start").style("fill",rangeColor),angleOfRange-angleOfSystemtarget>10&&angleOfSystemtarget-angleOfMinRange>10&&kpiBody.append("text").attr("transform","translate("+systemTargetTextPoint.x+","+systemTargetTextPoint.y+")").text(config.systemTarget).style("font-size","14px").attr("text-anchor",function(){return 90>systemTargetTextAnchorAngle?"end":systemTargetTextAnchorAngle>90?"start":"middle"}).style("fill","#1E90FF"),config.isSystemTarget&&kpiBody.append("path").data([config.systemTarget]).attr("class","triangle").attr("d",d3.svg.symbol().type("triangle-down").size(40)).style("fill",triangleColor).attr("transform","translate("+systemTargetTrianglePoint.x+","+systemTargetTrianglePoint.y+")rotate("+(triangleRotationAngle+30)+")");var pointerContainer=kpiBody.append("g").attr("class","pointerContainer"),pointerLine=d3.svg.line().x(function(d){return d[0]}).y(function(d){return d[1]}).interpolate("monotone");pointerContainer.selectAll("path").data([pointerdata]).enter().append("path").attr("d",pointerLine).style("fill","#4c4c4c").style("fill-opacity",.7),pointerContainer.append("text").data([config.actualValue]).attr("x",config.cx).attr("y",config.cy+margin.top).attr("dy",valueFontSize/2).attr("text-anchor","middle").attr("font-weight","bold").style("font-size",valueFontSize+"px").style("fill","#000"),redraw(config.min,0),redraw(config.actualValue,1e3),this.utility.tooltip(kpiBody,".kpi",!1,!1),this.utility.tooltip(kpiBody,".triangle",!1,!1)},kpi.prototype.redraw=function(data){this.draw(data)},kpi.prototype.drawOverlap=function(data,originalData){this.draw(data)},kpi.prototype.removeOverlap=function(data){this.draw(data)},kpi}(),xChart.line=function(){function line(renderContainerId,color,chartOptions){this.renderContainerId=renderContainerId,this.canvasWidth=document.getElementById(this.renderContainerId).offsetWidth,this.canvasHeight=document.getElementById(this.renderContainerId).offsetHeight,this.margin=jQuery.extend(!0,{},chartOptions.margin),this.color=color,this.subCategoryScale,this.axisRedrawThreshold=chartOptions.axisRedrawThreshold,this.aec=chartOptions.aec,this.utility=new xChart.utility}return line.prototype.dispatch=d3.dispatch("RenderComplete"),line.prototype.draw=function(data){var color=this.color,margin=this.margin;$("#"+this.renderContainerId+"_svg").remove();var width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId).append("svg").attr("id",this.renderContainerId+"_svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).attr("class","line"),mainGroup=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").attr("id",this.renderContainerId+"_mainGroup").attr("class","line"),axisLabelOverlap=this.utility.draw_xAxisDummy(mainGroup,data.categories,height,width,this.renderContainerId);axisLabelOverlap&&(margin.bottom*=2,this.bottomMarginSet=!0);var legend=new xChart.legend(data.series,color),legendRows=legend.drawLegend("top",mainGroup,width,margin)+1;margin.top=20*legendRows,mainGroup.selectAll(".legendg").remove(),height=this.canvasHeight-margin.top-margin.bottom,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mainGroup.attr("transform","translate("+margin.left+","+margin.top+")"),svg=mainGroup,legend.drawLegend("top",svg,width,margin);var si=d3.format(".2s"),siMod=function(val){return si(val).replace(/G/,"B")};this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="bottom",categoryAxisOptions.position="horizontal",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.xAxis=this.categoryAxis.draw(categoryScale,{x:0,y:height}),this.seriesAxis=new xChart.axis(this.renderContainerId,width,height);var seriesAxisOptions={};seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=width,seriesAxisOptions.orient="left",seriesAxisOptions.position="vertical",seriesAxisOptions.showPath=!1,seriesAxisOptions.tickFormat=siMod,seriesAxisOptions.calculate="auto",this.seriesAxis.setOptions(seriesAxisOptions);var seriesScale=this.seriesAxis.addQuantitativeScale(data.series,this.aec);this.yAxis=this.seriesAxis.draw(seriesScale);for(var i=0;i<data.series.length;i++){var dataValues=data.series[i].data,fmtDataValues=data.series[i].fmtData,lineData=data.categories.map(function(d,j){return{category:d,categoryName:d.name,categoryDimName:d.dimName,categoryLongName:d.longName,categoryValue:d.value,seriesName:data.series[i].name,seriesValue:data.series[i].value,seriesLongName:data.series[i].longName,seriesIndex:i,categoryIndex:j,index:j,data:+dataValues[j],fmtData:fmtDataValues[j]}}),x=d3.scale.ordinal().rangeRoundBands([0,width],.1,.2).domain(lineData.map(function(d){return d.categoryName}));this.subCategoryScale=x;var line=d3.svg.line().interpolate("linear").x(function(d){return x(d.categoryName)+x.rangeBand()/2}).y(function(d){return seriesScale(d.data)});svg.append("path").datum(lineData).attr("class","line").attr("d",line).style("stroke",color[i]).style("stroke-width","4").style("stroke-linejoin","round").style("stroke-linecap","square").style("fill","none"),svg.selectAll("circle .circle"+i).data(lineData).enter().append("circle").attr("class","linecircle circle"+i).attr("cx",function(d){return x(d.categoryName)+x.rangeBand()/2}).attr("cy",function(d){return seriesScale(d.data)}).attr("r","4").style("stroke-width","2").style("stroke",color[i]).style("fill","#fff").each(function(d){d.index===data.categories.length-1&&d.seriesIndex===data.series.length-1&&this.dispatch.RenderComplete(data,this)}.bind(this)).on("mouseover",function(d){var circleClass=d3.select(this).attr("class"),lineIndex=parseInt(circleClass.replace(/^\D+/g,""));d3.select(this).style("fill",color[lineIndex])}).on("mouseout",function(d){d3.select(this).style("fill","#fff")})}this.utility.tooltip(svg,".linecircle",!0,!1);var t=(svg.append("rect").attr("x",-1*width).attr("y",-1*height).attr("height",height).attr("width",width).attr("class","curtain").attr("transform","rotate(180)").style("fill","#ffffff"),svg.transition().delay(750).duration(1e3).ease("linear"));t.select("rect.curtain").attr("width",0)},line.prototype.redraw=function(data){var color=this.color,margin=this.margin;$("#"+this.renderContainerId+"_svg").remove();var width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId).append("svg").attr("id",this.renderContainerId+"_svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).attr("class","line"),mainGroup=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").attr("id",this.renderContainerId+"_mainGroup").attr("class","line"),axisLabelOverlap=this.utility.draw_xAxisDummy(mainGroup,data.categories,height,width,this.renderContainerId);!axisLabelOverlap&&this.bottomMarginSet&&(margin.bottom/=2);var legend=new xChart.legend(data.series,color),legendRows=legend.drawLegend("top",mainGroup,width,margin)+1;margin.top=20*legendRows,mainGroup.selectAll(".legendg").remove(),height=this.canvasHeight-margin.top-margin.bottom,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mainGroup.attr("transform","translate("+margin.left+","+margin.top+")"),svg=mainGroup,legend.drawLegend("top",svg,width,margin);var si=d3.format(".2s"),siMod=function(val){return si(val).replace(/G/,"B")};this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="bottom",categoryAxisOptions.position="horizontal",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.xAxis=this.categoryAxis.draw(categoryScale,{x:0,y:height}),this.seriesAxis=new xChart.axis(this.renderContainerId,width,height);var seriesAxisOptions={};seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=width,seriesAxisOptions.orient="left",seriesAxisOptions.position="vertical",seriesAxisOptions.showPath=!1,seriesAxisOptions.tickFormat=siMod,seriesAxisOptions.calculate="auto",this.seriesAxis.setOptions(seriesAxisOptions);var seriesScale=this.seriesAxis.addQuantitativeScale(data.series,this.aec);this.yAxis=this.seriesAxis.draw(seriesScale);for(var i=0;i<data.series.length;i++){var dataValues=data.series[i].data,fmtDataValues=data.series[i].fmtData,lineData=data.categories.map(function(d,j){return{category:d,categoryName:d.name,categoryDimName:d.dimName,categoryLongName:d.longName,categoryValue:d.value,seriesName:data.series[i].name,seriesValue:data.series[i].value,seriesLongName:data.series[i].longName,data:+dataValues[j],fmtData:fmtDataValues[j]}});lineData.forEach(function(d){isNaN(d.data)&&(d.data=0,d.fmtData="0")});var x=d3.scale.ordinal().rangeRoundBands([0,width],.1,.2).domain(lineData.map(function(d){return d.categoryName})),line=d3.svg.line().interpolate("linear").x(function(d){return x(d.categoryName)+x.rangeBand()/2}).y(function(d){return seriesScale(d.data)});svg.append("path").datum(lineData).attr("class","line").attr("d",line).style("stroke",color[i]).style("stroke-width","4").style("stroke-linejoin","round").style("stroke-linecap","square").style("fill","none"),svg.selectAll("circle .circle"+i).data(lineData).enter().append("circle").attr("class","linecircle circle"+i).attr("cx",function(d){return x(d.categoryName)+x.rangeBand()/2}).attr("cy",function(d){return seriesScale(d.data)}).attr("r","4").style("stroke-width","2").style("stroke",color[i]).style("fill","#fff").each(function(d){d.index===data.categories.length-1&&d.seriesIndex===data.series.length-1&&this.dispatch.RenderComplete(data,this)}.bind(this)).on("mouseover",function(d){var circleClass=d3.select(this).attr("class"),lineIndex=parseInt(circleClass.replace(/^\D+/g,""));d3.select(this).style("fill",color[lineIndex])}).on("mouseout",function(d){d3.select(this).style("fill","#fff")})}this.utility.tooltip(svg,".linecircle",!0,!1);var t=(svg.append("rect").attr("x",-1*width).attr("y",-1*height).attr("height",height).attr("width",width).attr("class","curtain").attr("transform","rotate(180)").style("fill","#ffffff"),svg.transition().delay(750).duration(1e3).ease("linear"));t.select("rect.curtain").attr("width",0)},line.prototype.drawOverlap=function(overlappedData,originalData){overlappedData=this.utility.overlapDataPrep(overlappedData,originalData),this.redraw(overlappedData)},line.prototype.removeOverlap=function(data){this.draw(data)},line}(),xChart.map=function(){function map(renderContainerId,color,chartOptions){function PopulateLonLat(e,location,zoomLevel){var regionData=self.regionData,countryData=self.countryData;if(zoomLevel>=1&&2>zoomLevel){for(var i=0;i<regionData.length;++i)if(regionData[i].name.toLowerCase()==location.toLowerCase())return e.lon=regionData[i].lon,void(e.lat=regionData[i].lat);return console.log("Error:lat and long details not found for :"+location),!1}if(zoomLevel>=2&&4>zoomLevel){for(var i=0;i<countryData.length;++i)if(countryData[i].name.toLowerCase()==location.toLowerCase())return e.lon=countryData[i].lon,void(e.lat=countryData[i].lat);return console.log("Error:lat and long details not found for :"+location),!1}}this.renderContainerId=renderContainerId,this.canvasWidth=document.getElementById(renderContainerId).offsetWidth,this.canvasHeight=document.getElementById(renderContainerId).offsetHeight,this.margin=jQuery.extend(!0,{},chartOptions.margin),this.zoomLevel=chartOptions.zoomLevel,this.drillMap=chartOptions.drillMap,this.color=color,this.utility=new xChart.utility,this.regionData=[],this.countryData=[],this.regionarray=[],this.countryarray=[],this.countryLabels=[],this.regionLabels=[],this.zoom;var self=this;this.DrawCircles=function(svg,g,zoomLevel,newData,originalData){var data=[],circleClass="mapCircle";if("undefined"!=typeof originalData?(data=originalData,data=data.concat(newData),circleClass="mapOverLapCircle"):data=newData,!("mapCircle"==circleClass&&svg.selectAll(".mapCircle")[0].length>0)){var Vals,scale=.25*self.canvasHeight,center=[0,45],projection=d3.geo.mercator().translate([0,0]).center(center).scale(scale),minSize=[scale/0,scale/10,scale/10,scale/14,scale/14,scale/16,scale/16],maxSize=[scale/0,scale/4,scale/4,scale/6,scale/6,scale/9,scale/9],index=Math.ceil(zoomLevel),y=d3.scale.linear().range([Math.round(minSize[index]),Math.round(maxSize[index])]);Vals="mapOverLapCircle"==circleClass?originalData.map(function(obj){return obj.data;
}):data.map(function(obj){return obj.data});var max=Math.max.apply(null,Vals);Math.min.apply(null,Vals);y.domain([0,max]);var circles=g.selectAll("circle").data(data).enter().append("circle").attr("class",circleClass).attr("cx",function(d){return projection([d.lon,d.lat])[0]}).attr("cy",function(d){return projection([d.lon,d.lat])[1]}).attr("r",function(d){return 0});"mapOverLapCircle"==circleClass?circles.style({fill:function(d){return"#FFC200"},stroke:function(d){return"#FFC200"},opacity:1}):circles.style({fill:function(d){return d.color},stroke:function(d){return d.color},opacity:1}),zoomLevel>=1&&2>zoomLevel?circles.attr("name","regioncircle"):circles.attr("name","countrycircle"),circles.transition().duration(1e3).attr("r",function(d){return y(d.data)}),self.utility.tooltip(svg,"."+circleClass,!0,!1)}},this.DrawLabels=function(svg,g,zoomLevel,data){if(!(svg.selectAll("[name='countriestext']")[0].length>0||svg.selectAll("[name='regiontext']")[0].length>0)){self.canvasWidth;height=self.canvasHeight;var scale=.25*height,center=[0,45],projection=d3.geo.mercator().translate([0,0]).center(center).scale(scale),fontsize=5;zoomLevel>=1&&2>zoomLevel?fontsize=Math.round(.25*scale/zoomLevel):zoomLevel>=2&&4>=zoomLevel&&(fontsize=Math.round(.15*scale/zoomLevel));var minSize=[scale/0,scale/10,scale/10,scale/14,scale/14,scale/16,scale/16],maxSize=[scale/0,scale/4,scale/4,scale/6,scale/6,scale/9,scale/9],index=Math.ceil(zoomLevel),y=d3.scale.linear().range([Math.round(minSize[index]),Math.round(maxSize[index])]),Vals=data.map(function(obj){return obj.data}),max=Math.max.apply(null,Vals);Math.min.apply(null,Vals);y.domain([0,max]);var texts=g.selectAll("text").data(data).enter().append("text").style({"font-family":" Calibri"}).attr("x",function(d){return projection([d.lon,d.lat])[0]}).attr("y",function(d){return projection([d.lon,d.lat])[1]+y(d.data)+2}).attr("dy",".35em").text(function(d){return d.categoryLongName}).style("text-anchor","middle").style("font-size",fontsize);zoomLevel>=1&&2>zoomLevel?texts.attr("name","regiontext"):zoomLevel>=2&&4>=zoomLevel&&texts.attr("name","countriestext")}},this.PopulateArray=function(data,zoomLevel,index){for(var ary=[],j=0;j<data.categories.length;++j){var c={};c.categoryLongName=data.categories[j].name,c.data=data.series[index].data[j],c.fmtData=data.series[index].fmtData[j],c.seriesLongName=data.series[index].longName,void 0!=data.series[index].color?c.color=data.series[index].color:c.color=chartOptions.defaultColors[index];var retVal=PopulateLonLat(c,c.categoryLongName,zoomLevel);0!=retVal&&ary.push(c)}return ary},this.PopulateLabelsArray=function(data,zoomLevel){for(var ary=[],j=0;j<data.categories.length;++j){var c={};c.categoryLongName=data.categories[j].name,c.data=data.series[0].data[j];var retVal=PopulateLonLat(c,c.categoryLongName,zoomLevel);0!=retVal&&ary.push(c)}return ary},this.move=function(){var zoom=self.zoom,svg=d3.select("#"+self.renderContainerId+"_svg"),g=d3.select("#"+self.renderContainerId+"_svg_g"),zoomLevel=zoom.scale();self.zoomLevel=zoomLevel;var t=d3.event.translate,s=d3.event.scale,width=self.canvasWidth,height=self.canvasHeight;t[0]=Math.min(width/2*(s-1),Math.max(width/2*(1-s),t[0])),t[1]=Math.min(height/2*(s-1)+230*s,Math.max(height/2*(1-s)-230*s,t[1])),zoom.translate(t),g.style("stroke-width",1/s).transition().duration(1e3).attr("transform","translate("+t+")scale("+s+")"),zoomLevel>=1&&2>zoomLevel?(svg.selectAll("[name='countriestext']").length>0&&svg.selectAll("[name='countriestext']").remove(),svg.selectAll("[name='countrycircle']").length>0&&svg.selectAll("[name='countrycircle']").remove(),0==svg.selectAll("[name='regioncircle']")[0].length&&(self.DrawCircles(svg,g,zoomLevel,self.regionarray),self.DrawLabels(svg,g,zoomLevel,self.regionLabels))):zoomLevel>=2&&4>=zoomLevel&&(svg.selectAll("[name='regiontext']").length>0&&svg.selectAll("[name='regiontext']").remove(),svg.selectAll("[name='regioncircle']").length>0&&svg.selectAll("[name='regioncircle']").remove(),0==svg.selectAll("[name='countrycircle']")[0].length&&(0==self.countryarray.length?self.drillMap(zoomLevel):(self.DrawCircles(svg,g,zoomLevel,self.countryarray),self.DrawLabels(svg,g,zoomLevel,self.countryLabels))))}}return map.prototype.dispatch=d3.dispatch("RenderComplete"),map.prototype.draw=function(data){function zoomed(){var zoom=self.zoom,zoomLevel=zoom.scale();self.zoomLevel=zoomLevel,g.attr("transform","translate("+zoom.translate()+")scale("+zoom.scale()+")"),zoomLevel>=1&&2>zoomLevel?(svg.selectAll("[name='countriestext']").length>0&&svg.selectAll("[name='countriestext']").remove(),svg.selectAll("[name='countrycircle']").length>0&&svg.selectAll("[name='countrycircle']").remove(),0==svg.selectAll("[name='regioncircle']")[0].length&&(self.DrawCircles(svg,g,zoomLevel,self.regionarray),self.DrawLabels(svg,g,zoomLevel,self.regionLabels))):zoomLevel>=2&&4>=zoomLevel&&(svg.selectAll("[name='regiontext']").length>0&&svg.selectAll("[name='regiontext']").remove(),svg.selectAll("[name='regioncircle']").length>0&&svg.selectAll("[name='regioncircle']").remove(),0==svg.selectAll("[name='countrycircle']")[0].length&&(0==self.countryarray.length?drillMap(zoomLevel):(self.DrawCircles(svg,g,zoomLevel,self.countryarray),self.DrawLabels(svg,g,zoomLevel,self.countryLabels))))}"undefined"==typeof this.zoomLevel&&null==this.zoomLevel&&(this.zoomLevel=1),$("#"+this.renderContainerId+"_svg").length>0&&$("#"+this.renderContainerId+"_svg").remove();var zoomLevel=this.zoomLevel,drillMap=this.drillMap,renderContainerId=this.renderContainerId,self=this;if(zoomLevel>=1&&2>zoomLevel){var width=this.canvasWidth,height=this.canvasHeight,scale=.25*this.canvasHeight,center=[0,45],projection=d3.geo.mercator().translate([0,0]).center(center).scale(scale);this.zoom=d3.behavior.zoom().scaleExtent([1,8]).on("zoom",this.move);var path=d3.geo.path().projection(projection),svg=d3.select("#"+renderContainerId).append("svg").attr("width",width).attr("id",renderContainerId+"_svg").attr("class","map").attr("height",height).append("g").attr("id",renderContainerId+"_svg_outerGroup").attr("transform","translate("+width/2+","+height/2+")").call(this.zoom);svg.append("rect").style({fill:"#ACC7F2"}).attr("x",-width/2).attr("y",-height/2).attr("width",width).attr("height",height);var g1,g=svg.append("g").attr("id",renderContainerId+"_svg_g");d3.json("../countries/countries.js",function(error,countries){g1=g.append("g").attr("id","countries").selectAll("g").data(topojson.feature(countries,countries.objects.countries).features).enter().append("g"),g1.append("path").style({stroke:"#939196",fill:"#F4F3EF","stroke-width":"0.5px","stroke-linejoin":"round","stroke-opacity":"0.35","stroke-linecap":"round"}).attr("id",function(d){return d.id}).attr("d",path);var tempStr=data.ChartClientId+"_inOut";d3.selectAll('button[zoom-action="'+tempStr+'"]').on("click",function(){d3.event.preventDefault();var zoom=self.zoom,scale=zoom.scale(),extent=zoom.scaleExtent(),translate=zoom.translate(),x=translate[0],y=translate[1],factor=this.id.indexOf("zoom_in")>0?1.2:1/1.2,target_scale=scale*factor;if(target_scale===extent[0]||target_scale===extent[1])return!1;var clamped_target_scale=Math.max(extent[0],Math.min(extent[1],target_scale));clamped_target_scale!=target_scale&&(target_scale=clamped_target_scale,factor=target_scale/scale),x=(x-center[0])*factor+center[0],y=(y-center[1])*factor+center[1],d3.transition().duration(350).tween("zoom",function(){var interpolate_scale=d3.interpolate(scale,target_scale),interpolate_trans=d3.interpolate(translate,[x,y]);return function(t){zoom.scale(interpolate_scale(t)).translate(interpolate_trans(t)),zoomed()}})}),self.renderData(data)})}},map.prototype.redraw=function(data){this.zoomLevel,this.drillMap,this.renderContainerId;this.renderData(data)},map.prototype.drawOverlap=function(data,oData){var svg=d3.select("#"+this.renderContainerId+"_svg"),g=d3.select("#"+this.renderContainerId+"_svg_g");d3.select("#"+this.renderContainerId+"_svg_outerGroup").call(d3.behavior.zoom().on("zoom",null));var originalData=[];if(this.zoomLevel>=1&&this.zoomLevel<2){this.regionarray=[];for(var i=0;i<data.series.length;i++){var region=[];region=this.PopulateArray(data,this.zoomLevel,i,!0),this.regionarray=this.regionarray.concat(region)}originalData=[];for(var i=0;i<oData.series.length;i++){var region=[];region=this.PopulateArray(oData,this.zoomLevel,i),originalData=originalData.concat(region)}this.DrawCircles(svg,g,this.zoomLevel,this.regionarray,originalData)}else if(this.zoomLevel>=2&&this.zoomLevel<=4){this.countryarray=[];for(var i=0;i<data.series.length;i++){var country=[];country=this.PopulateArray(data,this.zoomLevel,i,!0),this.countryarray=this.countryarray.concat(country)}originalData=[];for(var i=0;i<oData.series.length;i++){var country=[];country=this.PopulateArray(oData,this.zoomLevel,i),originalData=originalData.concat(country)}this.DrawCircles(svg,g,this.zoomLevel,this.countryarray,originalData)}},map.prototype.renderData=function(data){var zoomLevel=this.zoomLevel,svg=d3.select("#"+this.renderContainerId+"_svg"),g=d3.select("#"+this.renderContainerId+"_svg_g"),self=this;zoomLevel>=1&&2>zoomLevel?d3.csv("../countries/Region.csv",function(error,regions){self.regionData=regions,self.regionarray=[];for(var i=0;i<data.series.length;i++){var region=[];region=self.PopulateArray(data,self.zoomLevel,i),self.regionarray=self.regionarray.concat(region)}self.regionLabels=self.PopulateLabelsArray(data,zoomLevel),self.DrawCircles(svg,g,zoomLevel,self.regionarray),self.DrawLabels(svg,g,zoomLevel,self.regionLabels)}):zoomLevel>=2&&4>=zoomLevel&&d3.csv("../countries/Countries.csv",function(error,countries){self.countryData=countries,self.countryarray=[];for(var i=0;i<data.series.length;i++){var country=[];country=self.PopulateArray(data,zoomLevel,i),self.countryarray=self.countryarray.concat(country)}self.countryLabels=self.PopulateLabelsArray(data,zoomLevel),self.DrawCircles(svg,g,zoomLevel,self.countryarray),self.DrawLabels(svg,g,zoomLevel,self.countryLabels)})},map.prototype.removeOverlap=function(data){d3.select("#"+this.renderContainerId+"_svg_outerGroup").call(this.zoom);var svg=d3.select("#"+this.renderContainerId+"_svg");svg.selectAll(".mapOverLapCircle").length>0&&svg.selectAll(".mapOverLapCircle").remove()},map}(),xChart.normalizedStackedColumn=function(){function normalizedStackedColumn(renderContainerId,color,chartOptions){this.chartOptions=chartOptions,this.renderContainerId=renderContainerId,this.canvasWidth=document.getElementById(this.renderContainerId).offsetWidth,this.canvasHeight=document.getElementById(this.renderContainerId).offsetHeight,this.margin=jQuery.extend(!0,{},chartOptions.margin),this.color=color,this.axisRedrawThreshold=chartOptions.axisRedrawThreshold,this.aec=chartOptions.aec,this.overlapDraw=!1}return normalizedStackedColumn.prototype.dispatch=d3.dispatch("RenderComplete"),normalizedStackedColumn.prototype.draw=function(data){function findSum(categoryIndex){sum=0;for(var i=0;i<data.series.length;i++)sum+=data.series[i].data[categoryIndex];return sum}var color=this.color,margin=this.margin,sCHeight=[],sCStartPoint=[];this.sCHeight=sCHeight,this.sCStartPoint=sCStartPoint,$("#"+this.renderContainerId+"_svg").remove(),this.utility=new xChart.utility;var width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId).append("svg").attr("id",this.renderContainerId+"_svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).attr("class","normalizedStackedColumn"),mainGroup=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").attr("id",this.renderContainerId+"_mainGroup").attr("class","normalizedStackedColumn"),axisLabelOverlap=this.utility.draw_xAxisDummy(mainGroup,data.categories,height,width,this.renderContainerId);axisLabelOverlap&&(margin.bottom*=2,this.bottomMarginSet=!0);var legend=new xChart.legend(data.series,color),legendRows=legend.drawLegend("top",mainGroup,width,margin)+1;margin.top=20*legendRows,mainGroup.selectAll(".legendg").remove(),height=this.canvasHeight-margin.top-margin.bottom,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mainGroup.attr("transform","translate("+margin.left+","+margin.top+")"),svg=mainGroup,legend.drawLegend("top",svg,width,margin);var stack=d3.layout.stack().values(function(d){return d.values}),formatPercent=d3.format(".0%");this.utility.addLinearFilter(svg,this.renderContainerId),this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="bottom",categoryAxisOptions.position="horizontal",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.categoryScale=categoryScale,this.xAxis=this.categoryAxis.draw(categoryScale,{x:0,y:height}),this.seriesAxis=new xChart.axis(this.renderContainerId,width,height);var seriesAxisOptions={};seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=width,seriesAxisOptions.orient="left",seriesAxisOptions.position="vertical",seriesAxisOptions.showPath=!1,seriesAxisOptions.tickFormat=formatPercent,this.seriesAxis.setOptions(seriesAxisOptions);var seriesScale=this.seriesAxis.addQuantitativeScale(data.series,.1,0,height);this.seriesScale=seriesScale,this.yAxis=this.seriesAxis.draw(seriesScale),this.subCategoryScale=d3.scale.ordinal().domain(data.series.map(function(d){return d.value})).rangeBands([0,categoryScale.rangeBand()]);var stackData=data.series.map(function(d,i){return{values:data.categories.map(function(e,j){return sum=findSum(j),{seriesIndex:i,categoryIndex:j,seriesName:d.name,seriesValue:d.value,seriesLongName:d.longName,y:d.data[j]/sum}})}}),barGroups=svg.selectAll(".outerbar").data(data.categories).enter().append("g").attr("class","outerbar").attr("transform",function(d){return"translate("+categoryScale(d.value)+",0)"}),bars=barGroups.selectAll("rect").data(function(d,i){for(var rArray=[],x=0;x<stack(stackData).length;x++)rArray.push({seriesName:stack(stackData)[x].values[i].seriesName,y0:stack(stackData)[x].values[i].y0,y1:stack(stackData)[x].values[i].y0+stack(stackData)[x].values[i].y,seriesIndex:stack(stackData)[x].values[i].seriesIndex,categoryIndex:stack(stackData)[x].values[i].categoryIndex,seriesLongName:stack(stackData)[x].values[i].seriesLongName,seriesValue:stack(stackData)[x].values[i].seriesValue,data:data.series[x].data[i],fmtData:data.series[x].fmtData[i],category:d,categoryLongName:null===data.categories[i]?"":data.categories[i].longName,categoryName:d.name,categoryDimName:d.dimName,categoryValue:d.value});return rArray});bars.enter().append("rect").attr("class","bar").style("fill",function(d,i){return color[d.seriesIndex]}).style("stroke",function(d,i){return color[d.seriesIndex]}).style("stroke-width","1").attr("height",function(d){return 0}).attr("y",function(d){return height}).attr("width",categoryScale.rangeBand()).transition().ease("bounce").duration(1e3).attr("height",function(d){return sCHeight.push(seriesScale(d.y0)-seriesScale(d.y1)),seriesScale(d.y0)-seriesScale(d.y1)}).attr("y",function(d){return sCStartPoint.push(seriesScale(d.y1)),seriesScale(d.y1)}).each("end",function(d){d.categoryIndex===data.categories.length-1&&d.seriesIndex==data.series.length-1&&this.dispatch.RenderComplete(data,this)}.bind(this)),this.utility.tooltip(svg,".bar",!0,!1)},normalizedStackedColumn.prototype.redraw=function(data){function findSum(categoryIndex){sum=0;for(var i=0;i<data.series.length;i++)sum+=data.series[i].data[categoryIndex];return sum}function redrawBars(that){var barGroups=svg.selectAll(".outerbar").data(data.categories).enter().append("g").attr("class","outerbar").attr("transform",function(d){return"translate("+categoryScale(d.value)+",0)"}),bars=barGroups.selectAll("rect").data(function(d,i){for(var rArray=[],x=0;x<stack(stackData).length;x++)rArray.push({seriesName:stack(stackData)[x].values[i].seriesName,y0:stack(stackData)[x].values[i].y0,y1:stack(stackData)[x].values[i].y0+stack(stackData)[x].values[i].y,seriesIndex:stack(stackData)[x].values[i].seriesIndex,categoryIndex:stack(stackData)[x].values[i].categoryIndex,seriesLongName:stack(stackData)[x].values[i].seriesLongName,seriesValue:stack(stackData)[x].values[i].seriesValue,data:data.series[x].data[i],fmtData:data.series[x].fmtData[i],category:d,categoryLongName:null===data.categories[i]?"":data.categories[i].longName,categoryName:d.name,categoryDimName:d.dimName,categoryValue:d.value});return rArray});bars.enter().append("rect").attr("class","bar").style("fill",function(d,i){return color[d.seriesIndex]}).style("stroke",function(d,i){return color[d.seriesIndex]}).style("stroke-width","1").attr("width",categoryScale.rangeBand()).attr("height",function(d){return sCHeight.push(seriesScale(d.y0)-seriesScale(d.y1)),seriesScale(d.y0)-seriesScale(d.y1)}).attr("y",function(d){return sCStartPoint.push(seriesScale(d.y1)),seriesScale(d.y1)}).each(function(d){d.categoryIndex===data.categories.length-1&&d.seriesIndex==data.series.length-1&&that.dispatch.RenderComplete(data,that)}.bind(that)),that.utility.tooltip(svg,".bar",!0,!1)}this.removeOverlap();var color=this.color,margin=this.margin,sCHeight=[],sCStartPoint=[];this.sCHeight=sCHeight,this.sCStartPoint=sCStartPoint;var width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId+"_svg"),mainGroup=d3.select("#"+this.renderContainerId+"_mainGroup"),axisLabelOverlap=this.utility.draw_xAxisDummy(mainGroup,data.categories,height,width,this.renderContainerId);!axisLabelOverlap&&this.bottomMarginSet&&(margin.bottom/=2);var legend=new xChart.legend(data.series,color),legendRows=legend.drawLegend("top",mainGroup,width,margin)+1;margin.top=20*legendRows,mainGroup.selectAll(".legendg").remove(),height=this.canvasHeight-margin.top-margin.bottom,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mainGroup.attr("transform","translate("+margin.left+","+margin.top+")"),svg=mainGroup,legend.drawLegend("top",svg,width,margin),this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="bottom",categoryAxisOptions.position="horizontal",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.categoryScale=categoryScale,this.xAxis=this.categoryAxis.draw(categoryScale,{x:0,y:height});var seriesScale=this.seriesAxis.scale;this.subCategoryScale=d3.scale.ordinal().domain(data.series.map(function(d){return d.value})).rangeBands([0,categoryScale.rangeBand()]);var stack=d3.layout.stack().values(function(d){return d.values}),stackData=data.series.map(function(d,i){return{values:data.categories.map(function(e,j){return sum=findSum(j),{seriesIndex:i,categoryIndex:j,seriesName:d.name,seriesValue:d.value,seriesLongName:d.longName,y:d.data[j]/sum}})}}),barGroups=svg.selectAll(".outerbar").data(data.categories);barGroups.exit().remove(),barGroups.enter().append("g").attr("class","outerbar").attr("transform",function(d){return"translate("+(categoryScale(d.value)+this.subCategoryScale.rangeBand()/2)+",0)"}.bind(this)),barGroups.transition().duration(400).attr("transform",function(d){return"translate("+categoryScale(d.value)+",0)"}.bind(this));var bars=barGroups.selectAll("rect").data(function(d,i){for(var rArray=[],x=0;x<stack(stackData).length;x++)rArray.push({seriesName:stack(stackData)[x].values[i].seriesName,y0:stack(stackData)[x].values[i].y0,y1:stack(stackData)[x].values[i].y0+stack(stackData)[x].values[i].y,seriesIndex:stack(stackData)[x].values[i].seriesIndex,categoryIndex:stack(stackData)[x].values[i].categoryIndex,seriesLongName:stack(stackData)[x].values[i].seriesLongName,seriesValue:stack(stackData)[x].values[i].seriesValue,data:data.series[x].data[i],fmtData:data.series[x].fmtData[i],category:d,categoryLongName:null===data.categories[i]?"":data.categories[i].longName,categoryName:d.name,categoryDimName:d.dimName,categoryValue:d.value});return rArray});bars.exit().remove(),bars.enter().append("rect").attr("class","bar").style("fill",function(d,i){return color[d.seriesIndex]}).style("stroke",function(d,i){return color[d.seriesIndex]}).style("stroke-width","1").attr("height",function(d){return 0}).attr("y",function(d){return height}),bars.transition().ease("bounce").duration(1e3).attr("height",function(d){return seriesScale(d.y0)-seriesScale(d.y1)}).attr("y",function(d){return seriesScale(d.y1)}).attr("width",categoryScale.rangeBand()).each("end",function(d){d.categoryIndex===data.categories.length-1&&d.seriesIndex==data.series.length-1&&(svg.selectAll(".outerbar").remove(),redrawBars(this))}.bind(this))},normalizedStackedColumn.prototype.drawOverlap=function(overlappedData,originalData){function findSum(categoryIndex){sum=0;for(var i=0;i<originalData.series.length;i++)sum+=originalData.series[i].data[categoryIndex];return sum}overlappedData=this.utility.overlapDataPrep(overlappedData,originalData);var seriesScale=this.seriesAxis.scale,categoryScale=this.categoryScale,sCHeight=this.sCHeight,sCStartPoint=this.sCStartPoint,svg=d3.select("#"+this.renderContainerId+"_mainGroup");svg.selectAll(".bar").style("opacity",.7);var stack=d3.layout.stack().values(function(d){return d.values}),stackData=overlappedData.overlappedSeries.map(function(d,i){return{values:overlappedData.categories.map(function(e,j){return sum=findSum(j),{seriesIndex:i,categoryIndex:j,seriesName:d.name,seriesValue:d.value,seriesLongName:d.longName,y:d.data[j][0]/sum}})}}),overlappedBars=svg.selectAll(".overlappedBar").data(originalData.categories).enter().append("g").attr("class","overlappedBar").attr("transform",function(d){return"translate("+categoryScale(d.value)+",0)"});overlappedBars=svg.selectAll(".overlappedBar").selectAll("rect").data(function(d,i){for(var rArray=[],x=0;x<stack(stackData).length;x++)rArray.push({seriesName:stack(stackData)[x].values[i].seriesName,y0:stack(stackData)[x].values[i].y0,y1:stack(stackData)[x].values[i].y0+stack(stackData)[x].values[i].y,seriesIndex:stack(stackData)[x].values[i].seriesIndex,categoryIndex:stack(stackData)[x].values[i].categoryIndex,seriesLongName:stack(stackData)[x].values[i].seriesLongName,seriesValue:stack(stackData)[x].values[i].seriesValue,data:overlappedData.overlappedSeries[x].data[i][0],fmtData:overlappedData.overlappedSeries[x].fmtData[i][0],category:d,categoryLongName:null===overlappedData.categories[i]?"":overlappedData.categories[i].longName,categoryName:d.name,categoryDimName:d.dimName,categoryValue:d.value});return rArray});var yi=0;overlappedBars.enter().append("rect").attr("class","ObarRect").attr("y",function(d){var s=sCStartPoint[yi]+sCHeight[yi];return yi++,s}).attr("height",0).attr("width",categoryScale.rangeBand()).style("fill","#FFC200").style("opacity",1).style("stroke","black").style("stroke-width","0.3px"),yi=0,overlappedBars.exit().remove(),overlappedBars.transition().duration(1e3).ease("bounce").attr("y",function(d,i){var s=sCStartPoint[yi]+sCHeight[yi]-(seriesScale(d.y0)-seriesScale(d.y1));return yi++,s}).attr("height",function(d){return seriesScale(d.y0)-seriesScale(d.y1)}),this.utility.tooltip(svg,".ObarRect",!0,!1)},normalizedStackedColumn.prototype.removeOverlap=function(data){var seriesScale=(this.subCategoryScale,this.seriesAxis.scale),categoryScale=this.categoryScale,sCHeight=this.sCHeight,sCStartPoint=this.sCStartPoint,svg=d3.select("#"+this.renderContainerId+"_mainGroup"),overlappedBars=svg.selectAll(".overlappedBar").data(function(d){var rArray=[];return rArray}).enter().append("g").attr("class","overlappedBar");overlappedBars=svg.selectAll(".overlappedBar").selectAll("rect").data(function(d,i){var rArray=[];return rArray});var yi=0;overlappedBars.enter().append("rect").attr("y",function(d,i){var s=sCStartPoint[yi]+sCHeight[yi]-(seriesScale(d.y0)-seriesScale(d.y1));return yi++,s}).attr("height",function(d){return seriesScale(d.y0)-seriesScale(d.y1)}).attr("width",categoryScale.rangeBand()),yi=0,overlappedBars.exit().transition().duration(1e3).ease("bounce").attr("y",function(d){var s=sCStartPoint[yi]+sCHeight[yi];return yi++,s}).attr("height",0).remove().each("end",function(){svg.selectAll(".bar").style("opacity",1);var outerBars=svg.selectAll(".overlappedBar");outerBars.remove()})},normalizedStackedColumn}(),xChart.pareto=function(){function pareto(renderContainerId,color,chartOptions){this.renderContainerId=renderContainerId,this.canvasWidth=document.getElementById(this.renderContainerId).offsetWidth,this.canvasHeight=document.getElementById(this.renderContainerId).offsetHeight,this.margin=jQuery.extend(!0,{},chartOptions.margin),this.utility=new xChart.utility}return pareto.prototype.dispatch=d3.dispatch("RenderComplete"),pareto.prototype.draw=function(data){var margin=this.margin,color=["#03A9F4","#E91E63"];margin.right=50,$("#"+this.renderContainerId+"_svg").remove();var width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId).append("svg").attr("id",this.renderContainerId+"_svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).attr("class","pareto"),mainGroup=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").attr("id",this.renderContainerId+"_mainGroup").attr("class","pareto"),axisLabelOverlap=this.utility.draw_xAxisDummy(mainGroup,data.categories,height,width,this.renderContainerId);axisLabelOverlap&&this.bottomMarginSet===!1&&(margin.bottom*=2,this.bottomMarginSet=!0),height=this.canvasHeight-margin.top-margin.bottom,svg=mainGroup;var chartData=[],ySum=0,cumulativePercentages=[],thresholdIndex="";data.categories.forEach(function(d,i){chartData.push({categoryLongName:d.longName,categoryValue:d.value,value:d.value,index:i,name:d.name,categoryName:d.name,data:data.series[0].data[i],fmtData:data.series[0].fmtData[i],seriesLongName:data.series[0].longName,seriesValue:data.series[0].value,seriesName:data.series[0].name})}),chartData.sort(function(a,b){return b.data-a.data}),chartData.forEach(function(d){return ySum+=d.data}),chartData.forEach(function(d,i){0===i?cumulativePercentages.push(d.data/ySum):cumulativePercentages.push(cumulativePercentages[i-1]+d.data/ySum)});var formatPercent=d3.format(".0%"),si=d3.format(".2s"),siMod=function(val){return si(val).replace(/G/,"B")};this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="bottom",categoryAxisOptions.position="horizontal",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(chartData,.1,.2);this.xAxis=this.categoryAxis.draw(categoryScale,{x:0,y:height}),this.categoryScale=categoryScale,this.seriesAxis=new xChart.axis(this.renderContainerId,width,height),this.utility.addLinearFilter(svg,this.renderContainerId);var seriesAxisOptions={};seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=width,seriesAxisOptions.orient="left",seriesAxisOptions.position="vertical",seriesAxisOptions.showPath=!1,seriesAxisOptions.tickFormat=siMod,this.seriesAxis.setOptions(seriesAxisOptions);var seriesScale=this.seriesAxis.addQuantitativeScale(data.series,0,0,height,0,ySum);this.seriesScale=seriesScale,this.yAxis=this.seriesAxis.draw(seriesScale);var percentScale=d3.scale.linear().range([height,0]),percentAxis=d3.svg.axis().scale(percentScale).orient("right").tickFormat(formatPercent);svg.append("g").attr("class","y axis").attr("id",this.renderContainerId+"_yaxis_percent").call(percentAxis).attr("transform","translate("+width+", 0)");var line=d3.svg.line().interpolate("cardinal").x(function(d,i){return categoryScale(d.categoryValue)+categoryScale.rangeBand()/2}).y(function(d,i){return percentScale(cumulativePercentages[i])});svg.selectAll("rect").data(chartData).enter().append("rect").attr("class","bar").attr("x",function(d){return categoryScale(d.categoryValue)}).attr("width",categoryScale.rangeBand()).attr("y",height).attr("height",0).style("fill",function(d,i){return cumulativePercentages[i]<.8?color[0]:""===thresholdIndex?(thresholdIndex=i,color[0]):color[1]}).transition().ease("bounce").duration(1e3).attr("y",function(d,i){return seriesScale(d.data)}).attr("height",function(d,i){return height-seriesScale(d.data)}).each("end",function(d){d.index===data.categories.length-1&&this.dispatch.RenderComplete(data,this)}.bind(this));var path=svg.append("path").datum(chartData).attr("class","line").attr("d",line).style("stroke","green").style("stroke-width","2").style("stroke-linejoin","round").style("stroke-linecap","square").style("fill","none"),totalLength=path.node().getTotalLength();path.attr("stroke-dasharray",totalLength+","+totalLength).attr("stroke-dashoffset",totalLength).transition().duration(2e3).ease("linear").attr("stroke-dashoffset",0),svg.selectAll("circle").data(chartData).enter().append("circle").attr("class","paretoCircle").attr("cx",function(d){return categoryScale(d.categoryValue)+categoryScale.rangeBand()/2}).attr("cy",function(d,i){return percentScale(cumulativePercentages[i])}).attr("r",3).style("stroke","green").style("fill","#fff"),svg.append("line").attr("x1",width).attr("y1",percentScale(.8)).attr("x2",width).attr("y2",percentScale(.8)).style("stroke","red").style("stroke-width","1").style("stroke-dasharray","3, 3").style("stroke-linejoin","round").transition().duration(2e3).attr("x1",0),svg.append("line").attr("x1",categoryScale(chartData[thresholdIndex].categoryValue)+categoryScale.rangeBand()/2).attr("y1",percentScale(cumulativePercentages[thresholdIndex])).attr("x2",categoryScale(chartData[thresholdIndex].categoryValue)+categoryScale.rangeBand()/2).attr("y2",percentScale(cumulativePercentages[thresholdIndex])).style("stroke","blue").style("stroke-width","1").style("stroke-dasharray","3, 3").style("stroke-linejoin","round").transition().duration(2e3).attr("y2",height),this.utility.tooltip(svg,".bar",!0,!1),this.utility.tooltip(svg,".paretoCircle",!0,!1)},pareto.prototype.redraw=function(data){this.draw(data)},pareto.prototype.drawOverlap=function(overlappedData,originalData){var margin=this.margin,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId+"_mainGroup"),chartData=[],categoryScale=this.categoryScale,seriesScale=this.seriesScale;svg.selectAll(".bar").style("opacity","0.7"),overlappedData=this.utility.overlapDataPrep(overlappedData,originalData),overlappedData.categories.forEach(function(d,i){chartData.push({categoryLongName:d.longName,categoryValue:d.value,categoryName:d.name,data:overlappedData.overlappedSeries[0].data[i][0],fmtData:overlappedData.overlappedSeries[0].fmtData[i][0],seriesLongName:overlappedData.overlappedSeries[0].longName,seriesValue:overlappedData.overlappedSeries[0].value,seriesName:overlappedData.overlappedSeries[0].name})});var bars=svg.selectAll(".obar").data(chartData);bars.exit().remove(),bars.enter().append("rect").attr("class","obar").attr("x",function(d){return categoryScale(d.categoryValue)}).attr("width",categoryScale.rangeBand()).attr("y",height).attr("height",0).style("fill","#FFC200"),bars.transition().ease("bounce").duration(1e3).attr("y",function(d,i){return seriesScale(d.data)}).attr("height",function(d,i){return height-seriesScale(d.data)}),this.utility.tooltip(svg,".obar",!0,!1)},pareto.prototype.removeOverlap=function(){var margin=this.margin,height=(this.canvasWidth-margin.left-margin.right,this.canvasHeight-margin.top-margin.bottom),svg=d3.select("#"+this.renderContainerId+"_mainGroup");svg.selectAll(".obar").data([]).exit().transition().duration(1e3).ease("bounce").attr("y",height).attr("height",0).remove(),svg.selectAll(".bar").style("opacity","1")},pareto}(),xChart.pieOrDonut=function(){
function pieOrDonut(renderContainerId,chartOptions){this.renderContainerId=renderContainerId,this.canvasWidth=document.getElementById(this.renderContainerId).offsetWidth,this.canvasHeight=document.getElementById(this.renderContainerId).offsetHeight,this.margin=jQuery.extend(!0,{},chartOptions.margin),this.color=chartOptions.defaultColors,this.chartType=chartOptions.chartType,this.noOfPieSlices=chartOptions.noOfPieSlices,this.utility=new xChart.utility}return pieOrDonut.prototype.dispatch=d3.dispatch("RenderComplete"),pieOrDonut.prototype.draw=function(data){function changeSeries(){var selectedIndex=select.property("selectedIndex"),seriesdropdownData=seriesOptions[0][selectedIndex].__data__;drawPieDonut(seriesdropdownData),this.selectedIndex=selectedIndex}function drawPieDonut(dd_series){function tweenPie(b){b.innerRadius=0;var i=d3.interpolate({startAngle:0,endAngle:0},b);return function(t){return arc(i(t))}}svg.selectAll(".arc").remove(),svg.selectAll(".dArc").remove(),data=originalData;var dataValues=dd_series.data,pieData=(dd_series.fmtData,data.categories.map(function(d,i){return{category:d,categoryDimName:d.dimName,categoryLongName:d.longName,categoryName:d.name,categoryValue:d.value,index:i,fmtData:data.series[0].fmtData[i],data:+dataValues[i],seriesLongName:dd_series.longName,seriesName:dd_series.name,seriesValue:dd_series.value}}));pieData.sort(function(a,b){return parseFloat(b.data)-parseFloat(a.data)}),pieData.forEach(function(d){isNaN(d.data)&&(d.data=0)}),data=pieData;d3.sum(data,function(d){return d.data});if(data.length>noOfSlice){for(var finalPieData=[],sumOthers=d3.sum(data,function(d,j){return j>noOfSlice-2?d.data:0}),i=0;i<data.length;i++){if(!(noOfSlice-1>i)){finalPieData.push({category:"others",index:i,categoryDimName:"Others",categoryLongName:"Others",categoryName:"Others",categoryValue:"Others",seriesLongName:"Others",seriesName:"Others",seriesValue:"Others",fmtData:sumOthers.toString(),data:sumOthers});break}finalPieData.push(data[i])}data=finalPieData}for(var dataset=data.map(function(d){return d}),sum=0,i=0;i<dataset.length;i++)sum+=dataset[i].data;var percentages=dataset.map(function(d){return parseFloat(100*d.data/sum).toFixed(2)}),percentSum=0,percentagesRoundOff=percentages.map(function(d,i){return i===percentages.length-1?100-percentSum:(percentSum+=Math.round(d),Math.round(d))}),arcData=pie(dataset.map(function(d){return d.data}));arcData.forEach(function(d,i){d.percent=percentages[i],d.category=dataset[i].category,d.index=i,d.categoryDimName=dataset[i].categoryDimName,d.categoryLongName=dataset[i].categoryLongName,d.categoryName=dataset[i].categoryName,d.categoryValue=dataset[i].categoryValue,d.fmtData=dataset[i].fmtData,d.seriesLongName=dataset[i].seriesLongName,d.seriesName=dataset[i].seriesName,d.seriesValue=dataset[i].seriesValue});var arcs=svg.selectAll("g.arc").data(arcData).enter().append("g").attr("class","arc").attr("transform","translate("+(outerRadius+40)+", "+h/2+")");arcs.append("path").attr("fill",function(d,i){return color[i]}).attr("class","pie").style("stroke",function(d,i){return d3.rgb(color[i]).darker(2)}).each(function(d){this._current=d}).transition().ease("bounce").duration(1e3).each("end",function(d){d.index===noOfSlice-1&&thisobj.dispatch.RenderComplete(arcData,thisobj)}).attrTween("d",tweenPie),"donut"==chartType?arcs.append("text").attr("class","pietext").attr("transform",function(d){var centroid=arc.centroid(d);return"translate("+centroid+")"}).attr("dy",".35em").style("text-anchor","middle").style("font-size","10px").style("fill","white").text(function(d,i){return percentagesRoundOff[i]+"%"}).style("display",function(d,i){return parseFloat(percentages[i])>5?"block":"none"}):arcs.append("text").attr("class","pietext").attr("transform",function(d){var offset=outerRadius/3,angle=(d.startAngle+d.endAngle)/2,xOff=Math.sin(angle)*offset,yOff=-Math.cos(angle)*offset,centroid=arc.centroid(d);return centroid[0]=centroid[0]+xOff,centroid[1]=centroid[1]+yOff,"translate("+centroid+")"}).attr("dy",".35em").style("text-anchor","middle").style("font-size","10px").style("fill","white").text(function(d,i){return percentagesRoundOff[i]+"%"}).style("display",function(d,i){return parseFloat(percentages[i])>5?"block":"none"}),legendDrawn===!1&&(drawPieLegends(data),legendDrawn=!0),thisobj.utility.tooltip(svg,".pie",!0,!0)}function drawPieLegends(data){function DrawLegendSubset(seriesSubset,colorSubset,legendPerPage,pageNo,totalPages){var legend=svg.selectAll("g.legendg").data(seriesSubset).enter().append("g").attr("class","legendg").attr("transform",function(d,i){return"translate("+2*outerRadius+","+(margin.top+i*(legendWidth+legendSpacing))+")"});legend.append("rect").attr("x",45).attr("width",legendWidth).attr("height",legendWidth).attr("class","legend").on("mouseover",pieLegendMouseOver).on("mouseout",pieLegendMouseOut).style("fill",function(d,i){return colorSubset[i]}),legend.append("text").attr("x",60).attr("y",6).attr("dy",".35em").style("text-anchor","start").text(function(d){return d.categoryLongName});var pageText=svg.append("g").attr("class","pageNo").attr("transform","translate("+2.5*outerRadius+","+(margin.top+(legendPerPage+1)*(legendWidth+legendSpacing))+")");pageText.append("text").text(pageNo+"/"+totalPages).attr("dx",".90em");var prevtriangle=svg.append("g").attr("class","prev").attr("transform","translate("+2.45*outerRadius+","+(margin.top+(legendPerPage+1.5)*(legendWidth+legendSpacing))+")").on("click",prevLegend).style("cursor","pointer"),nexttriangle=svg.append("g").attr("class","next").attr("transform","translate("+2.75*outerRadius+","+(margin.top+(legendPerPage+1.5)*(legendWidth+legendSpacing))+")").on("click",nextLegend).style("cursor","pointer");nexttriangle.append("polygon").style("stroke","#000").style("fill","#000").attr("points","0,0, 10,0, 5,5"),prevtriangle.append("polygon").style("stroke","#000").style("fill","#000").attr("points","0,5, 10,5, 5,0"),pageNo==totalPages?(nexttriangle.style("opacity","0.5"),nexttriangle.on("click","").style("cursor","")):1==pageNo&&(prevtriangle.style("opacity","0.5"),prevtriangle.on("click","").style("cursor",""))}function prevLegend(){pageNo--,svg.selectAll("g.legendg").remove(),svg.select(".pageNo").remove(),svg.select(".prev").remove(),svg.select(".next").remove();for(var startIndex=(pageNo-1)*legendPerPage,endIndex=startIndex+legendPerPage,seriesSubset=[],colorSubset=[],i=0;i<legends.length;i++)i>=startIndex&&endIndex>i&&(seriesSubset.push(legends[i]),colorSubset.push(color[i]));DrawLegendSubset(seriesSubset,colorSubset,legendPerPage,pageNo,totalPages)}function nextLegend(){pageNo++,svg.selectAll("g.legendg").remove(),svg.select(".pageNo").remove(),svg.select(".prev").remove(),svg.select(".next").remove();for(var startIndex=(pageNo-1)*legendPerPage,endIndex=startIndex+legendPerPage,seriesSubset=[],colorSubset=[],i=0;i<legends.length;i++)i>=startIndex&&endIndex>i&&(seriesSubset.push(legends[i]),colorSubset.push(color[i]));DrawLegendSubset(seriesSubset,colorSubset,legendPerPage,pageNo,totalPages)}function pieLegendMouseOver(){var legendColor=this.style.fill,paths=svg.selectAll("path");paths[0].forEach(function(d,i){var pathColor=d3.select(d).attr("fill");d3.rgb(pathColor).toString()==d3.rgb(legendColor).toString()?d3.select(d).transition().duration(500).attr("d",biggerArc):d3.select(d).transition().duration(500).attr("d",arc)})}function pieLegendMouseOut(){var paths=svg.selectAll("path");paths[0].forEach(function(d,i){d3.select(d).transition().duration(500).attr("d",arc)})}var legendPerPage,totalPages,pageNo,legends=data,legendCount=legends.length,legendWidth=10,legendSpacing=6,diameter=2*outerRadius,netLegendHeight=(legendWidth+legendSpacing)*legendCount;if(netLegendHeight/diameter>1){legendPerPage=Math.floor(diameter/(legendWidth+legendSpacing)),totalPages=Math.ceil(legendCount/legendPerPage),pageNo=1;for(var startIndex=(pageNo-1)*legendPerPage,endIndex=startIndex+legendPerPage,seriesSubset=[],colorSubset=[],i=0;i<legends.length;i++)i>=startIndex&&endIndex>i&&(seriesSubset.push(legends[i]),colorSubset.push(color[i]));DrawLegendSubset(seriesSubset,colorSubset,legendPerPage,pageNo,totalPages)}else{var legendWidth=9,legendPosition=h/2-data.length/2*(legendWidth+7),legend=svg.selectAll(".legend").data(legends).enter().append("g").attr("transform",function(d,i){return"translate("+2*outerRadius+","+(legendPosition+16*i)+")"});legend.append("rect").attr("x",1.2*outerRadius-18).attr("width",9).attr("height",9).attr("class","legend").style("fill",function(d,i){return color[i]}),legend.append("text").attr("x",1.2*outerRadius-5).attr("y",9).style("text-anchor","start").text(function(d){return d.categoryLongName})}thisobj.utility.tooltip(svg,".legend",!1,!0)}this.data=data;var color=this.color,renderContainerId=this.renderContainerId,noOfSlice=this.noOfPieSlices,chartType=this.chartType,w=this.canvasWidth,h=this.canvasHeight;$("#"+renderContainerId+"_svg").remove(),$("#"+renderContainerId+"_select").remove();var originalData=jQuery.extend(!0,{},data);if(originalData.series.length>1)var select=d3.select("#"+renderContainerId).append("div").attr("id",renderContainerId+"_select").append("select").on("change",changeSeries.bind(this)),seriesOptions=select.selectAll("option").data(originalData.series).enter().append("option").attr("value",function(d){return d.value}).text(function(d){return d.name}).attr("font-family","sans-serif").attr("font-size","8");var innerRadius,series=data.series,legendDrawn=!1,r=Math.min(w,h),outerRadius=.3*r;this.outerRadius=outerRadius,"pie"==chartType.toLowerCase()?innerRadius=0:"donut"==chartType.toLowerCase()&&(innerRadius=.6*outerRadius);var arc=d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius),biggerArc=d3.svg.arc().innerRadius(innerRadius).outerRadius(1.1*outerRadius),pie=d3.layout.pie().padAngle(0).sort(null),svg=d3.select("#"+renderContainerId).append("svg").attr("id",renderContainerId+"_svg").attr("class","donutsvg").attr("width",w).attr("height",h);this.utility.addRadialFilter(svg,renderContainerId);var thisobj=this;drawPieDonut(series[0])},pieOrDonut.prototype.redraw=function(data){function changeSeries(){var selectedIndex=select.property("selectedIndex"),seriesdropdownData=seriesOptions[0][selectedIndex].__data__;drawPieDonut(seriesdropdownData),this.selectedIndex=selectedIndex}function drawPieDonut(dd_series){function tweenPie(b){b.innerRadius=0;var i=d3.interpolate({startAngle:0,endAngle:0},b);return function(t){return arc(i(t))}}svg.selectAll(".arc").remove(),svg.selectAll(".dArc").remove(),data=originalData;var dataValues=dd_series.data,pieData=(dd_series.fmtData,data.categories.map(function(d,i){return{category:d,categoryDimName:d.dimName,categoryLongName:d.longName,categoryName:d.name,categoryValue:d.value,fmtData:data.series[0].fmtData[i],data:+dataValues[i],seriesLongName:dd_series.longName,seriesName:dd_series.name,seriesValue:dd_series.value}}));pieData.sort(function(a,b){return parseFloat(b.data)-parseFloat(a.data)}),data=pieData;d3.sum(data,function(d){return d.data});if(data.length>noOfSlice){for(var finalPieData=[],sumOthers=d3.sum(data,function(d,j){return j>noOfSlice-2?d.data:0}),i=0;i<data.length;i++){if(!(noOfSlice-1>i)){finalPieData.push({category:"Others",categoryDimName:"Others",categoryLongName:"Others",categoryName:"Others",categoryValue:"Others",seriesLongName:"Others",seriesName:"Others",seriesValue:"Others",fmtData:sumOthers.toString(),data:sumOthers});break}finalPieData.push(data[i])}data=finalPieData}for(var dataset=data.map(function(d){return d}),sum=0,i=0;i<dataset.length;i++)sum+=dataset[i].data;var percentages=dataset.map(function(d){return parseFloat(100*d.data/sum).toFixed(2)}),percentSum=0,percentagesRoundOff=percentages.map(function(d,i){return i===percentages.length-1?100-percentSum:(percentSum+=Math.round(d),Math.round(d))}),arcData=pie(dataset.map(function(d){return d.data}));arcData.forEach(function(d,i){d.percent=percentages[i],d.category=dataset[i].category,d.index=i,d.categoryDimName=dataset[i].categoryDimName,d.categoryLongName=dataset[i].categoryLongName,d.categoryName=dataset[i].categoryName,d.categoryValue=dataset[i].categoryValue,d.fmtData=dataset[i].fmtData,d.seriesLongName=dataset[i].seriesLongName,d.seriesName=dataset[i].seriesName,d.seriesValue=dataset[i].seriesValue});var arcs=svg.selectAll("g.arc").data(arcData).enter().append("g").attr("class","arc").attr("transform","translate("+(outerRadius+40)+", "+h/2+")");arcs.append("path").attr("fill",function(d,i){return color[i]}).attr("class","pie").style("stroke",function(d,i){return d3.rgb(color[i]).darker(2)}).each(function(d){this._current=d,d.index===noOfSlice-1&&thisobj.dispatch.RenderComplete(arcData,thisobj)}).transition().ease("bounce").duration(1e3).attrTween("d",tweenPie),"donut"==chartType?arcs.append("text").attr("class","pietext").attr("transform",function(d){var centroid=arc.centroid(d);return"translate("+centroid+")"}).attr("dy",".35em").style("text-anchor","middle").style("font-size","10px").style("fill","white").text(function(d,i){return percentagesRoundOff[i]+"%"}).style("display",function(d,i){return parseFloat(percentages[i])>5?"block":"none"}):(arcs.append("text").attr("class","pietext").attr("transform",function(d){var offset=outerRadius/3,angle=(d.startAngle+d.endAngle)/2,xOff=Math.sin(angle)*offset,yOff=-Math.cos(angle)*offset,centroid=arc.centroid(d);return centroid[0]=centroid[0]+xOff,centroid[1]=centroid[1]+yOff,"translate("+centroid+")"}).attr("dy",".35em").style("text-anchor","middle").style("font-size","10px").style("fill","white").text(function(d,i){return percentagesRoundOff[i]+"%"}).style("display",function(d,i){return parseFloat(percentages[i])>5?"block":"none"}),thisobj.utility.tooltip(svg,".pie",!0,!0)),legendDrawn===!1&&(drawPieLegends(data),legendDrawn=!0)}function drawPieLegends(data){function DrawLegendSubset(seriesSubset,colorSubset,legendPerPage,pageNo,totalPages){var legend=svg.selectAll("g.legendg").data(seriesSubset).enter().append("g").attr("class","legendg").attr("transform",function(d,i){return"translate("+2*outerRadius+","+(margin.top+i*(legendWidth+legendSpacing))+")"});legend.append("rect").attr("x",45).attr("width",legendWidth).attr("height",legendWidth).attr("class","legend").on("mouseover",pieLegendMouseOver).on("mouseout",pieLegendMouseOut).style("fill",function(d,i){return colorSubset[i]}),legend.append("text").attr("x",60).attr("y",6).attr("dy",".35em").style("text-anchor","start").text(function(d){return d.categoryLongName});var pageText=svg.append("g").attr("class","pageNo").attr("transform","translate("+2.5*outerRadius+","+(margin.top+(legendPerPage+1)*(legendWidth+legendSpacing))+")");pageText.append("text").text(pageNo+"/"+totalPages).attr("dx",".90em");var prevtriangle=svg.append("g").attr("class","prev").attr("transform","translate("+2.45*outerRadius+","+(margin.top+(legendPerPage+1.5)*(legendWidth+legendSpacing))+")").on("click",prevLegend).style("cursor","pointer"),nexttriangle=svg.append("g").attr("class","next").attr("transform","translate("+2.75*outerRadius+","+(margin.top+(legendPerPage+1.5)*(legendWidth+legendSpacing))+")").on("click",nextLegend).style("cursor","pointer");nexttriangle.append("polygon").style("stroke","#000").style("fill","#000").attr("points","0,0, 10,0, 5,5"),prevtriangle.append("polygon").style("stroke","#000").style("fill","#000").attr("points","0,5, 10,5, 5,0"),pageNo==totalPages?(nexttriangle.style("opacity","0.5"),nexttriangle.on("click","").style("cursor","")):1==pageNo&&(prevtriangle.style("opacity","0.5"),prevtriangle.on("click","").style("cursor",""))}function prevLegend(){pageNo--,svg.selectAll("g.legendg").remove(),svg.select(".pageNo").remove(),svg.select(".prev").remove(),svg.select(".next").remove();for(var startIndex=(pageNo-1)*legendPerPage,endIndex=startIndex+legendPerPage,seriesSubset=[],colorSubset=[],i=0;i<legends.length;i++)i>=startIndex&&endIndex>i&&(seriesSubset.push(legends[i]),colorSubset.push(color[i]));DrawLegendSubset(seriesSubset,colorSubset,legendPerPage,pageNo,totalPages)}function nextLegend(){pageNo++,svg.selectAll("g.legendg").remove(),svg.select(".pageNo").remove(),svg.select(".prev").remove(),svg.select(".next").remove();for(var startIndex=(pageNo-1)*legendPerPage,endIndex=startIndex+legendPerPage,seriesSubset=[],colorSubset=[],i=0;i<legends.length;i++)i>=startIndex&&endIndex>i&&(seriesSubset.push(legends[i]),colorSubset.push(color[i]));DrawLegendSubset(seriesSubset,colorSubset,legendPerPage,pageNo,totalPages)}function pieLegendMouseOver(){var legendColor=this.style.fill,paths=svg.selectAll("path");paths[0].forEach(function(d,i){var pathColor=d3.select(d).attr("fill");d3.rgb(pathColor).toString()==d3.rgb(legendColor).toString()?d3.select(d).transition().duration(500).attr("d",biggerArc):d3.select(d).transition().duration(500).attr("d",arc)})}function pieLegendMouseOut(){var paths=svg.selectAll("path");paths[0].forEach(function(d,i){d3.select(d).transition().duration(500).attr("d",arc)})}var legendPerPage,totalPages,pageNo,legends=data,legendCount=legends.length,legendWidth=10,legendSpacing=6,diameter=2*outerRadius,netLegendHeight=(legendWidth+legendSpacing)*legendCount;if(netLegendHeight/diameter>1){legendPerPage=Math.floor(diameter/(legendWidth+legendSpacing)),totalPages=Math.ceil(legendCount/legendPerPage),pageNo=1;for(var startIndex=(pageNo-1)*legendPerPage,endIndex=startIndex+legendPerPage,seriesSubset=[],colorSubset=[],i=0;i<legends.length;i++)i>=startIndex&&endIndex>i&&(seriesSubset.push(legends[i]),colorSubset.push(color[i]));DrawLegendSubset(seriesSubset,colorSubset,legendPerPage,pageNo,totalPages)}else{var legendWidth=9,legendPosition=h/2-data.length/2*(legendWidth+7),legend=svg.selectAll(".legend").data(legends).enter().append("g").attr("transform",function(d,i){return"translate("+2*outerRadius+","+(legendPosition+16*i)+")"});legend.append("rect").attr("x",1.2*outerRadius-18).attr("width",9).attr("height",9).attr("class","legend").style("fill",function(d,i){return color[i]}),legend.append("text").attr("x",1.2*outerRadius-5).attr("y",9).style("text-anchor","start").text(function(d){return d.categoryLongName})}thisobj.utility.tooltip(svg,".legend",!1,!0)}this.data=data,this.removeOverlap();var color=this.color,renderContainerId=this.renderContainerId,noOfSlice=this.noOfPieSlices,chartType=this.chartType,w=this.canvasWidth,h=this.canvasHeight;$("#"+renderContainerId+"_svg").remove(),$("#"+renderContainerId+"_select").remove();var originalData=jQuery.extend(!0,{},data),thisobj=this;if(originalData.series.length>1)var select=d3.select("#"+renderContainerId).append("div").attr("id",renderContainerId+"_select").append("select").on("change",changeSeries.bind(this)),seriesOptions=select.selectAll("option").data(originalData.series).enter().append("option").attr("value",function(d){return d.value}).text(function(d){return d.name}).attr("font-family","sans-serif").attr("font-size","8");var innerRadius,series=data.series,legendDrawn=!1,r=Math.min(w,h),outerRadius=.3*r;this.outerRadius=outerRadius,"pie"==chartType.toLowerCase()?innerRadius=0:"donut"==chartType.toLowerCase()&&(innerRadius=.6*outerRadius);var arc=d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius),biggerArc=d3.svg.arc().innerRadius(innerRadius).outerRadius(1.1*outerRadius),pie=d3.layout.pie().padAngle(0).sort(null),svg=d3.select("#"+renderContainerId).append("svg").attr("id",renderContainerId+"_svg").attr("class","donutsvg").attr("width",w).attr("height",h);this.utility.addRadialFilter(svg,renderContainerId);var thisobj=this;drawPieDonut(series[0])},pieOrDonut.prototype.drawOverlap=function(overlappedData,originalData){function tweenPie(b){b.donutInnerRadius=0;var i=d3.interpolate({startAngle:0,endAngle:0},b);return function(t){return dArc(i(t))}}var renderContainerId=this.renderContainerId;originalData=this.data,overlappedData=this.utility.overlapDataPrep(overlappedData,originalData);var svg=d3.select("#"+renderContainerId+"_svg");svg.selectAll(".pie").style("opacity",.7);var index=this.selectedIndex;("undefined"==typeof index||""==index)&&(index=0);for(var noOfSlice=this.noOfPieSlices,donutInnerRadius=this.outerRadius,h=this.canvasHeight,arcs=(this.canvasWidth,this.arcs),color=this.color,i=0;i<overlappedData.overlappedSeries[index].data.length;i++){var difference=originalData.series[index].data[i]-overlappedData.overlappedSeries[index].data[i][0];overlappedData.overlappedSeries[index].data[i][1]=difference}var dataValues=overlappedData.overlappedSeries[index].data,pieData=originalData.categories.map(function(d,i){return{category:d,categoryDimName:d.dimName,categoryLongName:d.longName,categoryName:d.name,categoryValue:d.value,fmtData:overlappedData.overlappedSeries[0].fmtData[i][0],data:dataValues[i][0],seriesLongName:overlappedData.overlappedSeries[index].longName,seriesName:overlappedData.overlappedSeries[index].name,seriesValue:overlappedData.overlappedSeries[index].value}}),overlappedData=overlappedData.overlappedSeries[index].data,data=pieData,dataLength=originalData.series[index].data.length,otherOverlappedData=[];if(dataLength>noOfSlice){var sumOthers=0,median=Math.floor((dataLength-noOfSlice)/2);median=median+noOfSlice-2;for(var i=noOfSlice-1;median>=i;i++)sumOthers+=originalData.series[index].data[i];otherOverlappedData.push(sumOthers),sumOthers=0;for(var i=median+1;dataLength>i;i++)sumOthers+=originalData.series[index].data[i];otherOverlappedData.push(sumOthers)}overlappedData=overlappedData.slice(0,noOfSlice-1),overlappedData.push(otherOverlappedData),overlappedData=d3.merge(overlappedData);for(var dataset=overlappedData,sum=(d3.sum(data,function(d){return d.data}),0),i=0;i<dataset.length;i++)sum+=dataset[i];var percentages=dataset.map(function(d){return(d/sum*100).toFixed(2)}),percentSum=0,percentagesRoundOff=percentages.map(function(d,i){return i===percentages.length-1?100-percentSum:(percentSum+=Math.round(d),Math.round(d))});svg.selectAll(".dArc").remove();var donutOuterRadius=1.2*donutInnerRadius,arcInnerRadius=donutInnerRadius+2,dArc=d3.svg.arc().innerRadius(arcInnerRadius).outerRadius(donutOuterRadius),pie=d3.layout.pie().sort(null),arcData=pie(dataset),slices=svg.selectAll(".pie");slices[0].length<noOfSlice&&(noOfSlice=slices[0].length);var j=0;arcData.forEach(function(d,i){2*noOfSlice-2>i?(d.percent=percentages[i],d.category=pieData[j].category,d.categoryDimName=pieData[j].categoryDimName,d.categoryLongName=pieData[j].categoryLongName,d.categoryName=pieData[j].categoryName,d.categoryValue=pieData[j].categoryValue,d.fmtData=pieData[j].fmtData,d.seriesLongName=pieData[j].seriesLongName,d.seriesName=pieData[j].seriesName,d.seriesValue=pieData[j].seriesValue,i%2===0&&j++):(d.percent=percentages[i],d.category="Others",d.categoryDimName="Others",d.categoryLongName="Others",d.categoryName="Others",d.categoryValue="Others",d.fmtData=d.data.toString(),d.seriesLongName="Others",d.seriesName="Others",d.seriesValue="Others")});var arcs=svg.selectAll("g.dArc").data(arcData).enter().append("g").attr("class","dArc").attr("transform","translate("+(donutInnerRadius+40)+", "+h/2+")"),j=0;arcs.append("path").attr("class","outerDonut").attr("fill",function(d,i){return i%2==0?"#FFC200":color[j++]}).style("stroke","black").style("stroke-width","0.3px").style("opacity",function(d,i){return i%2==0?.9:.3}).each(function(d){this._current=d}).transition().ease("bounce").duration(1e3).attrTween("d",tweenPie),arcs.append("text").attr("class","pietext").attr("transform",function(d){var offset=donutOuterRadius/300,angle=(d.startAngle+d.endAngle)/2,xOff=Math.sin(angle)*offset,yOff=-Math.cos(angle)*offset,centroid=dArc.centroid(d);return centroid[0]=centroid[0]+xOff,centroid[1]=centroid[1]+yOff,"translate("+centroid+")"}).attr("dy",".35em").style("text-anchor","middle").style("font-size","10px").style("fill","white").text(function(d,i){return i%2==0?percentagesRoundOff[i]+"%":void 0}).style("display",function(d,i){return parseFloat(percentages[i])>1?"block":"none"}),this.utility.tooltip(svg,".outerDonut",!0,!0)},pieOrDonut.prototype.removeOverlap=function(data){var renderContainerId=this.renderContainerId,svg=d3.select("#"+renderContainerId+"_svg");svg.selectAll(".outerDonut").remove(),svg.selectAll(".pie").style("opacity",1)},pieOrDonut}(),xChart.segmentedGroupedColumn=function(){function segmentedGroupedColumn(renderContainerId,color,chartOptions){this.renderContainerId=renderContainerId,this.canvasWidth=document.getElementById(this.renderContainerId).offsetWidth,this.canvasHeight=document.getElementById(this.renderContainerId).offsetHeight,this.margin=jQuery.extend(!0,{},chartOptions.margin),this.color=color,this.axisRedrawThreshold=chartOptions.axisRedrawThreshold,this.aec=chartOptions.aec,this.utility=new xChart.utility,this.subCategoryScale=[],this.xWidth=[]}return segmentedGroupedColumn.prototype.dispatch=d3.dispatch("RenderComplete"),segmentedGroupedColumn.prototype.draw=function(data){var color=this.color,margin=this.margin,renderContainerId=(this.utility,this.renderContainerId),subCategoryScaleArray=this.subCategoryScale,xWidthArray=this.xWidth;$("#"+this.renderContainerId+"_svg").remove(),margin.bottom=90;var width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId).append("svg").attr("id",this.renderContainerId+"_svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).attr("class","segmentedGroupedColumn"),mainGroup=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").attr("id",this.renderContainerId+"_mainGroup").attr("class","segmentedGroupedColumn");svg=mainGroup;var si=d3.format(".2s"),siMod=function(val){return si(val).replace(/G/,"B")},maxData=d3.max(data.series,function(d){return d3.max(d.data)});this.seriesAxis=new xChart.axis(this.renderContainerId,width,height),this.utility.addLinearFilter(svg,this.renderContainerId);var seriesAxisOptions={};seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=width,seriesAxisOptions.orient="left",seriesAxisOptions.position="vertical",seriesAxisOptions.showPath=!1,seriesAxisOptions.tickFormat=siMod,this.seriesAxis.setOptions(seriesAxisOptions);var seriesScale=this.seriesAxis.addQuantitativeScale(data.series,.1,0,height,0,maxData);this.yAxis=this.seriesAxis.draw(seriesScale);var pointCount=0,totalDataPointCount=0;data.series.forEach(function(d){totalDataPointCount+=d.data.length});var xWidth=0;data.categories.forEach(function(d,i){svg.append("line").style("stroke","grey").attr("x1",xWidth).attr("y1",height).attr("x2",xWidth).attr("y2",height+margin.bottom);var subCategoryCount=data.series[i].value.length,partialWidth=subCategoryCount/totalDataPointCount*width,subCategoryScale=d3.scale.ordinal().rangeBands([0,partialWidth],.025,.4).domain(data.series[i].value);subCategoryScaleArray.push(subCategoryScale);var subCategoryAxis=d3.svg.axis().scale(subCategoryScale).orient("bottom"),subCatAxis=svg.append("g").attr("class","x axis axis_"+i).attr("id",renderContainerId+"_xaxis").attr("transform","translate("+xWidth+","+height+")").call(subCategoryAxis),ticks=subCatAxis.selectAll("text").text(function(e,j){return data.series[i].name[j].substring(0,10)});subCatAxis.selectAll("path").style("stroke","grey"),ticks.attr("y",0).attr("x",9).attr("dy",".35em").attr("transform","rotate(90)").style("text-anchor","start");var categoryScale=d3.scale.ordinal().rangeBands([0,partialWidth]);categoryScale.domain([d.value]);var categoryAxis=d3.svg.axis().scale(categoryScale).orient("bottom").tickSize(0,-margin.bottom/2-55),parentAxis=svg.append("g").attr("class","x axis parent").attr("id",renderContainerId+"_xaxis"+i).style("stroke-dasharray","3, 3").attr("transform","translate("+xWidth+","+(height+margin.bottom-20)+")").call(categoryAxis);parentAxis.selectAll(".tick line").remove(),parentAxis.selectAll("path").remove();var current_category=d,current_index=i;svg.selectAll(".bar .bar_"+i).data(function(){for(var rArray=[],x=0;x<data.series[current_index].value.length;x++)rArray.push({categoryIndex:current_index,index:current_index,fmtData:data.series[current_index].fmtData[x],data:data.series[current_index].data[x],seriesLongName:data.series[current_index].longName[x],seriesName:data.series[current_index].name[x],seriesValue:data.series[current_index].value[x],seriesIndex:x,categoryValue:current_category.value,categoryName:current_category.name,categoryDimName:current_category.dimName,categoryLongName:current_category.longName});return rArray}).enter().append("rect").attr("class","bar bar_"+i).attr("x",function(e){return xWidth+subCategoryScale(e.seriesLongName)}).attr("width",subCategoryScale.rangeBand()).attr("y",height).attr("height",0).style("fill",function(d){return color[i]}).transition().duration(1e3).ease("bounce").attr("y",function(f,j){return seriesScale(data.series[i].data[j])}).attr("height",function(f,j){return Math.abs(seriesScale(data.series[i].data[j])-height)}).each("end",function(d){pointCount++,pointCount===totalDataPointCount&&this.dispatch.RenderComplete(data,this)}.bind(this)),xWidthArray.push(xWidth),xWidth+=partialWidth}.bind(this)),svg.append("line").style("stroke","grey").attr("x1",xWidth).attr("y1",height).attr("x2",xWidth).attr("y2",height+margin.bottom),this.utility.tooltip(svg,".bar",!0,!1)},segmentedGroupedColumn.prototype.redraw=function(data){this.draw(data)},segmentedGroupedColumn.prototype.drawOverlap=function(overlappedData,originalData){var xWidth=this.xWidth,seriesScale=this.seriesAxis.scale,subCategoryScale=this.subCategoryScale,margin=this.margin,height=(this.canvasWidth-margin.left-margin.right,this.canvasHeight-margin.top-margin.bottom),svg=d3.select("#"+this.renderContainerId+"_mainGroup");svg.selectAll(".overlappedBar").remove(),originalData.categories.forEach(function(d,i){overlappedData.categories.forEach(function(e,j){if(d.value===e.value){var partialWidth=xWidth[i],current_category=e,current_index=j;svg.selectAll(".overlappedBar .bar_"+j).data(function(){for(var rArray=[],x=0;x<overlappedData.series[current_index].value.length;x++)rArray.push({fmtData:overlappedData.series[current_index].fmtData[x],seriesLongName:overlappedData.series[current_index].longName[x],categoryLongName:current_category.longName});return rArray}).enter().append("rect").attr("class","overlappedBar bar_"+j).attr("x",function(f){return partialWidth+subCategoryScale[i](f.seriesLongName)}).attr("width",subCategoryScale[i].rangeBand()).attr("y",height).attr("height",0).style("fill","#FFC200").transition().duration(1e3).ease("bounce").attr("y",function(f,k){return seriesScale(overlappedData.series[j].data[k])}).attr("height",function(f,k){return Math.abs(seriesScale(overlappedData.series[j].data[k])-height)})}})}),this.utility.tooltip(svg,".overlappedBar",!0,!1)},segmentedGroupedColumn.prototype.removeOverlap=function(data){var margin=this.margin,height=(this.canvasWidth-margin.left-margin.right,this.canvasHeight-margin.top-margin.bottom),svg=d3.select("#"+this.renderContainerId+"_mainGroup");svg.selectAll(".overlappedBar").data([]).exit().transition().duration(1e3).ease("bounce").attr("y",height).attr("height",0).remove()},segmentedGroupedColumn}(),xChart.stackedBar=function(){function stackedBar(renderContainerId,color,chartOptions){this.renderContainerId=renderContainerId,this.canvasWidth=document.getElementById(this.renderContainerId).offsetWidth,this.canvasHeight=document.getElementById(this.renderContainerId).offsetHeight,this.margin=jQuery.extend(!0,{},chartOptions.margin),this.color=color,this.margin.left=80,this.utility=new xChart.utility}return stackedBar.prototype.dispatch=d3.dispatch("RenderComplete"),stackedBar.prototype.draw=function(data){function ConvertDataSet(data){for(var indata=data,newdataset=[],j=0;j<indata.series.length;++j){for(var t={},dataele=[],i=0;i<indata.categories.length;++i)dataele.push({seriesName:indata.series[j].name,seriesLongName:indata.series[j].longName,seriesValue:indata.series[j].value,index:i,seriesIndex:j,category:indata.categories[i],
categoryDimName:indata.categories[i].dimName,categoryName:indata.categories[i].name,categoryLongName:indata.categories[i].longName,categoryValue:indata.categories[i].value,value:indata.series[j].data[i],fmtValue:indata.series[j].fmtData[i]});t.data=dataele,t.name=indata.series[j].name,t.longName=indata.series[j].longName,t.value=indata.series[j].value,newdataset.push(t)}return newdataset}var color=this.color,margin=this.margin,sBStartPoint=[];this.sBStartPoint=sBStartPoint,$("#"+this.renderContainerId+"_svg").remove();var width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId).append("svg").attr("id",this.renderContainerId+"_svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).attr("class","stackedBar"),mainGroup=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").attr("id",this.renderContainerId+"_mainGroup").attr("class","stackedBar"),legend=new xChart.legend(data.series,color),legendRows=legend.drawLegend("top",mainGroup,width,margin)+1;margin.top=20*legendRows,mainGroup.selectAll(".legendg").remove(),height=this.canvasHeight-margin.top-margin.bottom,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mainGroup.attr("transform","translate("+margin.left+","+margin.top+")"),svg=mainGroup,legend.drawLegend("top",svg,width,margin);var si=d3.format(".2s"),siMod=function(val){return si(val).replace(/G/,"B")};this.utility.addLinearFilter(svg,this.renderContainerId);var newdataset=ConvertDataSet(data),dataset=newdataset;dataset=dataset.map(function(d){return d.data.map(function(o,i){return{y:o.value,fmt:o.fmtValue,x:o.categoryName,category:o.category,categoryDimName:o.categoryDimName,categoryName:o.categoryName,categoryLongName:o.categoryLongName,categoryValue:o.categoryValue,index:o.index,seriesIndex:o.seriesIndex,seriesName:o.seriesName,seriesLongName:o.seriesLongName,seriesValue:o.seriesValue}})});var stack=d3.layout.stack();dataset=stack(dataset),dataset=dataset.map(function(group){return group.map(function(d){return{x:d.y,y:d.categoryValue,x0:d.y0,data:d.y,category:d.category,categoryDimName:d.categoryDimName,categoryName:d.categoryName,categoryLongName:d.categoryLongName,categoryValue:d.categoryValue,index:d.index,seriesIndex:d.seriesIndex,seriesName:d.seriesName,seriesLongName:d.seriesLongName,seriesValue:d.seriesValue,fmtData:d.fmt}})});var xMax=d3.max(dataset,function(group){return d3.max(group,function(d){return d.x+d.x0})});this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="left",categoryAxisOptions.position="vertical",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.yAxis=this.categoryAxis.draw(categoryScale),this.seriesAxis=new xChart.axis(this.renderContainerId,width,height);var seriesAxisOptions={};seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=height,seriesAxisOptions.orient="bottom",seriesAxisOptions.position="horizontal",seriesAxisOptions.showPath=!1,seriesAxisOptions.tickFormat=siMod,this.seriesAxis.setOptions(seriesAxisOptions);var seriesScale=this.seriesAxis.addQuantitativeScale(data.series,.1,width,0,0,xMax);this.yAxis=this.seriesAxis.draw(seriesScale,{x:0,y:height});var groups=svg.selectAll(".group").data(dataset).enter().append("g").attr("class","group").style("fill",function(d,i){return color[i]});svg.selectAll(".group").data(data).attr("class","group"),groups=svg.selectAll(".group");var bars=groups.selectAll("rect").data(function(d){return d});bars.enter().append("rect").attr("class","bar").attr("rx",1).attr("ry",1),bars.transition().attr("x",0).attr("y",function(d,i){return categoryScale(d.y)}).attr("height",function(d){return categoryScale.rangeBand()}).attr("width",0).transition().ease("bounce").duration(1e3).attr("x",function(d){return sBStartPoint.push(seriesScale(d.x0)),seriesScale(d.x0)}).attr("width",function(d){return seriesScale(d.x)}).each("end",function(d){d.index===data.categories.length-1&&d.seriesIndex==data.series.length-1&&this.dispatch.RenderComplete(data,this)}.bind(this)),this.utility.tooltip(svg,".bar",!0,!1)},stackedBar.prototype.redraw=function(data){function ConvertDataSet(data){for(var indata=data,newdataset=[],j=0;j<indata.series.length;++j){for(var t={},dataele=[],i=0;i<indata.categories.length;++i)dataele.push({seriesName:indata.series[j].name,seriesLongName:indata.series[j].longName,seriesValue:indata.series[j].value,index:i,seriesIndex:j,category:indata.categories[i],categoryDimName:indata.categories[i].dimName,categoryName:indata.categories[i].name,categoryLongName:indata.categories[i].longName,categoryValue:indata.categories[i].value,value:indata.series[j].data[i],fmtValue:indata.series[j].fmtData[i]});t.data=dataele,t.name=indata.series[j].name,t.longName=indata.series[j].longName,t.value=indata.series[j].value,newdataset.push(t)}return newdataset}function redrawBars(that){var groups=svg.selectAll(".group").data(dataset).enter().append("g").attr("class","group").style("fill",function(d,i){return color[i]});svg.selectAll(".group").data(data).attr("class","group"),groups=svg.selectAll(".group");var bars=groups.selectAll("rect").data(function(d){return d});bars.enter().append("rect").attr("class","bar").attr("rx",1).attr("ry",1).attr("y",function(d,i){return categoryScale(d.y)}).attr("height",function(d){return categoryScale.rangeBand()}).attr("x",function(d){return sBStartPoint.push(seriesScale(d.x0)),seriesScale(d.x0)}).attr("width",function(d){return seriesScale(d.x)}).each(function(d){d.index===data.categories.length-1&&d.seriesIndex==data.series.length-1&&that.dispatch.RenderComplete(data,that)}.bind(that)),that.utility.tooltip(svg,".bar",!0,!1)}this.removeOverlap(data);var color=this.color,margin=this.margin,width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,sBStartPoint=[];this.sBStartPoint=sBStartPoint;var svg=d3.select("#"+this.renderContainerId+"_svg"),mainGroup=d3.select("#"+this.renderContainerId+"_mainGroup"),legend=new xChart.legend(data.series,color),legendRows=legend.drawLegend("top",mainGroup,width,margin)+1;margin.top=20*legendRows,mainGroup.selectAll(".legendg").remove(),height=this.canvasHeight-margin.top-margin.bottom,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mainGroup.attr("transform","translate("+margin.left+","+margin.top+")"),svg=mainGroup,legend.drawLegend("top",svg,width,margin);var si=d3.format(".2s"),siMod=function(val){return si(val).replace(/G/,"B")};this.utility.addLinearFilter(svg,this.renderContainerId);var newdataset=ConvertDataSet(data),dataset=newdataset;dataset=dataset.map(function(d){return d.data.map(function(o,i){return{y:o.value,fmt:o.fmtValue,x:o.categoryName,category:o.category,categoryDimName:o.categoryDimName,categoryName:o.categoryName,categoryLongName:o.categoryLongName,categoryValue:o.categoryValue,index:o.index,seriesIndex:o.seriesIndex,seriesName:o.seriesName,seriesLongName:o.seriesLongName,seriesValue:o.seriesValue}})});var stack=d3.layout.stack();dataset=stack(dataset),dataset=dataset.map(function(group){return group.map(function(d){return{x:d.y,y:d.categoryValue,x0:d.y0,data:d.y,category:d.category,categoryDimName:d.categoryDimName,categoryName:d.categoryName,categoryLongName:d.categoryLongName,categoryValue:d.categoryValue,index:d.index,seriesIndex:d.seriesIndex,seriesName:d.seriesName,seriesLongName:d.seriesLongName,seriesValue:d.seriesValue,fmtData:d.fmt}})});var xMax=d3.max(dataset,function(group){return d3.max(group,function(d){return d.x+d.x0})});this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="left",categoryAxisOptions.position="vertical",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.yAxis=this.categoryAxis.draw(categoryScale),this.seriesAxis=new xChart.axis(this.renderContainerId,width,height);var seriesAxisOptions={};seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=height,seriesAxisOptions.orient="bottom",seriesAxisOptions.position="horizontal",seriesAxisOptions.showPath=!1,seriesAxisOptions.tickFormat=siMod,this.seriesAxis.setOptions(seriesAxisOptions);var seriesScale=this.seriesAxis.addQuantitativeScale(data.series,.1,width,0,0,xMax);this.yAxis=this.seriesAxis.draw(seriesScale,{x:0,y:height});var groups=svg.selectAll(".group").data(dataset);groups.exit().remove(),groups.enter().append("g").attr("class","group").style("fill",function(d,i){return color[i]}),svg.selectAll(".group").data(data).attr("class","group"),groups=svg.selectAll(".group");var bars=groups.selectAll("rect");bars.attr("y",function(d,i){return categoryScale(d.y)}).attr("height",function(d){return categoryScale.rangeBand()}).transition().ease("bounce").duration(1e3).attr("x",function(d){return seriesScale(d.x0)}).attr("width",function(d){return seriesScale(d.x)}),bars=groups.selectAll("rect").data(function(d){return d}),bars.exit().remove(),bars.enter().append("rect").attr("class","bar").attr("rx",1).attr("ry",1).attr("x",0).attr("width",0),bars.attr("y",function(d,i){return categoryScale(d.y)}).attr("height",function(d){return categoryScale.rangeBand()}).transition().ease("bounce").duration(1e3).attr("x",function(d){return sBStartPoint.push(seriesScale(d.x0)),seriesScale(d.x0)}).attr("width",function(d){return seriesScale(d.x)}).each("end",function(d){d.index===data.categories.length-1&&d.seriesIndex==data.series.length-1&&(svg.selectAll(".group").remove(),redrawBars(this))}.bind(this))},stackedBar.prototype.drawOverlap=function(overlappedData,originalData){function ConvertDataSet(data){for(var indata=data,newdataset=[],j=0;j<indata.overlappedSeries.length;++j){for(var t={},dataele=[],i=0;i<indata.categories.length;++i)dataele.push({overlappedSeriesName:indata.overlappedSeries[j].name,overlappedSeriesLongName:indata.overlappedSeries[j].longName,overlappedSeriesValue:indata.overlappedSeries[j].value,category:indata.categories[i],categoryDimName:indata.categories[i].dimName,categoryName:indata.categories[i].name,categoryLongName:indata.categories[i].longName,categoryValue:indata.categories[i].value,value:indata.overlappedSeries[j].data[i][0],fmtValue:indata.overlappedSeries[j].fmtData[i][0]});t.data=dataele,t.name=indata.overlappedSeries[j].name,t.longName=indata.overlappedSeries[j].longName,t.value=indata.overlappedSeries[j].value,newdataset.push(t)}return newdataset}overlappedData=this.utility.overlapDataPrep(overlappedData,originalData);var xScale=this.seriesAxis.scale,yScale=this.categoryAxis.scale,sBStartPoint=this.sBStartPoint,svg=d3.select("#"+this.renderContainerId+"_mainGroup");svg.selectAll(".bar").style("opacity",.7);var newdataset=ConvertDataSet(overlappedData),dataset=newdataset;dataset=dataset.map(function(d){return d.data.map(function(o,i){return{y:o.value,fmt:o.fmtValue,x:o.categoryName,category:o.category,categoryDimName:o.categoryDimName,categoryLongName:o.categoryLongName,categoryValue:o.categoryValue,seriesName:o.overlappedSeriesName,seriesLongName:o.overlappedSeriesLongName,seriesValue:o.overlappedSeriesValue}})});var stack=d3.layout.stack();dataset=stack(dataset);var dataset=dataset.map(function(group){return group.map(function(d){return{x:d.y,y:d.categoryValue,x0:d.y0,data:d.y,category:d.category,categoryDimName:d.categoryDimName,categoryLongName:d.categoryLongName,categoryValue:d.categoryValue,SeriesName:d.seriesName,seriesLongName:d.seriesLongName,SeriesValue:d.seriesValue,fmtData:d.fmt}})}),xi=0,Ogroups=svg.selectAll(".overlappedGroup").data(dataset).enter().append("g").attr("class","overlappedGroup").style("fill","#FFC200").style("stroke","black").style("stroke-width","0.3px");Ogroups=svg.selectAll(".overlappedGroup");var overlappedBars=Ogroups.selectAll("rect").data(function(d){return d});overlappedBars.exit().remove(),overlappedBars.enter().append("rect").attr("class","overlappedBar").attr("rx",1).attr("ry",1).attr("width",0),overlappedBars.transition().duration(1e3).ease("bounce").attr("x",function(){return sBStartPoint[xi++]}).attr("y",function(d,i){return yScale(d.y)}).attr("height",function(d){return yScale.rangeBand()}).attr("width",function(d){return xScale(d.x)}),this.utility.tooltip(svg,".overlappedBar",!0,!1)},stackedBar.prototype.removeOverlap=function(data){for(var tempData=[],i=data.series.length-1;i>=0;i--)tempData.push({});var xScale=this.seriesAxis.scale,svg=(this.categoryAxis.scale,d3.select("#"+this.renderContainerId+"_mainGroup")),overlappedBars=svg.selectAll(".overlappedGroup").data(tempData).enter().append("g").attr("class","overlappedGroup").style("fill","#FFC200");overlappedBars=svg.selectAll(".overlappedGroup").selectAll("rect").data(function(d){return d}),overlappedBars.enter().append("rect").attr("class","overlappedBar").attr("width",function(d){return xScale(d.x)}),overlappedBars.exit().transition().duration(1e3).ease("bounce").attr("width",0).remove().each("end",function(){svg.selectAll(".bar").style("opacity",1);var outerBars=svg.selectAll(".overlappedBar");outerBars.remove()})},stackedBar}(),xChart.stackedColumn=function(){function stackedColumn(renderContainerId,color,chartOptions){this.renderContainerId=renderContainerId,this.canvasWidth=document.getElementById(this.renderContainerId).offsetWidth,this.canvasHeight=document.getElementById(this.renderContainerId).offsetHeight,this.margin=jQuery.extend(!0,{},chartOptions.margin),this.color=color,this.axisRedrawThreshold=chartOptions.axisRedrawThreshold,this.aec=chartOptions.aec,this.utility=new xChart.utility}return stackedColumn.prototype.dispatch=d3.dispatch("RenderComplete"),stackedColumn.prototype.draw=function(data){var color=this.color,margin=this.margin,sCHeight=[],sCStartPoint=[];this.sCHeight=sCHeight,this.sCStartPoint=sCStartPoint,$("#"+this.renderContainerId+"_svg").remove();var width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId).append("svg").attr("id",this.renderContainerId+"_svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).attr("class","stackedColumn"),mainGroup=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").attr("id",this.renderContainerId+"_mainGroup").attr("class","stackedColumn"),axisLabelOverlap=this.utility.draw_xAxisDummy(mainGroup,data.categories,height,width,this.renderContainerId);axisLabelOverlap&&(margin.bottom*=2,this.bottomMarginSet=!0);var legend=new xChart.legend(data.series,color),legendRows=legend.drawLegend("top",mainGroup,width,margin)+1;margin.top=20*legendRows,mainGroup.selectAll(".legendg").remove(),height=this.canvasHeight-margin.top-margin.bottom,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mainGroup.attr("transform","translate("+margin.left+","+margin.top+")"),svg=mainGroup,legend.drawLegend("top",svg,width,margin);var si=d3.format(".2s"),siMod=function(val){return si(val).replace(/G/,"B")};this.utility.addLinearFilter(svg,this.renderContainerId);for(var sumArray=[],i=0;i<data.categories.length;i++){for(var sum=0,j=0;j<data.series.length;j++)sum+=data.series[j].data[i];sumArray.push(sum)}this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="bottom",categoryAxisOptions.position="horizontal",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.categoryScale=categoryScale,this.xAxis=this.categoryAxis.draw(categoryScale,{x:0,y:height}),this.seriesAxis=new xChart.axis(this.renderContainerId,width,height);var seriesAxisOptions={};seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=width,seriesAxisOptions.orient="left",seriesAxisOptions.position="vertical",seriesAxisOptions.showPath=!1,seriesAxisOptions.tickFormat=siMod,this.seriesAxis.setOptions(seriesAxisOptions);var seriesScale=this.seriesAxis.addQuantitativeScale(data.series,.1,0,height,0,d3.max(sumArray));this.yAxis=this.seriesAxis.draw(seriesScale),this.subCategoryScale=d3.scale.ordinal().domain(data.series.map(function(d){return d.value})).rangeBands([0,categoryScale.rangeBand()]);var barGroups=svg.selectAll(".outerbar").data(data.categories).enter().append("g").attr("class","outerbar").attr("transform",function(d){return"translate("+categoryScale(d.value)+",0)"}.bind(this)),bars=barGroups.selectAll("rect").data(function(d,i){for(var rArray=[],y0=0,x=0;x<data.series.length;x++)rArray.push({seriesName:data.series[x].name,y0:y0,y1:y0+data.series[x].data[i],index:i,seriesIndex:x,seriesLongName:data.series[x].longName,seriesValue:data.series[x].value,data:data.series[x].data[i],fmtData:data.series[x].fmtData[i],category:d,categoryLongName:null===data.categories[i]?"":data.categories[i].longName,categoryName:d.name,categoryDimName:d.dimName,categoryValue:d.value}),y0+=data.series[x].data[i];return rArray});bars.enter().append("rect").attr("class","bar").style("fill",function(d,i){return color[i]}).style("stroke",function(d,i){return color[i]}).style("stroke-width","1").attr("height",function(d){return 0}).attr("y",function(d){return height}).attr("width",categoryScale.rangeBand()).transition().ease("bounce").duration(1e3).attr("height",function(d){return sCHeight.push(seriesScale(d.y0)-seriesScale(d.y1)),seriesScale(d.y0)-seriesScale(d.y1)}).attr("y",function(d){return sCStartPoint.push(seriesScale(d.y1)),seriesScale(d.y1)}).each("end",function(d){d.index===data.categories.length-1&&d.seriesIndex==data.series.length-1&&this.dispatch.RenderComplete(data,this)}.bind(this)),this.utility.tooltip(svg,".bar",!0,!1)},stackedColumn.prototype.redraw=function(data){function redrawBars(that){var barGroups=svg.selectAll(".outerbar").data(data.categories).enter().append("g").attr("class","outerbar").attr("transform",function(d){return"translate("+categoryScale(d.value)+",0)"}),bars=barGroups.selectAll("rect").data(function(d,i){for(var rArray=[],y0=0,x=0;x<data.series.length;x++)rArray.push({seriesName:data.series[x].name,y0:y0,y1:y0+data.series[x].data[i],index:i,seriesIndex:x,seriesLongName:data.series[x].longName,seriesValue:data.series[x].value,data:data.series[x].data[i],fmtData:data.series[x].fmtData[i],category:d,categoryLongName:null===data.categories[i]?"":data.categories[i].longName,categoryName:d.name,categoryDimName:d.dimName,categoryValue:d.value}),y0+=data.series[x].data[i];return rArray});bars.enter().append("rect").attr("class","bar").style("fill",function(d,i){return color[i]}).style("stroke",function(d,i){return color[i]}).style("stroke-width","1").attr("width",categoryScale.rangeBand()).attr("height",function(d){return sCHeight.push(seriesScale(d.y0)-seriesScale(d.y1)),seriesScale(d.y0)-seriesScale(d.y1)}).attr("y",function(d){return sCStartPoint.push(seriesScale(d.y1)),seriesScale(d.y1)}).each(function(d){d.index===data.categories.length-1&&d.seriesIndex==data.series.length-1&&that.dispatch.RenderComplete(data,that)}.bind(that)),that.utility.tooltip(svg,".bar",!0,!1)}this.removeOverlap();var color=this.color,margin=this.margin,sCHeight=[],sCStartPoint=[];this.sCHeight=sCHeight,this.sCStartPoint=sCStartPoint;var width=this.canvasWidth-margin.left-margin.right,height=this.canvasHeight-margin.top-margin.bottom,svg=d3.select("#"+this.renderContainerId+"_svg"),mainGroup=d3.select("#"+this.renderContainerId+"_mainGroup"),axisLabelOverlap=this.utility.draw_xAxisDummy(mainGroup,data.categories,height,width,this.renderContainerId);!axisLabelOverlap&&this.bottomMarginSet&&(margin.bottom/=2);var legend=new xChart.legend(data.series,color),legendRows=legend.drawLegend("top",mainGroup,width,margin)+1;margin.top=20*legendRows,mainGroup.selectAll(".legendg").remove(),height=this.canvasHeight-margin.top-margin.bottom,svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),mainGroup.attr("transform","translate("+margin.left+","+margin.top+")"),svg=mainGroup,legend.drawLegend("top",svg,width,margin);var si=d3.format(".2s"),siMod=function(val){return si(val).replace(/G/,"B")};this.utility.addLinearFilter(svg,this.renderContainerId);for(var sumArray=[],i=0;i<data.categories.length;i++){for(var sum=0,j=0;j<data.series.length;j++)sum+=data.series[j].data[i];sumArray.push(sum)}this.categoryAxis=new xChart.axis(this.renderContainerId,width,height);var categoryAxisOptions={};categoryAxisOptions.ticks=5,categoryAxisOptions.orient="bottom",categoryAxisOptions.position="horizontal",this.categoryAxis.setOptions(categoryAxisOptions);var categoryScale=this.categoryAxis.addQualitativeScale(data.categories,.1,.2);this.categoryScale=categoryScale,this.xAxis=this.categoryAxis.draw(categoryScale,{x:0,y:height}),this.seriesAxis=new xChart.axis(this.renderContainerId,width,height);var seriesAxisOptions={};seriesAxisOptions.ticks=5,seriesAxisOptions.tickSize=width,seriesAxisOptions.orient="left",seriesAxisOptions.position="vertical",seriesAxisOptions.showPath=!1,seriesAxisOptions.tickFormat=siMod,this.seriesAxis.setOptions(seriesAxisOptions);var seriesScale=this.seriesAxis.addQuantitativeScale(data.series,.1,0,height,0,d3.max(sumArray));this.seriesAxis.draw(seriesScale),this.subCategoryScale=d3.scale.ordinal().domain(data.series.map(function(d){return d.value})).rangeBands([0,categoryScale.rangeBand()]);var currentMax=(this.subCategoryScale,d3.max(sumArray)),previousMax=this.seriesAxis.scale.domain()[1]/(1+this.aec),seriesScale="";Math.abs((previousMax-currentMax)/currentMax)>this.axisRedrawThreshold?(seriesScale=this.seriesAxis.addQuantitativeScale(data.series,this.aec,0,height,0,currentMax),this.yAxis=this.seriesAxis.draw(seriesScale)):seriesScale=this.seriesAxis.scale;var barGroups=svg.selectAll(".outerbar").data(data.categories);barGroups.exit().remove(),barGroups.enter().append("g").attr("class","outerbar").attr("transform",function(d){return"translate("+(categoryScale(d.value)+this.subCategoryScale.rangeBand()/2)+",0)"}.bind(this)),barGroups.transition().duration(400).attr("transform",function(d){return"translate("+categoryScale(d.value)+",0)"}.bind(this));var bars=barGroups.selectAll("rect").data(function(d,i){for(var rArray=[],y0=0,x=0;x<data.series.length;x++)rArray.push({seriesName:data.series[x].name,y0:y0,y1:y0+data.series[x].data[i],index:i,seriesIndex:x,seriesLongName:data.series[x].longName,seriesValue:data.series[x].value,data:data.series[x].data[i],fmtData:data.series[x].fmtData[i],category:d,categoryLongName:null===data.categories[i]?"":data.categories[i].longName,categoryName:d.name,categoryDimName:d.dimName,categoryValue:d.value}),y0+=data.series[x].data[i];return rArray});bars.exit().remove(),bars.enter().append("rect").attr("class","bar").style("fill",function(d,i){return color[i]}).style("stroke",function(d,i){return color[i]}).style("stroke-width","1").attr("height",0).attr("y",function(d){return height}),bars.transition().ease("bounce").duration(1e3).attr("width",categoryScale.rangeBand()).attr("height",function(d){return sCHeight.push(seriesScale(d.y0)-seriesScale(d.y1)),seriesScale(d.y0)-seriesScale(d.y1)}).attr("y",function(d){return sCStartPoint.push(seriesScale(d.y1)),seriesScale(d.y1)}).each("end",function(d){d.index===data.categories.length-1&&d.seriesIndex==data.series.length-1&&(svg.selectAll(".outerbar").remove(),redrawBars(this))}.bind(this))},stackedColumn.prototype.drawOverlap=function(overlappedData,originalData){overlappedData=this.utility.overlapDataPrep(overlappedData,originalData);var seriesScale=(this.subCategoryScale,this.seriesAxis.scale),categoryScale=this.categoryScale,sCHeight=this.sCHeight,sCStartPoint=this.sCStartPoint,svg=d3.select("#"+this.renderContainerId+"_mainGroup");svg.selectAll(".bar").style("opacity",.7);var overlappedBars=(this.subCategoryScale,svg.selectAll(".overlappedBar").data(originalData.categories).enter().append("g").attr("class","overlappedBar").attr("transform",function(d){return"translate("+categoryScale(d.value)+",0)"}));overlappedBars=svg.selectAll(".overlappedBar").selectAll("rect").data(function(d,i){for(var rArray=[],y0=0,x=0;x<overlappedData.overlappedSeries.length;x++)rArray.push({seriesName:overlappedData.overlappedSeries[x].name,y0:y0,y1:y0+overlappedData.overlappedSeries[x].data[i][0],index:i,seriesLongName:overlappedData.overlappedSeries[x].longName,seriesValue:overlappedData.overlappedSeries[x].value,data:overlappedData.overlappedSeries[x].data[i][0],fmtData:overlappedData.overlappedSeries[x].fmtData[i][0],category:d,categoryLongName:null==overlappedData.categories[i]?"":overlappedData.categories[i].longName,categoryName:overlappedData.categories[i].name,categoryValue:overlappedData.categories[i].value,categoryDimName:overlappedData.categories[i].dimName}),y0+=overlappedData.overlappedSeries[x].data[i][0];return rArray});var yi=0;overlappedBars.enter().append("rect").attr("class","ObarRect").attr("y",function(d){var s=sCStartPoint[yi]+sCHeight[yi];return yi++,s}).attr("height",0).attr("width",categoryScale.rangeBand()).style("fill","#FFC200").style("opacity",1).style("stroke","black").style("stroke-width","0.3px"),yi=0,overlappedBars.exit().remove(),overlappedBars.transition().duration(1e3).ease("bounce").attr("y",function(d,i){var s=sCStartPoint[yi]+sCHeight[yi]-(seriesScale(d.y0)-seriesScale(d.y1));return yi++,s}).attr("height",function(d){return seriesScale(d.y0)-seriesScale(d.y1)}),this.utility.tooltip(svg,".ObarRect",!0,!1)},stackedColumn.prototype.removeOverlap=function(data){var seriesScale=(this.subCategoryScale,this.seriesAxis.scale),categoryScale=this.categoryScale,sCHeight=this.sCHeight,sCStartPoint=this.sCStartPoint,svg=d3.select("#"+this.renderContainerId+"_mainGroup"),overlappedBars=svg.selectAll(".overlappedBar").data(function(d){var rArray=[];return rArray}).enter().append("g").attr("class","overlappedBar");overlappedBars=svg.selectAll(".overlappedBar").selectAll("rect").data(function(d,i){var rArray=[];return rArray});var yi=0;overlappedBars.enter().append("rect").attr("y",function(d,i){var s=sCStartPoint[yi]+sCHeight[yi]-(seriesScale(d.y0)-seriesScale(d.y1));return yi++,s}).attr("height",function(d){return seriesScale(d.y0)-seriesScale(d.y1)}).attr("width",categoryScale.rangeBand()),yi=0,overlappedBars.exit().transition().duration(1e3).ease("bounce").attr("y",function(d){var s=sCStartPoint[yi]+sCHeight[yi];return yi++,s}).attr("height",0).remove().each("end",function(){svg.selectAll(".bar").style("opacity",1);var outerBars=svg.selectAll(".overlappedBar");outerBars.remove()})},stackedColumn}(),xChart.tableKpi=function(){function tableKpi(renderContainerId,color,chartOptions){this.renderContainerId=renderContainerId,this.canvasWidth=document.getElementById(this.renderContainerId).offsetWidth,this.canvasHeight=document.getElementById(this.renderContainerId).offsetHeight,this.margin={top:20,right:5,bottom:0,left:5},this.configuration=chartOptions.gaugeConfiguration,this.utility=new xChart.utility}return tableKpi.prototype.dispatch=d3.dispatch("RenderComplete"),tableKpi.prototype.draw=function(data){function drawBand(start,end,color,height,offset,transition){if(!(0>=end-start)){var bandWidth=rangeScale(end)-rangeScale(start),data=Math.round((end-start)/config.range*100);bandGroup.data([data]).append("rect").attr("class","kpi").attr("height",height).attr("y",h-height-offset).attr("rx","1").attr("ry","1").style("fill",color).style("opacity",1).attr("x",function(){return transition?0:rangeScale(start)}).attr("width",function(){return transition?0:bandWidth}).transition().duration(1e3).attr("width",bandWidth).attr("x",rangeScale(start))}}function getColor(data){var valueColor="#1E90FF";return data>=config.greenZones[0].from&&data<=config.greenZones[0].to?valueColor=config.greenColor:data>=config.redZones[0].from&&data<=config.redZones[0].to?valueColor=config.redColor:data>=config.yellowZones[0].from&&data<=config.yellowZones[0].to&&(valueColor=config.yellowColor),valueColor}var margin=this.margin,renderContainerId=this.renderContainerId,configuration=jQuery.extend(!0,{},data.gaugeConfiguration),config=configuration;$("#"+this.renderContainerId+"_svg").remove();var w=this.canvasWidth-this.margin.left-this.margin.right,h=this.canvasHeight-this.margin.top-this.margin.bottom;config.min=void 0!=configuration.min?configuration.min:0,config.max=void 0!=configuration.max?configuration.max:100,config.range=config.max-config.min,config.actualValue=Math.round(configuration.actualValue),config.targetValue=configuration.targetValue,config.valueFlag=configuration.valueFlag,config.greenColor=configuration.greenColor||"#109618",config.yellowColor=configuration.yellowColor||"#FF9900",config.redColor=configuration.redColor||"#DC3912",config.systemTarget=Math.round(config.targetValue),config.isSystemTarget=!0,isNaN(config.systemTarget)&&(config.systemTarget=config.max,config.targetValue=config.systemTarget,config.isSystemTarget=!1);var bandHeight=10,valueBandHeight=5,bandOffset=0,valueBandOffset=10,triangleEdgeLength=5,rangeScale=d3.scale.linear().domain([config.min,config.max]).range([0,w-triangleEdgeLength]),triangleColor="#1E90FF",valueColor=triangleColor;config.isSystemTarget&&(valueColor=getColor(config.actualValue));var kpiBody=d3.select("#"+renderContainerId).append("svg").attr("id",renderContainerId+"_svg").attr("width",w).attr("height",h).attr("transform","translate("+margin.left+","+margin.top+")").attr("class","tableKpi"),text=kpiBody.append("g").attr("transform","translate(10,"+w/3.5+")").append("text");config.valueFlag?text.append("tspan").data([config.actualValue]).text(d3.format("0.3s")(config.min).toUpperCase()).attr("class","valueText").style("font-family","sans-serif").style("font-size","55").style("fill",valueColor).transition().duration(1e3).tween("text",function(d){var i=d3.interpolate(this.textContent,d);return function(t){this.textContent=d3.format("0.3s")(Math.round(i(t))).toUpperCase()}}):text.append("tspan").text("No Value").style("font-family","sans-serif").style("font-size","25"),config.isSystemTarget&&config.valueFlag&&text.append("tspan").text(" / "+d3.format("0.3s")(config.systemTarget).toUpperCase()).attr("class","valueText").style("font-family","sans-serif").style("font-size","38").style("fill",valueColor);var bandGroup=kpiBody.append("g");if(config.isSystemTarget){for(var index in config.greenZones)drawBand(config.greenZones[index].from,config.greenZones[index].to,config.greenColor,bandHeight,bandOffset,!1);for(var index in config.yellowZones)drawBand(config.yellowZones[index].from,config.yellowZones[index].to,config.yellowColor,bandHeight,bandOffset,!1);for(var index in config.redZones)drawBand(config.redZones[index].from,config.redZones[index].to,config.redColor,bandHeight,bandOffset,!1)}else drawBand(config.min,config.max,triangleColor,bandHeight,bandOffset,!1);drawBand(config.min,config.actualValue,"#C8C8C8",valueBandHeight,valueBandOffset,!0),drawBand(config.actualValue,config.max,"#F0F0F0",valueBandHeight,valueBandOffset,!0),config.isSystemTarget&&bandGroup.append("line").attr("x1",rangeScale(config.systemTarget)).attr("y1",h).attr("x2",rangeScale(config.systemTarget)).attr("y2",h-bandHeight-bandOffset).attr("class","targetLine").style("stroke","black").style("stroke-width","1px").style("display","block").style("stroke-dasharray","3, 1"),config.valueFlag&&kpiBody.append("path").data([config.actualValue]).attr("class","triangle").attr("d",d3.svg.symbol().type("triangle-down").size(40)).style("fill","#1E90FF").attr("transform","translate("+rangeScale(config.min)+","+(h-valueBandOffset-valueBandHeight)+")").transition().duration(1e3).attr("transform","translate("+rangeScale(config.actualValue)+","+(h-valueBandOffset-valueBandHeight)+")"),
this.utility.tooltip(bandGroup,".kpi",!1,!1),this.utility.tooltip(kpiBody,".triangle",!1,!1)},tableKpi.prototype.redraw=function(data){this.draw(data)},tableKpi.prototype.drawOverlap=function(data,originalData){this.draw(data)},tableKpi.prototype.removeOverlap=function(data){this.draw(data)},tableKpi}(),xChart.utility=function(){this.addLinearFilter=function(svg,renderContainerId){var defs=svg.append("defs"),filter=defs.append("filter").attr("id",renderContainerId+"dropshadow");filter.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",1).attr("result","blur"),filter.append("feOffset").attr("in","blur").attr("dx",0).attr("dy",1).attr("result","offsetBlur");var feMerge=filter.append("feMerge");feMerge.append("feMergeNode").attr('in", "offsetBlur'),feMerge.append("feMergeNode").attr("in","SourceGraphic")},this.addRadialFilter=function(svg,renderContainerId){var defs=svg.append("defs"),filter=defs.append("filter").attr("id",renderContainerId+"dropshadow");filter.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",3).attr("result","blur"),filter.append("feOffset").attr("in","blur").attr("dx",3).attr("dy",3).attr("result","offsetBlur"),filter.append("feOffset").attr("in","SourceGraphic").attr("dx",3).attr("dy",3).attr("result","plainOffset"),filter.append("feComposite").attr("operator","out").attr("in","SourceGraphic").attr("in2","plainOffset").attr("result","preHighlight"),filter.append("feColorMatrix").attr("type","matrix").attr("values","0 0 0 0 1  0 0 0 0 1  0 0 0 0 1  0 0 0 1 0").attr("result","preHighlightWhite"),filter.append("feGaussianBlur").attr("stdDeviation",3).attr("result","preHighlightBlur"),filter.append("feComposite").attr("operator","in").attr("in2","SourceGraphic").attr("result","Highlight"),filter.append("feComposite").attr("operator","over").attr("in2","SourceGraphic").attr("result","final"),filter.append("feComposite").attr("operator","over").attr("in2","offsetBlur").attr("result","finalWithDrop")},this.checkChart=function(chart,color,renderContainerId,chartOptions){return"line"===chartOptions.chartType?chart instanceof xChart.line?chart:new xChart.line(renderContainerId,color,chartOptions):"area"===chartOptions.chartType?chart instanceof xChart.area?chart:new xChart.area(renderContainerId,color,chartOptions):"groupedColumn"===chartOptions.chartType?chart instanceof xChart.groupedColumn?chart:new xChart.groupedColumn(renderContainerId,color,chartOptions):"segmentedGroupedColumn"===chartOptions.chartType?chart instanceof xChart.segmentedGroupedColumn?chart:new xChart.segmentedGroupedColumn(renderContainerId,color,chartOptions):"stackedColumn"===chartOptions.chartType?chart instanceof xChart.stackedColumn?chart:new xChart.stackedColumn(renderContainerId,color,chartOptions):"groupedBar"===chartOptions.chartType?chart instanceof xChart.groupedBar?chart:new xChart.groupedBar(renderContainerId,color,chartOptions):"stackedBar"===chartOptions.chartType?chart instanceof xChart.stackedBar?chart:new xChart.stackedBar(renderContainerId,color,chartOptions):"pie"===chartOptions.chartType?chart instanceof xChart.pieOrDonut&&"pie"===chart.chartType?chart:new xChart.pieOrDonut(renderContainerId,chartOptions):"donut"===chartOptions.chartType?chart instanceof xChart.pieOrDonut&&"donut"===chart.chartType?chart:new xChart.pieOrDonut(renderContainerId,chartOptions):"bubble"===chartOptions.chartType?chart instanceof xChart.bubble?chart:new xChart.bubble(renderContainerId,color,chartOptions):"mapview"===chartOptions.chartType?chart instanceof xChart.map?chart:new xChart.map(renderContainerId,color,chartOptions):"kpi"===chartOptions.chartType?chart instanceof xChart.kpi?chart:new xChart.kpi(renderContainerId,color,chartOptions):"tablekpi"===chartOptions.chartType?chart instanceof xChart.tableKpi?chart:new xChart.tableKpi(renderContainerId,color,chartOptions):"gauge"===chartOptions.chartType?chart instanceof xChart.gauge?chart:new xChart.gauge(renderContainerId,color,chartOptions):"normalizedStackedColumn"===chartOptions.chartType?chart instanceof xChart.normalizedStackedColumn?chart:new xChart.normalizedStackedColumn(renderContainerId,color,chartOptions):"pareto"===chartOptions.chartType?chart instanceof xChart.pareto?chart:new xChart.pareto(renderContainerId,color,chartOptions):chart},this.checkOverlapAndRemove=function(ticks,orientation){for(var removedTickCount=0,j=0;j<ticks[0].length;j++){var c=ticks[0][j],n=ticks[0][j+1];if(c&&n&&c.getBoundingClientRect&&n.getBoundingClientRect)if("vertical"===orientation)for(;c.getBoundingClientRect().bottom>n.getBoundingClientRect().top&&(d3.select(n).remove(),j++,n=ticks[0][j+1]););else for(;c.getBoundingClientRect().right>n.getBoundingClientRect().left&&(d3.select(n).remove(),removedTickCount++,j++,n=ticks[0][j+1]););}return removedTickCount/ticks[0].length>.2?!0:!1},this.dataPrep=function(data){var returnObj={seriesForLineChart:[],seriesForChart:[],axesGroups:[]},count=0;data.series.sort(function(a,b){return a.axis-b.axis});for(var i=0;i<data.series.length;i++){if(1==data.series[i].line){var obj={};obj.series=data.series[i],obj.index=i,returnObj.seriesForLineChart.push(obj)}else{var obj={};obj.series=data.series[i],obj.index=i,returnObj.seriesForChart.push(obj)}data.series[i].axis==count+1?("undefined"==typeof returnObj.axesGroups[count]&&(returnObj.axesGroups[count]=[]),returnObj.axesGroups[count].push(data.series[i])):data.series[i].axis>count+1?(count++,returnObj.axesGroups[count]=[],returnObj.axesGroups[count].push(data.series[i])):("undefined"==typeof returnObj.axesGroups[0]&&(returnObj.axesGroups[0]=[]),returnObj.axesGroups[0].push(data.series[i]),data.series[i].axis=1)}return returnObj},this.draw_xAxisDummy=function(svg,categories,height,width,renderContainerId){var wrap=this.wrap,x0=d3.scale.ordinal().rangeRoundBands([0,width],.1,.2),values=(categories.map(function(d){return d.name}),categories.map(function(d){return d.value}));x0.domain(values);var xAxis=d3.svg.axis().scale(x0).orient("bottom"),ticks="";d3.select("#"+renderContainerId+"_xaxis").remove(),ticks=svg.append("g").attr("class","x axis").attr("id",renderContainerId+"_xaxis").attr("transform","translate(0,"+height+")").call(xAxis).selectAll("text").text(function(d,i){return categories[i].name}).call(wrap,x0.rangeBand());var overlap=this.checkOverlapAndRemove(ticks);return svg.select(".x .axis").remove(),overlap},this.draw_xAxisDummy=function(svg,categories,height,width,renderContainerId){var wrap=this.wrap,x0=d3.scale.ordinal().rangeRoundBands([0,width],.1,.2),values=(categories.map(function(d){return d.name}),categories.map(function(d){return d.value}));x0.domain(values);var xAxis=d3.svg.axis().scale(x0).orient("bottom"),ticks="";d3.select("#"+renderContainerId+"_xaxis").remove(),ticks=svg.append("g").attr("class","x axis").attr("id",renderContainerId+"_xaxis").attr("transform","translate(0,"+height+")").call(xAxis).selectAll("text").text(function(d,i){return categories[i].name}).call(wrap,x0.rangeBand());var overlap=this.checkOverlapAndRemove(ticks);return svg.select(".x .axis").remove(),overlap},this.overlapDataPrep=function(Odata,data){function getOverlappedCategoryIndex(i,overlappedData,originalData){for(var j=0;j<overlappedData.categories.length;++j)if(originalData.categories[i].value==overlappedData.categories[j].value)return j;return-1}function getOverlappedSeriesIndex(i,overlappedData,originalData){for(var j=0;j<overlappedData.overlappedSeries.length;++j)if(originalData.series[i].value==overlappedData.overlappedSeries[j].value)return j;return-1}for(var overlappedData=jQuery.extend(!0,{},Odata),originalData=jQuery.extend(!0,{},data),tempCategories=[],i=0;i<originalData.categories.length;++i)tempCategories.push(originalData.categories[i]);for(var tempSeries=[],i=0;i<originalData.series.length;++i){tempSeries.push(originalData.series[i]);for(var n=0;n<originalData.series[i].data.length;++n)tempSeries[i].data[n]=[0],tempSeries[i].fmtData[n]=["0"]}for(var i=0;i<tempCategories.length;++i)for(var j=0;j<tempSeries.length;++j){var catIndex=getOverlappedCategoryIndex(i,overlappedData,originalData);if(!(0>catIndex)){var seriesIndex=getOverlappedSeriesIndex(j,overlappedData,originalData);if(!(0>seriesIndex)){var dataValue=overlappedData.overlappedSeries[seriesIndex].data[catIndex][0],fmtDataValue=overlappedData.overlappedSeries[seriesIndex].fmtData[catIndex][0];tempSeries[j].data[i]=[dataValue],tempSeries[j].fmtData[i]=[fmtDataValue]}}}return overlappedData.categories=tempCategories,overlappedData.overlappedSeries=tempSeries,overlappedData},this.tooltip=function(svg,element,detailed,circular){detailed||".legend"!=element?detailed||".kpi"!=element?detailed||".triangle"!=element?detailed||".axis"!=element?detailed&&!circular?$(element).tipsy({gravity:"s",html:!0,title:function(){var d=this.__data__,borderColor=this.style.fill;return".areacircle"===element&&(borderColor=this.style.stroke),'<div style="padding: 5px; border-color: '+borderColor+"; border-style: solid; border-width: 1px; display: inline-block; position: relative; box-shadow: 1px 1px 2px rgba(0,0,0,0.24);background: #FFF;color: #000;font-family: 'Roboto Light' !important;font-size:11px;\">"+d.fmtData+"<br/>"+d.seriesLongName+"<br/>"+d.categoryLongName+'<br/><span style="position: absolute;left:calc(50% - 5px); bottom: -6px; background: #FFF; display: block; width: 10px; height: 10px; border-left: 1px solid '+borderColor+"; border-bottom: 1px solid "+borderColor+'; -moz-transform: rotate(-45deg); -webkit-transform: rotate(-45deg); -ms-transform: rotate(-45deg); box-shadow: -1px 2px 1px rgba(0,0,0,0.24); "></span></div>'}}):detailed||circular?detailed&&circular&&$(element).tipsy({gravity:function(){var d=this.__data__,midRadian=(d.startAngle+d.endAngle)/2;midRadian*(180/Math.PI);return"s"},html:!0,title:function(){var d=this.__data__,borderColor=this.style.fill;return'<div style="padding: 5px; border-color: '+borderColor+"; border-style: solid; border-width: 1px; display: inline-block; position: relative; box-shadow: 1px 1px 2px rgba(0,0,0,0.24);background: #FFF;color: #000;font-family: 'Roboto Light' !important;font-size:11px;\">"+d.percent+"%<br/>"+d.seriesLongName+"<br/>"+d.categoryLongName+'<br/><span style="position: absolute;left:calc(50% - 5px); bottom: -6px; background: #FFF; display: block; width: 10px; height: 10px; border-left: 1px solid '+borderColor+"; border-bottom: 1px solid "+borderColor+'; -moz-transform: rotate(-45deg); -webkit-transform: rotate(-45deg); -ms-transform: rotate(-45deg); box-shadow: -1px 2px 1px rgba(0,0,0,0.24); "></span></div>'}}):$(element).tipsy({gravity:"s",html:!0,title:function(){if("undefined"!=typeof this.__data__){var d=this.__data__,borderColor=this.style.fill;return'<div style="padding: 5px; border-color: '+borderColor+"; border-style: solid; border-width: 1px; display: inline-block; position: relative; box-shadow: 1px 1px 2px rgba(0,0,0,0.24);background: #FFF;color: #000;font-family: 'Roboto Light' !important;font-size:11px;\">"+d+' <br/><span style="position: absolute;left:calc(50% - 5px); bottom: -6px; background: #FFF; display: block; width: 10px; height: 10px; border-left: 1px solid '+borderColor+"; border-bottom: 1px solid "+borderColor+'; -moz-transform: rotate(-45deg); -webkit-transform: rotate(-45deg); -ms-transform: rotate(-45deg); box-shadow: -1px 2px 1px rgba(0,0,0,0.24); "></span></div>'}}}):$(element).tipsy({gravity:"s",html:!0,title:function(){var d=this.__data__,borderColor=this.style.fill;return'<div style="padding: 5px; border-color: '+borderColor+"; border-style: solid; border-width: 1px; display: inline-block; position: relative; box-shadow: 1px 1px 2px rgba(0,0,0,0.24);background: #FFF;color: #000;font-family: 'Roboto Light' !important;font-size:11px;\">"+d+' <br/><span style="position: absolute;left:calc(50% - 5px); bottom: -6px; background: #FFF; display: block; width: 10px; height: 10px; border-left: 1px solid '+borderColor+"; border-bottom: 1px solid "+borderColor+'; -moz-transform: rotate(-45deg); -webkit-transform: rotate(-45deg); -ms-transform: rotate(-45deg); box-shadow: -1px 2px 1px rgba(0,0,0,0.24); "></span></div>'}}):$(element).tipsy({gravity:"s",html:!0,title:function(){var d=this.__data__,borderColor=this.style.fill;return'<div style="padding: 5px; border-color: '+borderColor+"; border-style: solid; border-width: 1px; display: inline-block; position: relative; box-shadow: 1px 1px 2px rgba(0,0,0,0.24);background: #FFF;color: #000;font-family: 'Roboto Light' !important;font-size:11px;\">"+d+'<br/><span style="position: absolute;left:calc(50% - 5px); bottom: -6px; background: #FFF; display: block; width: 10px; height: 10px; border-left: 1px solid '+borderColor+"; border-bottom: 1px solid "+borderColor+'; -moz-transform: rotate(-45deg); -webkit-transform: rotate(-45deg); -ms-transform: rotate(-45deg); box-shadow: -1px 2px 1px rgba(0,0,0,0.24); "></span></div>'}}):$(element).tipsy({gravity:"s",html:!0,title:function(){var d=this.__data__;"object"==typeof d&&(d=d.data);var borderColor=this.style.fill;return'<div style="padding: 5px; border-color: '+borderColor+"; border-style: solid; border-width: 1px; display: inline-block; position: relative; box-shadow: 1px 1px 2px rgba(0,0,0,0.24);background: #FFF;color: #000;font-family: 'Roboto Light' !important;font-size:11px;\">"+d+'%<br/><span style="position: absolute;left:calc(50% - 5px); bottom: -6px; background: #FFF; display: block; width: 10px; height: 10px; border-left: 1px solid '+borderColor+"; border-bottom: 1px solid "+borderColor+'; -moz-transform: rotate(-45deg); -webkit-transform: rotate(-45deg); -ms-transform: rotate(-45deg); box-shadow: -1px 2px 1px rgba(0,0,0,0.24); "></span></div>'}}):$(element).tipsy({gravity:"s",html:!0,title:function(){var legendName,d=this.__data__;legendName="undefined"!=typeof d.longName?d.longName:d.categoryLongName;var borderColor=this.style.fill;return'<div style="padding: 5px; border-color: '+borderColor+"; border-style: solid; border-width: 1px; display: inline-block; position: relative; box-shadow: 1px 1px 2px rgba(0,0,0,0.24);background: #FFF;color: #000;font-family: 'Roboto Light' !important;font-size:11px;\">"+legendName+'<br/><span style="position: absolute;left:calc(50% - 5px); bottom: -6px; background: #FFF; display: block; width: 10px; height: 10px; border-left: 1px solid '+borderColor+"; border-bottom: 1px solid "+borderColor+'; -moz-transform: rotate(-45deg); -webkit-transform: rotate(-45deg); -ms-transform: rotate(-45deg); box-shadow: -1px 2px 1px rgba(0,0,0,0.24); "></span></div>'}})},this.wrap=function(axisText,avaiableWidth){axisText.each(function(){for(var w,text=d3.select(this),allWords=text.text().split(/\s+/).reverse(),lineHeight=1.1,lineNo=0,lineArr=[],y=text.attr("y"),dy=parseFloat(text.attr("dy")),tspan=text.text(null).append("tspan").attr("x",0).attr("y",y).attr("dy",dy+"em");w=allWords.pop();){if(lineNo>0)return;lineArr.push(w),tspan.text(lineArr.join(" "));var computedWidth;try{computedWidth=tspan.node().getComputedTextLength()}catch(eee){computedWidth=8*tspan.node().childNodes[0].length}computedWidth>avaiableWidth&&(lineArr.pop(),tspan.text(lineArr.join(" ")),lineArr=[w],tspan=text.append("tspan").attr("x",0).attr("y",y).attr("dy",++lineNo*lineHeight+dy+"em").text(w))}})}},xChart});